//mark.lawrence
//app.module.js

(function () {
    angular.module('app',
    [
        //application modules
        'app.core',
        'app.service',
        'app.filter',

        //feature areas
        'app.nav',
        'app.users',
        'app.events', 
        'app.demographics',
        'app.donortax',
        'app.mailer'
        
    ]);
})();
//core.module.js
//mark.lawrence

(function () {
    angular.module('app.core',
        [
            //angular modules
            'ngMessages',
            'angularLocalStorage',
            'ngRoute',
            'ngAnimate',

            //custom modules
            'blocks.logger',
            'blocks.exception',

            //third party modules
            'smart-table',
            'ui.bootstrap',
            'ngTagsInput',
            'ngFileUpload',
            'rzModule',
            'switcher',
            'gfl.textAvatar',
            'textAngular',
            'ui.bootstrap.datetimepicker',
            'angular-confirm'
        ])
        .constant('toastr', toastr)
        .constant('moment', moment)
        .config(function (stConfig) {
            stConfig.search.delay = 2000;
        });

})();
//config.js
//mark.lawrence
(function () {
    function toastrConfig(toastr) {
        toastr.options.timeOut = 4000;
        toastr.options.positionClass = 'toast-bottom-right';
    };

    var keyCodes = {
        backspace: 8,
        tab: 9,
        enter: 13,
        esc: 27,
        space: 32,
        pageup: 33,
        pagedown: 34,
        end: 35,
        home: 36,
        left: 37,
        up: 38,
        right: 39,
        down: 40,
        insert: 45,
        del: 46
    };

    var apiEndPoints = {
        User: 'users',
        Constituent: 'constituent',
        Tax: 'tax',
        Template: 'template',
        Campaign: 'campaign',
        Mailer: 'mailer',
        Reason: 'reason',
        Event: 'event',
        Guest: 'guest',
        File: 'file', 
        Demographic: 'demographics'
    };

    var config = {
        appErrorPrefix: '[DG Error] ', //Configure the exceptionHandler decorator
        appTitle: 'DonorGateway',
        version: '1.0.0',
        apiUrl: 'http://' + window.location.host + '/api/',
        keyCodes: keyCodes,
        apiEndPoints: apiEndPoints
    };

    var defaults = {
        EMAIL_SUFFIX: '@splcenter.org',
        GENERIC_PASSWORD: '1P@ssword'
    };

    angular.module('app.core')
        .config(toastrConfig)
        .constant('config', config)
        .value('defaults', defaults);
})();
//mark.lawrence
//exception.module.js

(function () {
    angular.module('blocks.exception', ['blocks.logger']);
})();
(function () {
    'use strict';

    angular.module('blocks.logger', []);
})();
//mark.lawrence
//demographics.module.js

(function() {
	
    'use strict';

    angular.module('app.demographics', []);

})();
//mark.lawrence
//donortax.module.js

(function() {
    angular.module('app.donortax', []);
})();
//mark.lawrence
//event.module.js

(function () {
    angular.module('app.events', []);
})();
//filter.module.js
//mark.lawrence

(function () {
    angular.module('app.filter', []);
})();
//mark.lawrence
//mailer.module.js

(function() {
    angular.module('app.mailer', []);
})();
//mark.lawrence
//nav.module.js

(function () {
    angular.module('app.nav', []);
})();
//service.module.js
//mark.lawrence

(function () {
    angular.module('app.service', []);
})();
(function () {
    'use strict';

    angular.module('app.users', []);
})();
//mark.lawrence
//exception-handler.provider.js

// Include in index.html so that app level exceptions are handled.
// Exclude from testRunner.html which should run exactly what it wants to run
(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .provider('exceptionHandler', exceptionHandlerProvider)
        .config(config);

    /**
     * Must configure the exception handling
     * @return {[type]}
     */
    function exceptionHandlerProvider() {
        /* jshint validthis:true */
        this.config = {
            appErrorPrefix: undefined
        };

        this.configure = function (appErrorPrefix) {
            this.config.appErrorPrefix = appErrorPrefix;
        };

        this.$get = function () {
            return { config: this.config };
        };
    };

    /**
     * Configure by setting an optional string value for appErrorPrefix.
     * Accessible via config.appErrorPrefix (via config value).
     * @param  {[type]} $provide
     * @return {[type]}
     * @ngInject
     */
    function config($provide) {
        $provide.decorator('$exceptionHandler', extendExceptionHandler);
    };

    /**
     * Extend the $exceptionHandler service to also display a toast.
     * @param  {Object} $delegate
     * @param  {Object} exceptionHandler
     * @param  {Object} logger
     * @return {Function} the decorated $exceptionHandler service
     */
    function extendExceptionHandler($delegate, exceptionHandler, logger) {
        return function (exception, cause) {
            var appErrorPrefix = exceptionHandler.config.appErrorPrefix || '';
            var errorData = { exception: exception, cause: cause };
            exception.message = appErrorPrefix + exception.message;
            $delegate(exception, cause);
            /**
             * Could add the error to a service's collection,
             * add errors to $rootScope, log errors to remote web server,
             * or log locally. Or throw hard. It is entirely up to you.
             * throw exception;
             *
             * @example
             *     throw { message: 'error message we added' };
             */
            logger.error(exception.message, errorData);
        };
    };
})();
//mark.lawrence
//exception.js

(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .factory('exception', exception);

    /* @ngInject */
    function exception(logger) {
        var service = {
            catcher: catcher
        };

        return service;

        function catcher(message) {
            return function (reason) {
                logger.error(message, reason);
            };
        };
    };
})();
//mark.lawrence
//logger.js

(function () {
    'use strict';

    angular.module('blocks.logger').factory('logger', logger);

    logger.$inject = ['$log', 'toastr'];

    function logger($log, toastr) {
        var service = {
            showToasts: true,

            error: error,
            info: info,
            success: success,
            warning: warning,

            // straight to console; bypass toastr
            log: $log.log
        };

        return service;
        /////////////////////

        function error(message, data, title) {
            toastr.error(message, title);
            $log.error('Error: ' + message, data);
        }

        function info(message, data, title) {
            toastr.info(message, title);
            $log.info('Info: ' + message, data);
        }

        function success(message, data, title) {
            toastr.success(message, title);
            $log.info('Success: ' + message, data);
        }

        function warning(message, data, title) {
            toastr.warning(message, title);
            $log.warn('Warning: ' + message, data);
        }
    };
})();
//mark.lawrence
//demographics.js

(function() {
    'use strict'; 

    var controllerId = 'DemographicsController';

    angular.module('app.demographics').controller(controllerId, UserController);

    UserController.$inject = ['logger', 'demographicService'];

    function UserController(logger, service) {
        var vm = this;
        var tableStateRef;
        var pageSizeDefault = 10;

        vm.title = 'Demographic Updates';
        vm.description = 'Updates made to constituent data'; 
        vm.subTitle = 'Demographics';

        vm.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'asc'
        };

        vm.demographics = [];

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
        };

        vm.search = function (tableState) {
            tableStateRef = tableState;

            if (tableState !== undefined) {
                if (typeof (tableState.sort.predicate) !== "undefined") {
                    vm.searchModel.orderBy = tableState.sort.predicate;
                    vm.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
                }
            }

            vm.isBusy = true;
            service.query(vm.searchModel)
                .then(function (data) {
                    vm.demographics = data.items;
                    vm.searchModel = data;
                    vm.isBusy = false;
                    vm.manual = true;
                });
        }
        
        vm.manualSearch = function () {
            logger.log('manual');
            vm.search(tableStateRef);
        }

        vm.paged = function paged(pageNum) {
            vm.search(tableStateRef);
        };

        vm.delete = function(demo) {
            vm.isBusy = true;
            service.remove(demo.id)
                .then(function (data) {
                    logger.success('Deleted ' + demo.name);
                    var idx = vm.demographics.indexOf(demo);
                    vm.demographics.splice(idx, 1);
                }).finally(function() {
                    vm.isBusy = false; 
                });
        }

        vm.deleteAll = function () {
            vm.isBusy = true;
            service.removeAll()
                .then(function (data) {
                    logger.success(data);
                    vm.demographics = []; 
                }).finally(function () {
                    vm.isBusy = false;
                });

        }

        vm.export = function () {
            vm.isBusy = true;
            service.exportList()
                .then(function (data) {
                    var contentType = data.headers()['content-type'];
                    var filename = data.headers()['x-filename'];

                    var linkElement = document.createElement('a');
                    try {
                        var blob = new Blob([data.data], { type: contentType });
                        var url = window.URL.createObjectURL(blob);

                        linkElement.setAttribute('href', url);
                        linkElement.setAttribute("download", filename);

                        var clickEvent = new MouseEvent("click", {
                            "view": window,
                            "bubbles": true,
                            "cancelable": false
                        });
                        linkElement.dispatchEvent(clickEvent);
                    } catch (ex) {
                        logger.log(ex);
                    }
                }).finally(function () {
                    vm.isBusy = false;
                });
        }
    }

})();
//mark.lawrence
//clear-key.directive.js

(function () {
    angular.module('app').directive("clearKey", function () {
        return {
            restrict: 'EA',
            require: 'ngModel',
            link: function (scope, el, attrs, ctrl) {
                el.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    ctrl.$setViewValue(null);
                    ctrl.$render();
                    scope.$apply();
                });
            }
        };
    });
})();
//mark.lawrence
//date-before.directive.js

(function () {
    angular.module('app').directive('dateBefore', function ($window) {
        return {
            require: '^ngModel',
            restrict: 'A',
            link: function (scope, elem, attrs, ngModel) {
                if (!ngModel) return; // do nothing if no ng-model
                debugger;
                var dateBefore = attrs.dateBefore;
                console.log('date', dateBefore);

                // watch own value and re-validate on change
                scope.$watch(attrs.ngModel, function () {
                    validate();
                });

                // observe the other value and re-validate on change
                attrs.$observe('dateGreaterAndEqual', function (val) {
                    validate();
                });

                var validate = function () {
                    // values
                    var dateTo = angular.isDefined(ngModel.$viewValue) === true && !_.isNull(ngModel.$viewValue) ? moment(ngModel.$viewValue).toDate() : null;
                    var dateFrom = attrs.dateGreaterAndEqual !== "" ? moment(attrs.dateGreaterAndEqual.replace('"', '').replace('\\', '').replace('"', '')).toDate() : null;
                    //passing date with braces around it causes and issue therfore we need to use replace

                };
            }
        };
    });


})();
//mark.lawrence
//date-format.directive.js

(function () {
    angular.module('app')
        .directive('dateFormat',
            function (dateFilter, $parse) {
                return {
                    restrict: 'EAC',
                    require: '?ngModel',
                    link: function (scope, element, attrs, ngModel, ctrl) {
                        ngModel.$parsers.push(function (viewValue) {
                            return dateFilter(viewValue, 'MM/dd/yyyy h:mm a');
                        });
                    }
                }
            });
})();
//mark.lawrence
//date-input.directive.js

(function () {
    angular.module('app').directive('dateInput', function ($window) {
        return {
            require: '^ngModel',
            restrict: 'A',
            link: function (scope, elm, attrs, ctrl) {
                var moment = $window.moment;
                var dateFormat = attrs.dateInput;
                attrs.$observe('dateInput', function (newValue) {
                    if (dateFormat === newValue || !ctrl.$modelValue) return;
                    dateFormat = newValue;
                    ctrl.$modelValue = new Date(ctrl.$setViewValue);
                });

                ctrl.$formatters.unshift(function (modelValue) {
                    scope = scope;
                    if (!dateFormat || !modelValue) return "";
                    var retVal = moment(modelValue).format(dateFormat);
                    return retVal;
                });

                ctrl.$parsers.unshift(function (viewValue) {
                    scope = scope;
                    var date = moment(viewValue, dateFormat);
                    return (date && date.isValid() && date.year() > 1950) ? date.toDate() : "";
                });
            }
        };
    });
})();
//mark.lawrence
//smart-table.clearKey.js

(function () {
    angular.module('app').directive("stClearKey", function () {
        return {
            restrict: 'EA',
            require: ['^stTable', '^ngModel'],
            link: function (scope, element, attrs, ctrls) {
                element.on('keydown', function (event) {
                    var ngModel = ctrls[1];
                    var ctrl = ctrls[0];

                    if (event.which === 13) {
                        return ctrl.pipe();
                    }
                    if (event.which === 27) {

                        if (element.context.attributes['st-search'] !== undefined) {
                            return scope.$apply(function () {
                                var fieldName = element.context.attributes['st-search'].value;
                                var tableState = ctrl.tableState();
                                tableState.search.predicateObject[fieldName] = '';
                                return ctrl.pipe();
                            });

                        } else {
                            return scope.$apply(function () {
                                ngModel.$setViewValue(null);
                                ngModel.$render(); // will update the input value as well
                            });

                        }
                    }
                });
            }
        };
    });

    angular.module('app')
        .directive("stResetSearch",
            function () {
                return {
                    restrict: 'EA',
                    require: ['^stTable', '^ngModel'],
                    link: function (scope, element, attrs, ctrls) {
                        return element.bind('click',
                            function () {
                                var model = ctrls[1];
                                var ctrl = ctrls[0];

                                return scope.$apply(function () {
                                    angular.forEach(model.$viewValue,
                                        function (value, key) {
                                            if (key.toLowerCase() === 'page') {
                                                model.$viewValue[key] = 1;
                                            }
                                            if (Array.isArray(value) || key.toLowerCase().includes('page')) return;
                                            model.$viewValue[key] = null;
                                        });
                                    tableState = ctrl.tableState();
                                    tableState.search.predicateObject = {};
                                    tableState.pagination.start = 0;
                                    return ctrl.pipe();
                                });
                            });
                    }
                };
            });

    angular.module('app').directive('stSubmitSearch', ['stConfig', '$timeout', '$parse', function (stConfig, $timeout, $parse) {
        return {
            require: '^stTable',
            link: function (scope, element, attr, ctrl) {
                return element.bind('click',
                    function () {
                        var tableCtrl = ctrl;
                        tableCtrl.pipe();
                    });

            }
        };
    }]);


    angular.module('smart-table')
      .directive('stSearch', ['stConfig', '$timeout', '$parse', function (stConfig, $timeout, $parse) {
          return {
              require: '^stTable',
              link: function (scope, element, attr, ctrl) {
                  var tableCtrl = ctrl;
                  var promise = null;
                  var throttle = attr.stDelay || stConfig.search.delay;
                  var event = attr.stInputEvent || stConfig.search.inputEvent;

                  attr.$observe('stSearch', function (newValue, oldValue) {
                      var input = element[0].value;
                      if (newValue !== oldValue && input) {
                          ctrl.tableState().search = {};
                          tableCtrl.search(input, newValue);
                      }
                  });

                  //table state -> view
                  scope.$watch(function () {
                      return ctrl.tableState().search;
                  }, function (newValue, oldValue) {
                      var predicateExpression = attr.stSearch || '$';
                      if (newValue.predicateObject && $parse(predicateExpression)(newValue.predicateObject) !== element[0].value) {
                          element[0].value = $parse(predicateExpression)(newValue.predicateObject) || '';
                      }
                  }, true);

                  // view -> table state
                  element.bind(event, function (evt) {
                      evt = evt.originalEvent || evt;
                      if (promise !== null) {
                          $timeout.cancel(promise);
                      }

                      promise = $timeout(function () {
                          tableCtrl.search(evt.target.value, attr.stSearch || '');
                          promise = null;
                      }, throttle);
                  });
              }
          };
      }]);

})();
(function() {


    var app = angular.module('app');

    app.directive('toggleCheckbox', function($timeout) {

        /**
     * Directive
     */
        return {
            restrict: 'A',
            transclude: true,
            replace: false,
            require: 'ngModel',
            link: function($scope, $element, $attr, ngModel) {

                // update model from Element
                var updateModelFromElement = function() {
                    // If modified
                    var checked = $element.prop('checked');
                    if (checked !== ngModel.$viewValue) {
                        // Update ngModel
                        ngModel.$setViewValue(checked);
                        $scope.$apply();
                    }
                };

                // Update input from Model
                var updateElementFromModel = function(newValue) {
                    $element.trigger('change');
                };

                // Observe: Element changes affect Model
                $element.on('change', function() {
                    updateModelFromElement();
                });

                $scope.$watch(function() {
                    return ngModel.$viewValue;
                }, function(newValue) {
                    updateElementFromModel(newValue);
                }, true);

                // Initialise BootstrapToggle
                $element.bootstrapToggle();
            }
        };
    });
})();
//mark.lawrence
//donortax.controller.js

(function() {
    'use strict';

    var controllerId = 'DonorTaxController';

    angular.module('app.donortax').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$uibModal', 'constituentService'];

    function mainController(logger, $modal, service) {
        var vm = this;
        var tableStateRef;
        var pageSizeDefault = 10;

        vm.title = 'Donor Tax Manager';
        vm.subTitle = 'Constituents';

        vm.people = [];
        vm.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'asc'
        };
        
        activate();

        function activate() {
            logger.log(controllerId + ' activated');
        }

        vm.search = function (tableState) {
            tableStateRef = tableState;

            if (!vm.searchModel.isPriority) vm.searchModel.isPriority = null;

            if (tableState !== undefined) {
                if (typeof (tableState.sort.predicate) !== "undefined") {
                    vm.searchModel.orderBy = tableState.sort.predicate;
                    vm.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
                }
            }

            vm.isBusy = true;
            service.query(vm.searchModel)
                .then(function (data) {
                    vm.people = data.items;
                    vm.searchModel = data;
                    vm.isBusy = false;
                });
        }

        vm.paged = function paged(pageNum) {
            vm.search(tableStateRef);
        };

        vm.edit = function (person) {
            $modal.open({
                templateUrl: '/app/donortax/views/edit-constituent.html',
                controller: 'EditConstituentController',
                controllerAs: 'vm', 
                resolve: {
                    person: person
                }
            }).result.then(function (person) {
                logger.success('Successfully updated ' + person.name);
            });
        }

        vm.viewTaxes = function (person) {

            $modal.open({
                templateUrl: '/app/donortax/views/taxitems.html',
                controller: 'TaxItemsController',
                controllerAs: 'vm',
                resolve: {
                    person: person
                }
            }).result.then(function (person) {
                logger.success('Successfully updated ' + person.name);
            });
        }
    }

})();
//mark.lawrence
//editConstituent.controller.js

(function () {
    'use strict';

    var controllerId = 'EditConstituentController';

    angular.module('app.donortax').controller(controllerId, mainController);

    mainController.$inject = ['$scope', 'logger', '$uibModalInstance', 'constituentService', 'person'];

    function mainController($scope, logger, $modal, service, person) {
        var vm = this;
        vm.title = 'Edit Person';
        vm.person = person;

        vm.cancel = function () {
            logger.log('cancel');
            $modal.dismiss();
        }

        vm.save = function () {
            service.save(person)
                .then(function (data) {
                    angular.extend(vm.person, data);
                    $modal.close(vm.person);
                });
        }
    }

})();
//mark.lawrence
//taxItems.controller.js

(function () {
    'use strict';

    var controllerId = 'TaxItemsController';

    angular.module('app.donortax').controller(controllerId, mainController);

    mainController.$inject = ['$scope', 'logger', '$uibModalInstance', 'constituentService', 'person'];

    function mainController($scope, logger, $modal, service, constituent) {
        var vm = this;
        var currentYear = parseInt(moment().get('Year'));

        vm.selectedYear = currentYear - 1;
        vm.dateOptions = {
            formatYear: 'yyyy',
            maxDate: new Date('12/30/' + vm.selectedYear),
            minDate: new Date('1/1/' + vm.selectedYear),
            startingDay: 1
        };
        vm.altInputFormats = ['M!/d!/yyyy'];
        vm.years = [];

        vm.yearChanged = yearChanged;

        vm.constituent = constituent;
        vm.itemToEdit = {};
        vm.newItem = {};
        vm.taxItems = constituent.taxItems;
        activate();

        function activate() {
            getYears();
        }


        vm.addItem = function() {
            vm.newItem.constituentId = constituent.id;
            vm.newItem.taxYear = moment(vm.newItem.donationDate).year();

            service.addTax(vm.newItem)
                .then(function (data) {
                    vm.taxItems.push(data);
                    vm.newItem = {};
                    logger.success('Added tax item');
                });
        }

        vm.cancelEdit = function() {
            vm.currentEdit = {};
        }

        vm.deleteItem = function(item) {
            var idx = vm.taxItems.indexOf(item);
            service.removeTax(item.id)
                .then(function (data) {
                    vm.taxItems.splice(idx, 1);
                    logger.warning('deleted ' + item.donationDate);
                });
        }

        vm.editItem = function(item) {
            vm.currentEdit = {};
            vm.currentEdit[item.id] = true;
            vm.itemToEdit = angular.copy(item);
            vm.itemToEdit.donationDate = moment(vm.itemToEdit.donationDate).toDate();
        }

        vm.saveItem = function(item) {
            service.updateTax(vm.itemToEdit)
                .then(function (response) {
                    angular.extend(item, vm.itemToEdit);
                    vm.currentEdit = {};
                    logger.success('Updated tax item ' + moment(item.donationDate).format('MM/dd/yyyy'));
                });
        }

        function yearChanged() {
            vm.dateOptions = {
                maxDate: new Date('12/30/' + vm.selectedYear),
                minDate: new Date('1/1/' + vm.selectedYear)
            };
            vm.newItem.donationDate = vm.dateOptions.minDate;
        }

        function getYears() {
            for (var i = 0; i < 5; i++) {
                vm.years.push(currentYear - i);
            }
            vm.yearChanged();
        }

        vm.cancel = function () {
            $modal.dismiss();
        }

    }

})();
//mark.lawrence
//env.js

(function (window) {
    window.__env = window.__env || {};

    switch (window.location.hostname) {
        case 'dg-test':
            window.__env.rsvpUrl = 'rsvp-test';
            break;
        case 'donorgateway.splcenter.org':
            window.__env.rsvpUrl = 'rsvp.splcenter.org';
            break;
        case 'dg':
            window.__env.rsvpUrl = 'rsvp.splcenter.org';
            break;
        case 'donorgateway':
            window.__env.rsvpUrl = 'rsvp.splcenter.org';
            break;
        default:
            window.__env.rsvpUrl = 'localhost:54505';
    }

    // API url
    window.__env.apiUrl = 'http://' + window.location.host + '/api';

    // Base url
    window.__env.baseUrl = '/';

    // Whether or not to enable debug mode
    // Setting this to false will disable console output
    window.__env.enableDebug = true;
}(this));
//mark.lawrence
//createEvent.controller.js

(function() {
	
    'use strict';

    var controllerId = 'CreateEventController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$uibModalInstance', 'eventService'];

    function mainController(logger, $modal, service) {
        var vm = this;
        vm.title = 'Create Event';
        
        vm.dateFormat = "MM/DD/YYYY hh:mm";

        vm.event = {
            startDate: new Date(),
            capacity: 1,
            template: {}
        };

        vm.cancel = function () {
            $modal.dismiss();
        }

        vm.save = function () {
            vm.isSaving = true; 
            vm.event.template.name = vm.event.name;
            service.create(vm.event)
                .then(function (data) {
                    $modal.close(data);
                });
        }
    }

})();
//mark.lawrence
//editGuest.controller.js

(function () {
    'use strict';

    var controllerId = 'CreateGuestController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['$scope', 'logger', '$uibModalInstance', 'eventService', 'event'];

    function mainController($scope, logger, $modal, service, event) {
        var vm = this;
        vm.title = 'Create Guest';

        vm.guest = {
            finderNumber: '00000000000',
            eventId: event.id
        };

        vm.ticketCountList = [];
        for (var i = 1; i < event.ticketAllowance + 1; i++) {
            vm.ticketCountList.push(i);
        }

        vm.decrementTickets = function () {
            $scope.editGuestForm.$pristine = false;
            vm.guest.additionalTickets--;
        }

        vm.incrementTickets = function (e) {
            $scope.editGuestForm.$pristine = false;
            vm.guest.additionalTickets++;
        }

        vm.cancel = function () {
            $modal.dismiss();
        }

        vm.changeAttending = function () {
            if (vm.guest.isAttending) {
                vm.guest.ticketCount = 1;
            } else {
                vm.guest.ticketCount = null;
            }
        }

        vm.save = function () {
            vm.guest.insideSalutation = vm.guest.name;
            vm.guest.outsideSalutation = vm.guest.name;
            vm.guest.emailSalutation = vm.guest.name;
            vm.guest.eventId = event.id;
            service.registerGuest(vm.guest)
                            .then(function (data) {
                                angular.extend(vm.guest, data);
                                $modal.close(vm.guest);
                            }).finally(function () {
                            });
        }
    }


})();
//mark.lawrence
//editGuest.controller.js

(function () {
    'use strict';

    var controllerId = 'EditGuestController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['$scope', 'logger', '$uibModalInstance', 'eventService', 'guest'];

    function mainController($scope, logger, $modal, service, guest) {
        var vm = this;
        vm.title = 'Edit Guest';

        if (guest.isAttending) {
            vm.showAddTicket = true;
            guest.additionalTickets = 0;
        }

        vm.guest = angular.copy(guest);
        logger.log('guest', guest);
        logger.log('vm.guest', vm.guest);

        vm.ticketCountList = [];
        for (var i = 1; i < guest.event.ticketAllowance + 1; i++) {
            vm.ticketCountList.push(i);
        }
        
        vm.decrementTickets = function () {
            $scope.editGuestForm.$pristine = false;
            vm.guest.additionalTickets--;
        }

        vm.incrementTickets = function (e) {
            $scope.editGuestForm.$pristine = false; 
            vm.guest.additionalTickets++;
        }
        
        vm.cancel = function () {
            $modal.dismiss();
        }

        vm.changeAttending = function () {
            if (vm.guest.isAttending) {
                vm.guest.ticketCount = 1;
            } else {
                vm.guest.ticketCount = null;
            }
        }

        vm.save = function () {

            if (vm.showAddTicket) {
                service.addTicket(vm.guest)
                    .then(function (data) {
                        angular.extend(vm.guest, data);
                        $modal.close(vm.guest);
                    });
            } else {
                service.registerGuest(vm.guest)
                    .then(function(data) {
                        angular.extend(vm.guest, data);
                        $modal.close(vm.guest);
                    });
            }
        }
    }


})();
//mark.lawrence
//events.js

(function () {
    'use strict';

    var controllerId = 'EventController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['$scope', 'logger', '$uibModal', 'eventService', 'guestService', 'templateService'];

    function mainController($scope, logger, $modal, service, guestService, templateService) {
        var vm = this;
        vm.title = 'Event Manager';
        var tableStateRef;
        var pageSizeDefault = 10;

        var choices = [
            { id: 1, name: "Register", command: function (e) { vm.registerGuest(e) }, icon: 'icon ion-key', default: true },
            { id: 2, name: "Mail Ticket", command: function (e) { vm.mailTicket(e) }, icon: 'icon ion-android-mail', default: false },
            { id: 3, name: "Cancel", command: function (e) { vm.cancelGuest(e) }, icon: 'icon ion-android-cancel', default: false },
            { id: 4, name: "Guest List", command: function (e) { vm.addToMailQueue(e) }, icon: 'icon ion-android-add-circle', default: false },
            { id: 5, name: "Add Tickets", command: function (e) { vm.registerGuest(e) }, icon: 'icon ion-android-add-circle', default: false }
        ];

        vm.hostLocation = window.__env.rsvpUrl + '/';

        vm.title = 'Event Manager';
        vm.description = "Manage Donor Events";
        vm.currentDate = new Date();

        vm.dateOptions = {
            dateDisabled: false,
            formatYear: 'yy',
            maxDate: new Date(2020, 5, 22),
            minDate: new Date(),
            startingDay: 1
        };

        vm.dateFormat = "MM/DD/YYYY h:mm a";
        vm.events = [];

        vm.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'asc'
        };

        vm.tabs = [
            { title: 'Details', template: 'app/events/views/home.html', active: false, icon: 'fa-info-circle' },
            { title: 'Guests', template: 'app/events/views/guest-list.html', active: true, icon: 'fa-users' },
            //{ title: 'Mail Queue', template: 'app/events/views/mail-queue.html', active: false, icon: '' },
            //{ title: 'Waiting Queue', template: 'app/events/views/wait-queue.html', active: false, icon: '' },
            { title: 'Template', template: 'app/events/views/template.html', active: false, icon: 'fa-file-text' }
        ];

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            getEvents().then(function () {
                logger.log('loaded events');
            });
        }

        vm.addToMailQueue = function (guest) {
            vm.isBusy = true;
            service.addToMail(guest)
                .then(function (data) {
                    logger.info('Moved Guest ' + data.name + 'Send Ticket: ');
                    angular.extend(guest, data);
                    BuildGuestOptions(guest);
                    var event = angular.copy(vm.selectedEvent);
                    angular.extend(vm.selectedEvent, guest.event);
                    vm.selectedEvent.guests = event.guests;
                }).finally(function () {
                    vm.isBusy = false;
                });
        }

        vm.cancelGuest = function (guest) {
            service.cancelGuest(guest)
                .then(function (result) {
                    logger.log('result', result);
                    angular.extend(guest, result);
                    //BUG: Not changin options
                    BuildGuestOptions(guest);
                    var event = angular.copy(vm.selectedEvent);
                    angular.extend(vm.selectedEvent, result.event);
                    vm.selectedEvent.guests = event.guests;
                });
        }

        vm.changeEvent = function () {
            if (!vm.selectedEvent) return;
            //RESET VALUES
            vm.searchModel = {
                page: 1,
                pageSize: pageSizeDefault,
                orderBy: 'id',
                orderDirection: 'asc'
            };
            vm.showWaitList = false;
            vm.showMailQueue = false;
            vm.tabs[0].active = true;

            vm.isBusy = true;
            service.getById(vm.selectedEvent.id)
                .then(function (data) {
                    angular.extend(vm.selectedEvent, data);
                }).finally(function () {
                    vm.isBusy = false;
                    vm.searchGuests(tableStateRef);
                });

        }

        vm.refreshGuests = function () {
            vm.searchGuests(tableStateRef);
        }

        vm.deleteEvent = function (id) {
            vm.isBusy = true;
            service.remove(id)
                .then(function () {
                    logger.success('Deleted event');
                }).finally(function () {
                    vm.selectedEvent = undefined;
                    vm.isBusy = false;
                    getEvents();
                });
        }

        vm.exportGuests = function () {
            vm.isBusy = true;
            service.downloadGuests(vm.selectedEvent.id, vm.searchModel)
                .then(function (data) {
                    var contentType = data.headers()['content-type'];
                    var filename = data.headers()['x-filename'];

                    var linkElement = document.createElement('a');
                    try {
                        var blob = new Blob([data.data], { type: contentType });
                        var url = window.URL.createObjectURL(blob);

                        linkElement.setAttribute('href', url);
                        linkElement.setAttribute("download", filename);

                        var clickEvent = new MouseEvent("click", {
                            "view": window,
                            "bubbles": true,
                            "cancelable": false
                        });
                        linkElement.dispatchEvent(clickEvent);
                    } catch (ex) {
                        logger.log(ex);
                    }
                }).finally(function () {
                    vm.isBusy = false;
                });
        }

        vm.createGuest = function () {

            $modal.open({
                templateUrl: '/app/events/views/edit-guest.html',
                controller: 'CreateGuestController',
                controllerAs: 'vm',
                resolve: {
                    event: vm.selectedEvent
                }
            }).result.then(function (result) {
                var guest = result;
                BuildGuestOptions(guest);
                var event = angular.copy(vm.selectedEvent);
                angular.extend(vm.selectedEvent, result.event);
                vm.selectedEvent.guests = event.guests;
                vm.selectedEvent.guests.unshift(guest);
            });
        }

        function BuildGuestOptions(guest) {
            var options = [];

            if (guest.isAttending === null) options.push(choices[0]);
            if (guest.isAttending && !guest.isWaiting && !guest.isMailed) {
                options.push(choices[1]);
            }
            if (guest.isWaiting) {
                options.push(choices[3]);
            }
            if (guest.isAttending) {
                options.push(choices[4]);
            }
            if (guest.isAttending !== null) options.push(choices[2]);

            guest.primaryChoice = angular.copy(options[0]);
            options.shift();

            angular.extend(guest, { choices: options });
        }

        vm.registerGuest = function (guest) {
            guest.event = angular.copy(vm.selectedEvent);
            $modal.open({
                templateUrl: '/app/events/views/edit-guest.html',
                controller: 'EditGuestController',
                controllerAs: 'vm',
                resolve: {
                    guest: guest
                }
            }).result.then(function (result) {
                angular.extend(guest, result);
                BuildGuestOptions(guest);

                var event = angular.copy(vm.selectedEvent);
                angular.extend(vm.selectedEvent, result.event);
                vm.selectedEvent.guests = event.guests;
                guest = null;
            });
        }

        vm.toggleWaiting = function () {
            vm.showWaiting = !vm.showWaiting;
            vm.showMail = false;
            vm.showSent = false;
            vm.searchModel.page = 1;
            vm.searchGuests(tableStateRef);
        }

        vm.toggleMail = function () {
            vm.showMail = !vm.showMail;
            vm.showWaiting = false;
            vm.showSent = false;
            vm.searchModel.page = 1;
            vm.searchGuests(tableStateRef);
        }

        vm.toggleSent = function () {
            vm.showSent = !vm.showSent;
            vm.showWaiting = false;
            vm.showMail = false;
            vm.searchModel.page = 1;
            vm.searchGuests(tableStateRef);
        }

        vm.mailAllTickets = function () {
            vm.isBusy = true;
            service.mailAllTickets(vm.selectedEvent.id)
                .then(function (data) {
                    angular.extend(vm.selectedEvent, data);
                    vm.searchGuests(tableStateRef);
                    vm.isBusy = false;
                });
        }

        vm.mailTicket = function (guest) {
            vm.isBusy = true;
            service.mailTicket(guest)
                        .then(function (data) {
                            angular.extend(guest, data);
                            BuildGuestOptions(guest);

                            var event = angular.copy(vm.selectedEvent);
                            angular.extend(vm.selectedEvent, guest.event);
                            vm.selectedEvent.guests = event.guests;
                            logger.success('Mailed ticket to: ' + guest.name);

                        }).finally(function () {
                            vm.isBusy = false;
                        });
        }

        vm.searchGuests = function (tableState) {
            tableStateRef = tableState;
            if (!vm.selectedEvent) return false;

            if (tableState !== undefined) {
                if (typeof (tableState.sort.predicate) !== "undefined") {
                    vm.searchModel.orderBy = tableState.sort.predicate;
                    vm.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
                }
            }

            vm.searchModel.isAttending = null;
            vm.searchModel.isWaiting = null;
            vm.searchModel.isMailed = null;

            if (vm.showWaiting) {
                vm.searchModel.isWaiting = vm.showWaiting ? vm.showWaiting : null;
            }

            if (vm.showMail) {
                vm.searchModel.isWaiting = false;
                vm.searchModel.isMailed = false;
                vm.searchModel.isAttending = true;
            }

            if (vm.showSent) {
                vm.searchModel.isWaiting = false;
                vm.searchModel.isMailed = true;
                vm.searchModel.isAttending = true;
            }

            vm.isBusy = true;
            return service.getGuests(vm.selectedEvent.id, vm.searchModel)
                .then(function (data) {
                    var guests = data.items.map(function (guest) {
                        BuildGuestOptions(guest);
                        return guest;
                    });
                    vm.selectedEvent.guests = guests;
                    vm.searchModel = data;
                    vm.isBusy = false;
                });
        }

        vm.paged = function paged() {
            vm.searchGuests(tableStateRef);
        };

        vm.saveEvent = function (form) {
            vm.isBusy = true;
            return service.update(vm.selectedEvent)
                .then(function (data) {
                    var guests = vm.selectedEvent.guests;
                    angular.extend(vm.selectedEvent, data);

                    vm.selectedEvent.guests = guests;
                    logger.success('Saved Event: ' + data.name);
                })
                .finally(function () {
                    form.$setPristine();
                    vm.isBusy = false;
                });
        }

        vm.fileSelected = function ($files, $file) {
            var file = $file;

            var src = '';
            var reader = new FileReader();

            reader.onloadstart = function () {
                vm.isBusy = true;
            }

            reader.onload = function (e) {
                src = reader.result;
                vm.selectedEvent.template.image = reader.result;
                vm.selectedEvent.template.mimeType = file.type;
            }
            reader.onerror = function (e) {
                logger.log(e);
            }

            reader.onloadend = function (e) {
                vm.isBusy = false;
                //Added due to large images not complete before digest cycle. 
                $scope.$apply();
            };

            reader.readAsDataURL(file);
        };

        vm.saveTemplate = function () {
            vm.isBusy = true;
            templateService.update(vm.selectedEvent.template)
                .then(function (data) {
                    vm.selectedEvent.template = angular.extend(vm.selectedEvent.template, data);
                    logger.success('Saved template: ' + data.name);
                }).finally(function () {
                    vm.isBusy = false;
                });
        }

        vm.toggleCancel = function (form) {
            vm.selectedEvent.isCancelled = !vm.selectedEvent.isCancelled;
            vm.saveEvent(form).then(function () {
                if (vm.selectedEvent.isCancelled) {
                    logger.warning('Cancelled event');
                } else {
                    logger.info('Restored event');
                }
            });
        }

        vm.showCreateEvent = function () {
            $modal.open({
                templateUrl: '/app/events/views/create-event.html',
                controller: 'CreateEventController',
                controllerAs: 'vm'
            }).result.then(function (data) {
                vm.selectedEvent = data;
                vm.events.unshift(vm.selectedEvent);
                logger.success('Successfully created ' + data.name);
            });
        }

        vm.showGuestUpload = function () {
            $modal.open({
                keyboard: false,
                backdrop: 'static',
                templateUrl: '/app/events/views/guest-upload.html',
                //controller: ['logger', '$uibModalInstance', 'fileService', 'selectedEvent', UploadGuestController],
                controller: 'UploadGuestController',
                controllerAs: 'vm',
                resolve: {
                    event: vm.selectedEvent
                }
            }).result.then(function (result) {
                if (result.success) {
                    logger.success(result.message);
                } else {
                    logger.error(result.message);
                }
                vm.changeEvent();
            });
        }

        function getEvents() {
            vm.isBusy = true;
            return service.get()
                .then(function (data) {
                    vm.events = data;
                }).finally(function () {
                    vm.isBusy = false;
                });
        }




    };

})();
//mark.lawrence
//uploadGuest.controller.js

(function() {
	
    'use strict';

    var controllerId = 'UploadGuestController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$uibModalInstance', 'fileService', 'event'];

    function mainController(logger, $modal, service, event) {
        var vm = this;
        vm.title = 'Upload Guest List';

        vm.event = event;

        vm.cancel = function () {
            vm.file = undefined;
            $modal.dismiss();
        }

        vm.fileSelected = function ($file, $event) {
            vm.result = null;
        };
        
        vm.save = function () {
            vm.isBusy = true;
            vm.result = {
                success: false
            }

            service.guest(vm.event.id, vm.file)
                    .then(function (data) {
                        vm.result.success = true;
                        vm.result.message = data;
                    }).catch(function (error) {
                        vm.result.message = error.data.message;
                    }).finally(function () {
                        vm.file = undefined;
                        vm.isBusy = false;
                        $modal.close(vm.result);
                    });
        }
    }

})();
//app.filter.js
//mark.lawrence

angular.module('app.filter').filter('percentage', ['$filter', function ($filter) {
    return function (input, decimals) {
        return $filter('number')(input * 100, decimals) + '%';
    };
}]);

angular.module('app.filter', []).filter('checkmark', function () {
    return function (input) {
        return input ? '\u2713' : '\u2718';
    };
});

angular.module('app.filter').filter('yesNo', function () {
    return function (input) {
        return input ? 'Yes' : 'No';
    }
});

angular.module('app.filter').filter('updateStatus', function () {
    return function (input) {
        if (input === 1) {
            return 'Unchanged';
        }
        if (input === 2) {
            return 'Changed';
        }
        if (input === 6) {
            return 'Reconciled';
        }
        return "";
    };
});
//mark.lawrence
//mailer.controller.js

(function () {
    'use strict';

    var controllerId = 'MailerController';

    angular.module('app.mailer').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$uibModal', 'mailerService'];

    function mainController(logger, $modal, service) {
        var vm = this;
        var tableStateRef;
        var pageSizeDefault = 10;

        vm.title = 'MarkIt Manager';
        vm.subTitle = 'Mailers';

        vm.campaigns = [];
        vm.reasons = [];

        vm.mailers = [];
        vm.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'asc',
            suppress: false
        };

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            service.campaigns()
                .then(function (data) {
                    vm.campaigns = data;
                });

            service.reasons()
                .then(function (data) {
                    vm.reasons = data;
                });

            
        }

        vm.download = function () {
            vm.isBusy = true;
            service.download(vm.searchModel)
                .then(function (data) {
                    var contentType = data.headers()['content-type'];
                    var filename = data.headers()['x-filename'];

                    var linkElement = document.createElement('a');
                    try {
                        var blob = new Blob([data.data], { type: contentType });
                        var url = window.URL.createObjectURL(blob);

                        linkElement.setAttribute('href', url);
                        linkElement.setAttribute("download", filename);

                        var clickEvent = new MouseEvent("click", {
                            "view": window,
                            "bubbles": true,
                            "cancelable": false
                        });
                        linkElement.dispatchEvent(clickEvent);
                    } catch (ex) {
                        logger.log(ex);
                    }
                }).finally(function () {
                    vm.isBusy = false;
                });
        }

        vm.search = function (tableState) {
            tableStateRef = tableState;

            if (typeof (tableState.sort.predicate) !== "undefined") {
                vm.searchModel.orderBy = tableState.sort.predicate;
                vm.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }

            if (vm.searchModel.suppress === null) vm.searchModel.suppress = false; 

            vm.isBusy = true;
            service.query(vm.searchModel)
                .then(function (data) {
                    vm.mailers = data.items;
                    vm.searchModel = data;
                    vm.isBusy = false;
                });
        }

        vm.clickSearch = function() {
            vm.search(tableStateRef);
        }

        vm.showUpload = function () {
            $modal.open({
                keyboard: false,
                backdrop: 'static',
                templateUrl: '/app/mailer/views/mailer-upload.html',
                controller: 'UploadMailerController',
                controllerAs: 'vm',
                resolve: {
                    campaigns: function() { return vm.campaigns; }
                }
            })
            .result.then(function (result) {
                vm.campaigns = angular.extend(result.campaigns);

                if (result.success) {
                    logger.success(result.message);
                } else {
                    logger.error(result.message);
                }

            });
        }

        vm.paged = function paged(pageNum) {
            vm.search(tableStateRef);
        };

        vm.refresh = function () {
            service.campaigns()
               .then(function (data) {
                   vm.campaigns = data;
               });

            vm.search(tableStateRef);
        }

        vm.toggleFilter = function () {
            vm.showSuppress = !vm.showSuppress;
            vm.searchModel.suppress = vm.showSuppress;

            vm.searchModel.page = 1;
            vm.search(tableStateRef);
        }

        vm.toggleSuppress = function (mailer) {
            if (mailer.suppress) {
                mailer.suppress = false;
                mailer.reasonId = null;
                service.save(mailer)
                    .then(function(data) {
                        angular.extend(mailer, data);
                    });
            } else {
                $modal.open({
                        templateUrl: '/app/mailer/views/mailer-suppress.html',
                        controller: 'SuppressMailerController',
                        controllerAs: 'vm',
                        resolve: {
                            mailer: mailer,
                            reasons: function() { return vm.reasons }
                        }
                    })
                    .result.then(function(result) {
                        angular.extend(mailer, result);
                    });
            }

        }
    }

  

})();
//mark.lawrence
//suppressMailer.controller.js

(function () {

    'use strict';

    var controllerId = 'SuppressMailerController';

    angular.module('app.mailer').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$uibModalInstance', 'mailerService', 'mailer', 'reasons'];

    function mainController(logger, $modal, service, mailer, reasons) {
        var vm = this;
        vm.title = 'Mailer Suppress';
        vm.mailer = mailer;

        vm.reasons = reasons;

        vm.mailer.reasonId = vm.reasons[0].id;

        vm.cancel = function () {
            $modal.dismiss();
        }

        vm.cancel = function() {
            $modal.dismiss();
        }

        vm.save = function () {
            vm.mailer.suppress = true;
            service.save(vm.mailer).then(function (data) {
                angular.extend(mailer, data);
            });
            $modal.close(vm.mailer);
        }

    }

})();
//mark.lawrence
//uploadMailer.controller.js

(function () {

    'use strict';

    var controllerId = 'UploadMailerController';

    angular.module('app.mailer').controller(controllerId, mainController);

    //mainController.$inject = ['logger', '$uibModalInstance', 'fileService', 'campaigns'];
    mainController.$inject = ['logger', '$uibModalInstance', 'fileService', 'mailerService', 'campaigns'];

    function mainController(logger, $modal, service, mailerService, campaigns) {
        var vm = this;
        vm.title = 'Mailer Upload';

        vm.createNew = false;

        vm.campaigns = campaigns;

        vm.campaign = {

        };

        vm.cancel = function () {
            vm.file = undefined;
            $modal.dismiss();
        }

        vm.fileSelected = function ($file, $event) {
            vm.result = null;
        };

        vm.save = function () {
            vm.isBusy = true;
            vm.result = {
                success: false
            }

            service.mailer(vm.selectedCampaign.id, vm.file)
                .then(function (data) {
                    vm.result.success = true;
                    vm.result.message = data;
                })
                .catch(function (error) {
                    vm.result.message = error.data.message;
                })
                .finally(function () {
                    vm.file = undefined;
                    vm.isBusy = false;
                    vm.result.campaigns = vm.campaigns; 
                    $modal.close(vm.result);
                });
        }

        vm.createCampaign = function () {
            mailerService.createCampaign(vm.campaign)
                .then(function (data) {
                    vm.campaigns.unshift(data);
                    vm.selectedCampaign = data;
                    vm.createNew = false;
                });
        }
    }

})();
//mark.lawrence
//nav.js

(function () {
    'use strict';

    var controllerId = 'NavController';

    angular.module('app.nav').controller(controllerId, mainController);

    mainController.$inject = ['logger'];

    function mainController(logger) {
        var vm = this;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            vm.user = JSON.parse(localStorage.getItem('currentUser'));
        }
    };
})();
//user.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'constituentService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Constituent;

        var service = {
            get: get,
            query: query, 
            save: save, 
            addTax: addTax, 
            updateTax: updateTax, 
            removeTax: removeTax
        }

        return service;


        function get() {
            return $http.get(url).then(_success).catch(error);
        }

        function query(vm) {
            return $http.post(url + '/search', vm)
              .then(function (response) {
                  return response.data;
              });
        }

        function save(person) {
            return $http.put(url, person)
              .then(function (response) {
                  return response.data;
              });
        }

        function addTax(taxItem) {
            return $http.post(url + '/' + taxItem.constituentId + '/taxitem', taxItem)
           .then(function (response) {
               return response.data;
           });
        }

        function updateTax(taxItem) {
            return $http.put(url + '/' + taxItem.constituentId + '/taxitem', taxItem)
           .then(function (response) {
               return response.data;
           });
        }

        function removeTax(id) {
            return $http.delete(url + '/deletetax/' + id)
           .then(function (response) {
               return response.data;
           });
        }

        function _success(response) {
            return response.data;
        }

        function error(error) {
            return error.data.message;
        }
    }
})();
//template.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'demographicService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Demographic;

        var service = {
            get: get,
            remove: remove,
            removeAll: removeAll,
            query: query,
            exportList: exportList
        }

        return service;

        function get(page, size) {
            return $http.get(url + '?page=' + page + '&pagesize=' + size)
                .then(function (response) {
                    return response.data;
                });
        }

         function query(vm) {
            return $http.post(url + '/search', vm)
              .then(function (response) {
                  return response.data;
              });
        }
        
        function remove(id) {
            return $http.delete(url + '/' + id).then(_success).catch(error);
        }

        function removeAll() {
            return $http.delete(url).then(_success).catch(error);
        }

        function _success(response) {
            return response.data;
        };

        function error(error) {
            return error.data.message;
        }

        function exportList() {
            return $http.post(url + '/export')
              .then(function (data) {
                  return data;
              }).catch(error);
        }
    }
})();
//mark.lawrence
//event.service.js

(function () {
    'use strict';

    var serviceId = 'eventService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Event;
        var service = {
            cancelGuest: cancelGuest, 
            create: create,
            downloadGuests: downloadGuests, 
            remove: remove,
            get: get,
            getById: getById,
            getGuests: getGuests, 
            query: query,
            update: update,
            addToMail: addToMail, 
            registerGuest: registerGuest,
            mailTicket: mailTicket,
            mailAllTickets: mailAllTickets,
            addTicket: addTicket
        }
        return service;

        function cancelGuest(guest) {
            return $http.post(url + '/' + guest.eventId + '/CancelRegistration', guest).then(_success).catch(error);
        }

        function create(event) {
            return $http.post(url, event)
                .then(_success).catch(error);
        }

        function downloadGuests(id, vm) {
            return $http.post(url + '/' + id + '/guests/export', vm)
                .then(function(data) {
                    return data;
                }).catch(error);
        }


        function remove(id) {
            return $http.delete(url + '/' + id).then(_success).catch(error);
        }

        function get() {
            return $http.get(url)
                .then(_success).catch(error);
        }

        function getById(id) {
            return $http.get(url + '/' + id)
                .then(_success).catch(error);
        }

        function getGuests(id, vm) {
            return $http.post(url + '/' + id + '/guests', vm)
                .then(_success).catch(error);
        }

        function mailAllTickets(eventId) {
            return $http.put(url + '/' + eventId + '/mailalltickets').then(_success).catch(error);
        }

        function mailTicket(guest) {
            return $http.post(url + '/' + guest.eventId + '/mailticket', guest).then(_success).catch(error);
        }
        
        function addTicket(guest) {
            return $http.post(url + '/' + guest.eventId + '/addticket', guest).then(_success).catch(error);
        }

        function addToMail(guest) {
            return $http.post(url + '/' + guest.eventId + '/addtomail', guest).then(_success).catch(error);
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(_success).catch(error);
        }

        function registerGuest(guest) {
            return $http.post(url + '/' + guest.eventId + '/registerguest' , guest).then(_success).catch(error);
        }

        function update(event) {
            return $http.put(url, event)
                .then(_success).catch(error);
        }

        function _success(response) {
            return response.data;
        }

        function error(error) {
            return error.data.message; 
        }
    }
})();
//mark.lawrence
//file.service.js

(function () {

    'use strict';

    var serviceId = 'fileService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.File;

        var service = {
            guest: guest, 
            mailer: mailer
        }

        return service;

        function guest(id, datafile) {
            return $http.post(url + '/guest/' + id, formDataObject(datafile), {
                transformRequest: angular.identity,
                headers: { 'Content-Type': undefined }
            }).then(function (response) {
                return response.data;
            });
        }

        function mailer(id, datafile) {
            return $http.post(url + '/mailer/' + id, formDataObject(datafile), {
                transformRequest: angular.identity,
                headers: { 'Content-Type': undefined }
            }).then(function (response) {
                return response.data;
            });
        }

        function formDataObject(data) {
            var fd = new FormData();
            fd.append('file', data);
            return fd;
        }
    }
})();
//mark.lawrence
//guest.service.js

(function () {
    'use strict';

    var serviceId = 'guestService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Guest;

        var service = {
            create: create,
            remove: remove,
            get: get,
            getById: getById,
            update: update,
            query: query
        }

        return service;

        function create(event) {
            return $http.post(url, event)
                .then(function (response) {
                    return response.data;
                });
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        }

        function get() {
            return $http.get(url)
                .then(function (response) {
                    return response.data;
                });
        }

        function getById(id) {
            return $http.get(url + '/' + id)
                .then(function (response) {
                    return response.data;
                });
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(function (response) {
                    return response.data;
                });
        }

        function update(event) {
            return $http.put(url, event)
                .then(function (response) {
                    return response.data;
                });
        }

        function _success(response) {
            return response.data;
        }
    }
})();
//user.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'mailerService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Mailer;

        var service = {
            get: get,
            query: query,
            download: download, 
            campaigns: campaigns, 
            reasons: reasons, 
            save: save, 
            createCampaign: createCampaign
        }

        return service;


        function get() {
            return $http.get(url).then(_success).catch(error);
        }

        function query(vm) {
            return $http.post(url + '/search', vm)
              .then(function (response) {
                  return response.data;
              });
        }

        function download(vm) {
            return $http.post(url + '/export', vm)
            .then(function (data) {
                return data;
            }).catch(error);
        }

        function campaigns() {
            return $http.get(url + '/campaigns').then(_success).catch(error);
        }

        function createCampaign(name) {
            return $http.post(url + '/createcampaign', name).then(_success).catch(error);
        }

        function reasons() {
            return $http.get(url + '/reasons').then(_success).catch(error);
        }

        function save(mailer) {
            return $http.put(url, mailer).then(_success).catch(error);
        }

        function _success(response) {
            return response.data;
        }

        function error(error) {
            return error.data.message;
        }
    }
})();
//template.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'templateService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Template;

        var service = {
            get: get,
            update: update,
            query: query
            //            remove: remove,
            //            save: save,
            //            search: search,
        }

        return service;

        function get() {
            return $http.get(url)
                .then(function (response) {
                    return response.data;
                });
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(function (response) {
                    return response.data;
                });
        }

        function update(template) {
            return $http.put(url, template)
                .then(function (response) {
                    return response.data;
                });
        }
    }
})();
//user.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'userService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.User;

        var service = {
            availableRoles: availableRoles,
            create: create,
            get: get,
            query: query,
            remove: remove,
            update: update
        }

        return service;

        function availableRoles() {
            return $http.get(url + '/roles').then(_success);
        }

        function create(user) {
            return $http.post(url, user).then(_success, function (error) {
                logger.log('error', error);
            });
        }

        function get() {
            return $http.get(url).then(_success);
        }

        function query(searchTerm) {
            var term = searchTerm === null ? '' : searchTerm;
            var searchUrl = url + '/search/' + term;

            return $http.get(searchUrl).then(_success);
        }

        function update(user) {
            return $http.put(url, user).then(_success);
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        }

        function _success(response) {
            return response.data;
        }
    }
})();
(function () {
    'use strict'; 

    var controllerId = 'UserController';

    angular.module('app.users').controller(controllerId, UserController);

    UserController.$inject = ['logger', 'userService', 'defaults', 'config'];

    function UserController(logger, service, defaults, config) {
        var vm = this;
        vm.title = 'User Manager';
        vm.subTitle = 'Users';

        vm.description = 'Edit and update users';
        var keyCodes = config.keyCodes;

        vm.availableRoles = [];
        vm.clearCreate = clearCreate;
        vm.currentEdit = {};
        vm.isBusy = false;
        vm.lastDeleted = null;
        vm.lastUpdated = null;
        vm.itemToEdit = {};

        vm.user = {
            //userName: null,
            roles: ['user'],
            fullName: '',
            password: defaults.GENERIC_PASSWORD
        };

        vm.searchModel = {
            searchTerm: ''
        }

        var tableStateRef;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            getAvailableRoles();
        };

        vm.addItem = function () {
            vm.user.fullName = parseFullName(vm.user.userName);
            vm.user.email = vm.user.userName + defaults.EMAIL_SUFFIX;
            service.create(vm.user)
                .then(function (data) {
                    //TODO: mapping would allow removal of extend method
                    vm.user = angular.extend(vm.user, data);
                    vm.users.unshift(angular.copy(vm.user));
                    logger.success('User ' + vm.user.userName + ' created!');
                    vm.user.userName = null;
                    //TODO: show error user already exists
                });
        };

        vm.cancelEdit = function (id) {
            vm.currentEdit[id] = false;
        };

        vm.deleteItem = function (user) {
            angular.copy(user, vm.lastDeleted = {});
            service.remove(user.id)
                .then(function (data) {
                    var idx = vm.users.indexOf(user);
                    vm.users.splice(idx, 1);
                });
        };

        vm.editItem = function (user) {
            vm.currentEdit[user.id] = true;
            angular.copy(user, vm.itemToEdit = {});
        };

        function getAvailableRoles() {
            service.availableRoles()
                .then(function (data) {
                    vm.availableRoles = data;
                });
        };

        vm.saveItem = function (user) {
            vm.isBusy = true;

            vm.currentEdit[user.id] = false;
            angular.copy(user, vm.lastUpdated = {});
            var roles = [];

            _.forEach(vm.itemToEdit.roles,
                function (role) {
                    roles.push(role.name);
                });
            vm.itemToEdit.roles = roles;

            service.update(vm.itemToEdit)
                .then(function (data) {
                    angular.extend(user, data);
                    logger.success('User ' + data.userName + ' updated!');
                    vm.isBusy = false;
                });
        };

        vm.search = function (tableState) {
            tableStateRef = tableState;
            if (vm.searchModel.searchTerm === undefined) vm.searchModel.searchTerm = '';

            vm.isBusy = true;
            service.query(vm.searchModel.searchTerm)
                .then(function (data) {
                    vm.users = data;
                })
                .finally(function () {
                    vm.isBusy = false;
                });
        };

        vm.undoDelete = function () {
            var roles = [];

            _.forEach(vm.lastDeleted.roles, function (role) {
                roles.push(role.name);
                logger.log('role', role.name);
            });
            vm.lastDeleted.roles = roles;
            vm.lastDeleted.password = defaults.GENERIC_PASSWORD;

            service.create(vm.lastDeleted).then(function (data) {
                logger.success('Successfully restored ' + data.userName);
                vm.users.unshift(data);
                vm.lastDeleted = null;
            });
        };

        vm.undoChange = function () {
            vm.isBusy = true;

            service.update(vm.lastUpdated)
                .then(function (data) {
                    angular.forEach(vm.users,
                        function (u, i) {
                            if (u.id === vm.lastUpdated.id) {
                                vm.users[i] = vm.lastUpdated;
                            }
                        });
                    logger.success('Successfully restored ' + data.userName);
                    vm.lastUpdated = null;
                })
                .finally(function () {
                    vm.isBusy = false;
                });
        };

        function clearCreate($event) {
            if ($event.keyCode === keyCodes.esc) {
                vm.user.userName = '';
            };
        };

        function parseFullName(name) {
            var arr = name.split('.');
            var fullname = '';

            _.forEach(arr, function (v) {
                fullname += _.capitalize(v) + ' ';
            });

            return _.trim(fullname);
        };
    };
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb3JlL2NvcmUubW9kdWxlLmpzIiwiY29yZS9jb25maWcuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5tb2R1bGUuanMiLCJibG9ja3MvbG9nZ2VyL2xvZ2dlci5tb2R1bGUuanMiLCJkZW1vZ3JhcGhpY3MvZGVtb2dyYXBoaWNzLm1vZHVsZS5qcyIsImRvbm9ydGF4L2Rvbm9ydGF4Lm1vZHVsZS5qcyIsImV2ZW50cy9ldmVudC5tb2R1bGUuanMiLCJmaWx0ZXJzL2ZpbHRlci5tb2R1bGUuanMiLCJtYWlsZXIvbWFpbGVyLm1vZHVsZS5qcyIsIm5hdi9uYXYubW9kdWxlLmpzIiwic2VydmljZXMvc2VydmljZS5tb2R1bGUuanMiLCJ1c2Vycy91c2Vycy5tb2R1bGUuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi1oYW5kbGVyLnByb3ZpZGVyLmpzIiwiYmxvY2tzL2V4Y2VwdGlvbi9leGNlcHRpb24uanMiLCJibG9ja3MvbG9nZ2VyL2xvZ2dlci5qcyIsImRlbW9ncmFwaGljcy9kZW1vZ3JhcGhpY3MuY29udHJvbGxlci5qcyIsImRpcmVjdGl2ZXMvY2xlYXIta2V5LmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvZGF0ZS1iZWZvcmUuanMiLCJkaXJlY3RpdmVzL2RhdGUtZm9ybWF0LmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvZGF0ZS1pbnB1dC5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL3NtYXJ0LXRhYmxlLmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvdG9nZ2xlQ2hlY2tib3guZGlyZWN0aXZlLmpzIiwiZG9ub3J0YXgvZG9ub3J0YXguY29udHJvbGxlci5qcyIsImRvbm9ydGF4L2VkaXRDb25zdGl0dWVudC5jb250cm9sbGVyLmpzIiwiZG9ub3J0YXgvdGF4SXRlbXMuY29udHJvbGxlci5qcyIsImVudi5qcyIsImV2ZW50cy9jcmVhdGVFdmVudC5jb250cm9sbGVyLmpzIiwiZXZlbnRzL2NyZWF0ZUd1ZXN0LmNvbnRyb2xsZXIuanMiLCJldmVudHMvZWRpdEd1ZXN0LmNvbnRyb2xsZXIuanMiLCJldmVudHMvZXZlbnRzLmNvbnRyb2xsZXIuanMiLCJldmVudHMvdXBsb2FkR3Vlc3QuY29udHJvbGxlci5qcyIsImZpbHRlcnMvYXBwLmZpbHRlcnMuanMiLCJtYWlsZXIvbWFpbGVyLmNvbnRyb2xsZXIuanMiLCJtYWlsZXIvc3VwcHJlc3NNYWlsZXIuY29udHJvbGxlci5qcyIsIm1haWxlci91cGxvYWRNYWlsZXIuY29udHJvbGxlci5qcyIsIm5hdi9uYXYuanMiLCJzZXJ2aWNlcy9jb25zdGl0dWVudC5zZXJ2aWNlLmpzIiwic2VydmljZXMvZGVtb2dyYXBoaWMuc2VydmljZS5qcyIsInNlcnZpY2VzL2V2ZW50LnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9maWxlLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy9ndWVzdC5zZXJ2aWNlLmpzIiwic2VydmljZXMvbWFpbGVyLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy90ZW1wbGF0ZS5zZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlci5zZXJ2aWNlLmpzIiwidXNlcnMvdXNlcnMuY29udHJvbGxlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcmJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0tBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1vZHVsZXMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9tYXJrLmxhd3JlbmNlXHJcbi8vYXBwLm1vZHVsZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnLFxyXG4gICAgW1xyXG4gICAgICAgIC8vYXBwbGljYXRpb24gbW9kdWxlc1xyXG4gICAgICAgICdhcHAuY29yZScsXHJcbiAgICAgICAgJ2FwcC5zZXJ2aWNlJyxcclxuICAgICAgICAnYXBwLmZpbHRlcicsXHJcblxyXG4gICAgICAgIC8vZmVhdHVyZSBhcmVhc1xyXG4gICAgICAgICdhcHAubmF2JyxcclxuICAgICAgICAnYXBwLnVzZXJzJyxcclxuICAgICAgICAnYXBwLmV2ZW50cycsIFxyXG4gICAgICAgICdhcHAuZGVtb2dyYXBoaWNzJyxcclxuICAgICAgICAnYXBwLmRvbm9ydGF4JyxcclxuICAgICAgICAnYXBwLm1haWxlcidcclxuICAgICAgICBcclxuICAgIF0pO1xyXG59KSgpOyIsIi8vY29yZS5tb2R1bGUuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJyxcclxuICAgICAgICBbXHJcbiAgICAgICAgICAgIC8vYW5ndWxhciBtb2R1bGVzXHJcbiAgICAgICAgICAgICduZ01lc3NhZ2VzJyxcclxuICAgICAgICAgICAgJ2FuZ3VsYXJMb2NhbFN0b3JhZ2UnLFxyXG4gICAgICAgICAgICAnbmdSb3V0ZScsXHJcbiAgICAgICAgICAgICduZ0FuaW1hdGUnLFxyXG5cclxuICAgICAgICAgICAgLy9jdXN0b20gbW9kdWxlc1xyXG4gICAgICAgICAgICAnYmxvY2tzLmxvZ2dlcicsXHJcbiAgICAgICAgICAgICdibG9ja3MuZXhjZXB0aW9uJyxcclxuXHJcbiAgICAgICAgICAgIC8vdGhpcmQgcGFydHkgbW9kdWxlc1xyXG4gICAgICAgICAgICAnc21hcnQtdGFibGUnLFxyXG4gICAgICAgICAgICAndWkuYm9vdHN0cmFwJyxcclxuICAgICAgICAgICAgJ25nVGFnc0lucHV0JyxcclxuICAgICAgICAgICAgJ25nRmlsZVVwbG9hZCcsXHJcbiAgICAgICAgICAgICdyek1vZHVsZScsXHJcbiAgICAgICAgICAgICdzd2l0Y2hlcicsXHJcbiAgICAgICAgICAgICdnZmwudGV4dEF2YXRhcicsXHJcbiAgICAgICAgICAgICd0ZXh0QW5ndWxhcicsXHJcbiAgICAgICAgICAgICd1aS5ib290c3RyYXAuZGF0ZXRpbWVwaWNrZXInLFxyXG4gICAgICAgICAgICAnYW5ndWxhci1jb25maXJtJ1xyXG4gICAgICAgIF0pXHJcbiAgICAgICAgLmNvbnN0YW50KCd0b2FzdHInLCB0b2FzdHIpXHJcbiAgICAgICAgLmNvbnN0YW50KCdtb21lbnQnLCBtb21lbnQpXHJcbiAgICAgICAgLmNvbmZpZyhmdW5jdGlvbiAoc3RDb25maWcpIHtcclxuICAgICAgICAgICAgc3RDb25maWcuc2VhcmNoLmRlbGF5ID0gMjAwMDtcclxuICAgICAgICB9KTtcclxuXHJcbn0pKCk7IiwiLy9jb25maWcuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiB0b2FzdHJDb25maWcodG9hc3RyKSB7XHJcbiAgICAgICAgdG9hc3RyLm9wdGlvbnMudGltZU91dCA9IDQwMDA7XHJcbiAgICAgICAgdG9hc3RyLm9wdGlvbnMucG9zaXRpb25DbGFzcyA9ICd0b2FzdC1ib3R0b20tcmlnaHQnO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIga2V5Q29kZXMgPSB7XHJcbiAgICAgICAgYmFja3NwYWNlOiA4LFxyXG4gICAgICAgIHRhYjogOSxcclxuICAgICAgICBlbnRlcjogMTMsXHJcbiAgICAgICAgZXNjOiAyNyxcclxuICAgICAgICBzcGFjZTogMzIsXHJcbiAgICAgICAgcGFnZXVwOiAzMyxcclxuICAgICAgICBwYWdlZG93bjogMzQsXHJcbiAgICAgICAgZW5kOiAzNSxcclxuICAgICAgICBob21lOiAzNixcclxuICAgICAgICBsZWZ0OiAzNyxcclxuICAgICAgICB1cDogMzgsXHJcbiAgICAgICAgcmlnaHQ6IDM5LFxyXG4gICAgICAgIGRvd246IDQwLFxyXG4gICAgICAgIGluc2VydDogNDUsXHJcbiAgICAgICAgZGVsOiA0NlxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgYXBpRW5kUG9pbnRzID0ge1xyXG4gICAgICAgIFVzZXI6ICd1c2VycycsXHJcbiAgICAgICAgQ29uc3RpdHVlbnQ6ICdjb25zdGl0dWVudCcsXHJcbiAgICAgICAgVGF4OiAndGF4JyxcclxuICAgICAgICBUZW1wbGF0ZTogJ3RlbXBsYXRlJyxcclxuICAgICAgICBDYW1wYWlnbjogJ2NhbXBhaWduJyxcclxuICAgICAgICBNYWlsZXI6ICdtYWlsZXInLFxyXG4gICAgICAgIFJlYXNvbjogJ3JlYXNvbicsXHJcbiAgICAgICAgRXZlbnQ6ICdldmVudCcsXHJcbiAgICAgICAgR3Vlc3Q6ICdndWVzdCcsXHJcbiAgICAgICAgRmlsZTogJ2ZpbGUnLCBcclxuICAgICAgICBEZW1vZ3JhcGhpYzogJ2RlbW9ncmFwaGljcydcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGNvbmZpZyA9IHtcclxuICAgICAgICBhcHBFcnJvclByZWZpeDogJ1tERyBFcnJvcl0gJywgLy9Db25maWd1cmUgdGhlIGV4Y2VwdGlvbkhhbmRsZXIgZGVjb3JhdG9yXHJcbiAgICAgICAgYXBwVGl0bGU6ICdEb25vckdhdGV3YXknLFxyXG4gICAgICAgIHZlcnNpb246ICcxLjAuMCcsXHJcbiAgICAgICAgYXBpVXJsOiAnaHR0cDovLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArICcvYXBpLycsXHJcbiAgICAgICAga2V5Q29kZXM6IGtleUNvZGVzLFxyXG4gICAgICAgIGFwaUVuZFBvaW50czogYXBpRW5kUG9pbnRzXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBkZWZhdWx0cyA9IHtcclxuICAgICAgICBFTUFJTF9TVUZGSVg6ICdAc3BsY2VudGVyLm9yZycsXHJcbiAgICAgICAgR0VORVJJQ19QQVNTV09SRDogJzFQQHNzd29yZCdcclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJylcclxuICAgICAgICAuY29uZmlnKHRvYXN0ckNvbmZpZylcclxuICAgICAgICAuY29uc3RhbnQoJ2NvbmZpZycsIGNvbmZpZylcclxuICAgICAgICAudmFsdWUoJ2RlZmF1bHRzJywgZGVmYXVsdHMpO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V4Y2VwdGlvbi5tb2R1bGUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicsIFsnYmxvY2tzLmxvZ2dlciddKTtcclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdibG9ja3MubG9nZ2VyJywgW10pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2RlbW9ncmFwaGljcy5tb2R1bGUuanNcclxuXHJcbihmdW5jdGlvbigpIHtcclxuXHRcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmRlbW9ncmFwaGljcycsIFtdKTtcclxuXHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZG9ub3J0YXgubW9kdWxlLmpzXHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmRvbm9ydGF4JywgW10pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V2ZW50Lm1vZHVsZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuZXZlbnRzJywgW10pO1xyXG59KSgpOyIsIi8vZmlsdGVyLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmZpbHRlcicsIFtdKTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9tYWlsZXIubW9kdWxlLmpzXHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm1haWxlcicsIFtdKTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9uYXYubW9kdWxlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5uYXYnLCBbXSk7XHJcbn0pKCk7IiwiLy9zZXJ2aWNlLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnLCBbXSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJzJywgW10pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V4Y2VwdGlvbi1oYW5kbGVyLnByb3ZpZGVyLmpzXHJcblxyXG4vLyBJbmNsdWRlIGluIGluZGV4Lmh0bWwgc28gdGhhdCBhcHAgbGV2ZWwgZXhjZXB0aW9ucyBhcmUgaGFuZGxlZC5cclxuLy8gRXhjbHVkZSBmcm9tIHRlc3RSdW5uZXIuaHRtbCB3aGljaCBzaG91bGQgcnVuIGV4YWN0bHkgd2hhdCBpdCB3YW50cyB0byBydW5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicpXHJcbiAgICAgICAgLnByb3ZpZGVyKCdleGNlcHRpb25IYW5kbGVyJywgZXhjZXB0aW9uSGFuZGxlclByb3ZpZGVyKVxyXG4gICAgICAgIC5jb25maWcoY29uZmlnKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIE11c3QgY29uZmlndXJlIHRoZSBleGNlcHRpb24gaGFuZGxpbmdcclxuICAgICAqIEByZXR1cm4ge1t0eXBlXX1cclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gZXhjZXB0aW9uSGFuZGxlclByb3ZpZGVyKCkge1xyXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xyXG4gICAgICAgIHRoaXMuY29uZmlnID0ge1xyXG4gICAgICAgICAgICBhcHBFcnJvclByZWZpeDogdW5kZWZpbmVkXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmUgPSBmdW5jdGlvbiAoYXBwRXJyb3JQcmVmaXgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25maWcuYXBwRXJyb3JQcmVmaXggPSBhcHBFcnJvclByZWZpeDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLiRnZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IGNvbmZpZzogdGhpcy5jb25maWcgfTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIENvbmZpZ3VyZSBieSBzZXR0aW5nIGFuIG9wdGlvbmFsIHN0cmluZyB2YWx1ZSBmb3IgYXBwRXJyb3JQcmVmaXguXHJcbiAgICAgKiBBY2Nlc3NpYmxlIHZpYSBjb25maWcuYXBwRXJyb3JQcmVmaXggKHZpYSBjb25maWcgdmFsdWUpLlxyXG4gICAgICogQHBhcmFtICB7W3R5cGVdfSAkcHJvdmlkZVxyXG4gICAgICogQHJldHVybiB7W3R5cGVdfVxyXG4gICAgICogQG5nSW5qZWN0XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGNvbmZpZygkcHJvdmlkZSkge1xyXG4gICAgICAgICRwcm92aWRlLmRlY29yYXRvcignJGV4Y2VwdGlvbkhhbmRsZXInLCBleHRlbmRFeGNlcHRpb25IYW5kbGVyKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeHRlbmQgdGhlICRleGNlcHRpb25IYW5kbGVyIHNlcnZpY2UgdG8gYWxzbyBkaXNwbGF5IGEgdG9hc3QuXHJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9ICRkZWxlZ2F0ZVxyXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBleGNlcHRpb25IYW5kbGVyXHJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGxvZ2dlclxyXG4gICAgICogQHJldHVybiB7RnVuY3Rpb259IHRoZSBkZWNvcmF0ZWQgJGV4Y2VwdGlvbkhhbmRsZXIgc2VydmljZVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBleHRlbmRFeGNlcHRpb25IYW5kbGVyKCRkZWxlZ2F0ZSwgZXhjZXB0aW9uSGFuZGxlciwgbG9nZ2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChleGNlcHRpb24sIGNhdXNlKSB7XHJcbiAgICAgICAgICAgIHZhciBhcHBFcnJvclByZWZpeCA9IGV4Y2VwdGlvbkhhbmRsZXIuY29uZmlnLmFwcEVycm9yUHJlZml4IHx8ICcnO1xyXG4gICAgICAgICAgICB2YXIgZXJyb3JEYXRhID0geyBleGNlcHRpb246IGV4Y2VwdGlvbiwgY2F1c2U6IGNhdXNlIH07XHJcbiAgICAgICAgICAgIGV4Y2VwdGlvbi5tZXNzYWdlID0gYXBwRXJyb3JQcmVmaXggKyBleGNlcHRpb24ubWVzc2FnZTtcclxuICAgICAgICAgICAgJGRlbGVnYXRlKGV4Y2VwdGlvbiwgY2F1c2UpO1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQ291bGQgYWRkIHRoZSBlcnJvciB0byBhIHNlcnZpY2UncyBjb2xsZWN0aW9uLFxyXG4gICAgICAgICAgICAgKiBhZGQgZXJyb3JzIHRvICRyb290U2NvcGUsIGxvZyBlcnJvcnMgdG8gcmVtb3RlIHdlYiBzZXJ2ZXIsXHJcbiAgICAgICAgICAgICAqIG9yIGxvZyBsb2NhbGx5LiBPciB0aHJvdyBoYXJkLiBJdCBpcyBlbnRpcmVseSB1cCB0byB5b3UuXHJcbiAgICAgICAgICAgICAqIHRocm93IGV4Y2VwdGlvbjtcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogQGV4YW1wbGVcclxuICAgICAgICAgICAgICogICAgIHRocm93IHsgbWVzc2FnZTogJ2Vycm9yIG1lc3NhZ2Ugd2UgYWRkZWQnIH07XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXhjZXB0aW9uLm1lc3NhZ2UsIGVycm9yRGF0YSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZXhjZXB0aW9uLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdibG9ja3MuZXhjZXB0aW9uJylcclxuICAgICAgICAuZmFjdG9yeSgnZXhjZXB0aW9uJywgZXhjZXB0aW9uKTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIGV4Y2VwdGlvbihsb2dnZXIpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgY2F0Y2hlcjogY2F0Y2hlclxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYXRjaGVyKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihtZXNzYWdlLCByZWFzb24pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2xvZ2dlci5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmxvY2tzLmxvZ2dlcicpLmZhY3RvcnkoJ2xvZ2dlcicsIGxvZ2dlcik7XHJcblxyXG4gICAgbG9nZ2VyLiRpbmplY3QgPSBbJyRsb2cnLCAndG9hc3RyJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbG9nZ2VyKCRsb2csIHRvYXN0cikge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBzaG93VG9hc3RzOiB0cnVlLFxyXG5cclxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLFxyXG4gICAgICAgICAgICBpbmZvOiBpbmZvLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBzdWNjZXNzLFxyXG4gICAgICAgICAgICB3YXJuaW5nOiB3YXJuaW5nLFxyXG5cclxuICAgICAgICAgICAgLy8gc3RyYWlnaHQgdG8gY29uc29sZTsgYnlwYXNzIHRvYXN0clxyXG4gICAgICAgICAgICBsb2c6ICRsb2cubG9nXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5lcnJvcihtZXNzYWdlLCB0aXRsZSk7XHJcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAnICsgbWVzc2FnZSwgZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpbmZvKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5pbmZvKG1lc3NhZ2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgJGxvZy5pbmZvKCdJbmZvOiAnICsgbWVzc2FnZSwgZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKG1lc3NhZ2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgJGxvZy5pbmZvKCdTdWNjZXNzOiAnICsgbWVzc2FnZSwgZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB3YXJuaW5nKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci53YXJuaW5nKG1lc3NhZ2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgJGxvZy53YXJuKCdXYXJuaW5nOiAnICsgbWVzc2FnZSwgZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9kZW1vZ3JhcGhpY3MuanNcclxuXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JzsgXHJcblxyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdEZW1vZ3JhcGhpY3NDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmRlbW9ncmFwaGljcycpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBVc2VyQ29udHJvbGxlcik7XHJcblxyXG4gICAgVXNlckNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJywgJ2RlbW9ncmFwaGljU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFVzZXJDb250cm9sbGVyKGxvZ2dlciwgc2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xyXG5cclxuICAgICAgICB2bS50aXRsZSA9ICdEZW1vZ3JhcGhpYyBVcGRhdGVzJztcclxuICAgICAgICB2bS5kZXNjcmlwdGlvbiA9ICdVcGRhdGVzIG1hZGUgdG8gY29uc3RpdHVlbnQgZGF0YSc7IFxyXG4gICAgICAgIHZtLnN1YlRpdGxlID0gJ0RlbW9ncmFwaGljcyc7XHJcblxyXG4gICAgICAgIHZtLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVEZWZhdWx0LFxyXG4gICAgICAgICAgICBvcmRlckJ5OiAnaWQnLFxyXG4gICAgICAgICAgICBvcmRlckRpcmVjdGlvbjogJ2FzYydcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5kZW1vZ3JhcGhpY3MgPSBbXTtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zZWFyY2ggPSBmdW5jdGlvbiAodGFibGVTdGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0YWJsZVN0YXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGUpICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwub3JkZXJCeSA9IHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwub3JkZXJEaXJlY3Rpb24gPSB0YWJsZVN0YXRlLnNvcnQucmV2ZXJzZSA/ICdkZXNjJyA6ICdhc2MnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnF1ZXJ5KHZtLnNlYXJjaE1vZGVsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5kZW1vZ3JhcGhpY3MgPSBkYXRhLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5tYW51YWwgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLm1hbnVhbFNlYXJjaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZygnbWFudWFsJyk7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnBhZ2VkID0gZnVuY3Rpb24gcGFnZWQocGFnZU51bSkge1xyXG4gICAgICAgICAgICB2bS5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZGVsZXRlID0gZnVuY3Rpb24oZGVtbykge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnJlbW92ZShkZW1vLmlkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnRGVsZXRlZCAnICsgZGVtby5uYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gdm0uZGVtb2dyYXBoaWNzLmluZGV4T2YoZGVtbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZGVtb2dyYXBoaWNzLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTsgXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmRlbGV0ZUFsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VydmljZS5yZW1vdmVBbGwoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5kZW1vZ3JhcGhpY3MgPSBbXTsgXHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmV4cG9ydCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VydmljZS5leHBvcnRMaXN0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRUeXBlID0gZGF0YS5oZWFkZXJzKClbJ2NvbnRlbnQtdHlwZSddO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEuaGVhZGVycygpWyd4LWZpbGVuYW1lJ107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsaW5rRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtkYXRhLmRhdGFdLCB7IHR5cGU6IGNvbnRlbnRUeXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB1cmwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBmaWxlbmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xpY2tFdmVudCA9IG5ldyBNb3VzZUV2ZW50KFwiY2xpY2tcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2aWV3XCI6IHdpbmRvdyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYnViYmxlc1wiOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjYW5jZWxhYmxlXCI6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5kaXNwYXRjaEV2ZW50KGNsaWNrRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9jbGVhci1rZXkuZGlyZWN0aXZlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZShcImNsZWFyS2V5XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgZWwub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggIT09IDI3KSB7IHJldHVybjsgfSAvLyBjaGVjayBrZXkgaG93IHlvdSB3YW50XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0Vmlld1ZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJHJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZGF0ZS1iZWZvcmUuZGlyZWN0aXZlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnZGF0ZUJlZm9yZScsIGZ1bmN0aW9uICgkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVxdWlyZTogJ15uZ01vZGVsJyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtLCBhdHRycywgbmdNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFuZ01vZGVsKSByZXR1cm47IC8vIGRvIG5vdGhpbmcgaWYgbm8gbmctbW9kZWxcclxuICAgICAgICAgICAgICAgIGRlYnVnZ2VyO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGVCZWZvcmUgPSBhdHRycy5kYXRlQmVmb3JlO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2RhdGUnLCBkYXRlQmVmb3JlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyB3YXRjaCBvd24gdmFsdWUgYW5kIHJlLXZhbGlkYXRlIG9uIGNoYW5nZVxyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKGF0dHJzLm5nTW9kZWwsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gb2JzZXJ2ZSB0aGUgb3RoZXIgdmFsdWUgYW5kIHJlLXZhbGlkYXRlIG9uIGNoYW5nZVxyXG4gICAgICAgICAgICAgICAgYXR0cnMuJG9ic2VydmUoJ2RhdGVHcmVhdGVyQW5kRXF1YWwnLCBmdW5jdGlvbiAodmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB2YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB2YWx1ZXNcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZVRvID0gYW5ndWxhci5pc0RlZmluZWQobmdNb2RlbC4kdmlld1ZhbHVlKSA9PT0gdHJ1ZSAmJiAhXy5pc051bGwobmdNb2RlbC4kdmlld1ZhbHVlKSA/IG1vbWVudChuZ01vZGVsLiR2aWV3VmFsdWUpLnRvRGF0ZSgpIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZUZyb20gPSBhdHRycy5kYXRlR3JlYXRlckFuZEVxdWFsICE9PSBcIlwiID8gbW9tZW50KGF0dHJzLmRhdGVHcmVhdGVyQW5kRXF1YWwucmVwbGFjZSgnXCInLCAnJykucmVwbGFjZSgnXFxcXCcsICcnKS5yZXBsYWNlKCdcIicsICcnKSkudG9EYXRlKCkgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vcGFzc2luZyBkYXRlIHdpdGggYnJhY2VzIGFyb3VuZCBpdCBjYXVzZXMgYW5kIGlzc3VlIHRoZXJmb3JlIHdlIG5lZWQgdG8gdXNlIHJlcGxhY2VcclxuXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG5cclxuXHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZGF0ZS1mb3JtYXQuZGlyZWN0aXZlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnZGF0ZUZvcm1hdCcsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkYXRlRmlsdGVyLCAkcGFyc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQUMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmU6ICc/bmdNb2RlbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgbmdNb2RlbCwgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRwYXJzZXJzLnB1c2goZnVuY3Rpb24gKHZpZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVGaWx0ZXIodmlld1ZhbHVlLCAnTU0vZGQveXl5eSBoOm1tIGEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9kYXRlLWlucHV0LmRpcmVjdGl2ZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2RhdGVJbnB1dCcsIGZ1bmN0aW9uICgkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVxdWlyZTogJ15uZ01vZGVsJyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbW9tZW50ID0gJHdpbmRvdy5tb21lbnQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0ZUZvcm1hdCA9IGF0dHJzLmRhdGVJbnB1dDtcclxuICAgICAgICAgICAgICAgIGF0dHJzLiRvYnNlcnZlKCdkYXRlSW5wdXQnLCBmdW5jdGlvbiAobmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0ZUZvcm1hdCA9PT0gbmV3VmFsdWUgfHwgIWN0cmwuJG1vZGVsVmFsdWUpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICBkYXRlRm9ybWF0ID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC4kbW9kZWxWYWx1ZSA9IG5ldyBEYXRlKGN0cmwuJHNldFZpZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjdHJsLiRmb3JtYXR0ZXJzLnVuc2hpZnQoZnVuY3Rpb24gKG1vZGVsVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZSA9IHNjb3BlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZGF0ZUZvcm1hdCB8fCAhbW9kZWxWYWx1ZSkgcmV0dXJuIFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldFZhbCA9IG1vbWVudChtb2RlbFZhbHVlKS5mb3JtYXQoZGF0ZUZvcm1hdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGN0cmwuJHBhcnNlcnMudW5zaGlmdChmdW5jdGlvbiAodmlld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBzY29wZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG1vbWVudCh2aWV3VmFsdWUsIGRhdGVGb3JtYXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGF0ZSAmJiBkYXRlLmlzVmFsaWQoKSAmJiBkYXRlLnllYXIoKSA+IDE5NTApID8gZGF0ZS50b0RhdGUoKSA6IFwiXCI7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9zbWFydC10YWJsZS5jbGVhcktleS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoXCJzdENsZWFyS2V5XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogWydec3RUYWJsZScsICdebmdNb2RlbCddLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJscykge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZ01vZGVsID0gY3RybHNbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN0cmwgPSBjdHJsc1swXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAxMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMjcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmNvbnRleHQuYXR0cmlidXRlc1snc3Qtc2VhcmNoJ10gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkTmFtZSA9IGVsZW1lbnQuY29udGV4dC5hdHRyaWJ1dGVzWydzdC1zZWFyY2gnXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVTdGF0ZSA9IGN0cmwudGFibGVTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdFtmaWVsZE5hbWVdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kc2V0Vmlld1ZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHJlbmRlcigpOyAvLyB3aWxsIHVwZGF0ZSB0aGUgaW5wdXQgdmFsdWUgYXMgd2VsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZShcInN0UmVzZXRTZWFyY2hcIixcclxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgICAgICAgICByZXF1aXJlOiBbJ15zdFRhYmxlJywgJ15uZ01vZGVsJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuYmluZCgnY2xpY2snLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IGN0cmxzWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdHJsID0gY3RybHNbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gobW9kZWwuJHZpZXdWYWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleS50b0xvd2VyQ2FzZSgpID09PSAncGFnZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuJHZpZXdWYWx1ZVtrZXldID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpIHx8IGtleS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdwYWdlJykpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC4kdmlld1ZhbHVlW2tleV0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlU3RhdGUgPSBjdHJsLnRhYmxlU3RhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlU3RhdGUucGFnaW5hdGlvbi5zdGFydCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnBpcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ3N0U3VibWl0U2VhcmNoJywgWydzdENvbmZpZycsICckdGltZW91dCcsICckcGFyc2UnLCBmdW5jdGlvbiAoc3RDb25maWcsICR0aW1lb3V0LCAkcGFyc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1aXJlOiAnXnN0VGFibGUnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZUN0cmwgPSBjdHJsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XHJcblxyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdzbWFydC10YWJsZScpXHJcbiAgICAgIC5kaXJlY3RpdmUoJ3N0U2VhcmNoJywgWydzdENvbmZpZycsICckdGltZW91dCcsICckcGFyc2UnLCBmdW5jdGlvbiAoc3RDb25maWcsICR0aW1lb3V0LCAkcGFyc2UpIHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgcmVxdWlyZTogJ15zdFRhYmxlJyxcclxuICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlQ3RybCA9IGN0cmw7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgdmFyIHRocm90dGxlID0gYXR0ci5zdERlbGF5IHx8IHN0Q29uZmlnLnNlYXJjaC5kZWxheTtcclxuICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gYXR0ci5zdElucHV0RXZlbnQgfHwgc3RDb25maWcuc2VhcmNoLmlucHV0RXZlbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICBhdHRyLiRvYnNlcnZlKCdzdFNlYXJjaCcsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9IGVsZW1lbnRbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIGlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC50YWJsZVN0YXRlKCkuc2VhcmNoID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVDdHJsLnNlYXJjaChpbnB1dCwgbmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgIC8vdGFibGUgc3RhdGUgLT4gdmlld1xyXG4gICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0cmwudGFibGVTdGF0ZSgpLnNlYXJjaDtcclxuICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHByZWRpY2F0ZUV4cHJlc3Npb24gPSBhdHRyLnN0U2VhcmNoIHx8ICckJztcclxuICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZS5wcmVkaWNhdGVPYmplY3QgJiYgJHBhcnNlKHByZWRpY2F0ZUV4cHJlc3Npb24pKG5ld1ZhbHVlLnByZWRpY2F0ZU9iamVjdCkgIT09IGVsZW1lbnRbMF0udmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnZhbHVlID0gJHBhcnNlKHByZWRpY2F0ZUV4cHJlc3Npb24pKG5ld1ZhbHVlLnByZWRpY2F0ZU9iamVjdCkgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgLy8gdmlldyAtPiB0YWJsZSBzdGF0ZVxyXG4gICAgICAgICAgICAgICAgICBlbGVtZW50LmJpbmQoZXZlbnQsIGZ1bmN0aW9uIChldnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGV2dCA9IGV2dC5vcmlnaW5hbEV2ZW50IHx8IGV2dDtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9taXNlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHByb21pc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgIHByb21pc2UgPSAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVDdHJsLnNlYXJjaChldnQudGFyZ2V0LnZhbHVlLCBhdHRyLnN0U2VhcmNoIHx8ICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgIH0sIHRocm90dGxlKTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuICAgICAgfV0pO1xyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgYXBwLmRpcmVjdGl2ZSgndG9nZ2xlQ2hlY2tib3gnLCBmdW5jdGlvbigkdGltZW91dCkge1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAqIERpcmVjdGl2ZVxyXG4gICAgICovXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgcmVwbGFjZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCAkZWxlbWVudCwgJGF0dHIsIG5nTW9kZWwpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgbW9kZWwgZnJvbSBFbGVtZW50XHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlTW9kZWxGcm9tRWxlbWVudCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIG1vZGlmaWVkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSAkZWxlbWVudC5wcm9wKCdjaGVja2VkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQgIT09IG5nTW9kZWwuJHZpZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgbmdNb2RlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUoY2hlY2tlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBpbnB1dCBmcm9tIE1vZGVsXHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlRWxlbWVudEZyb21Nb2RlbCA9IGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQudHJpZ2dlcignY2hhbmdlJyk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE9ic2VydmU6IEVsZW1lbnQgY2hhbmdlcyBhZmZlY3QgTW9kZWxcclxuICAgICAgICAgICAgICAgICRlbGVtZW50Lm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVNb2RlbEZyb21FbGVtZW50KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZ01vZGVsLiR2aWV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUVsZW1lbnRGcm9tTW9kZWwobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSW5pdGlhbGlzZSBCb290c3RyYXBUb2dnbGVcclxuICAgICAgICAgICAgICAgICRlbGVtZW50LmJvb3RzdHJhcFRvZ2dsZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2Rvbm9ydGF4LmNvbnRyb2xsZXIuanNcclxuXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ0Rvbm9yVGF4Q29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5kb25vcnRheCcpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJywgJyR1aWJNb2RhbCcsICdjb25zdGl0dWVudFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcihsb2dnZXIsICRtb2RhbCwgc2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xyXG5cclxuICAgICAgICB2bS50aXRsZSA9ICdEb25vciBUYXggTWFuYWdlcic7XHJcbiAgICAgICAgdm0uc3ViVGl0bGUgPSAnQ29uc3RpdHVlbnRzJztcclxuXHJcbiAgICAgICAgdm0ucGVvcGxlID0gW107XHJcbiAgICAgICAgdm0uc2VhcmNoTW9kZWwgPSB7XHJcbiAgICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZURlZmF1bHQsXHJcbiAgICAgICAgICAgIG9yZGVyQnk6ICdpZCcsXHJcbiAgICAgICAgICAgIG9yZGVyRGlyZWN0aW9uOiAnYXNjJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNlYXJjaCA9IGZ1bmN0aW9uICh0YWJsZVN0YXRlKSB7XHJcbiAgICAgICAgICAgIHRhYmxlU3RhdGVSZWYgPSB0YWJsZVN0YXRlO1xyXG5cclxuICAgICAgICAgICAgaWYgKCF2bS5zZWFyY2hNb2RlbC5pc1ByaW9yaXR5KSB2bS5zZWFyY2hNb2RlbC5pc1ByaW9yaXR5ID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGlmICh0YWJsZVN0YXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGUpICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwub3JkZXJCeSA9IHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwub3JkZXJEaXJlY3Rpb24gPSB0YWJsZVN0YXRlLnNvcnQucmV2ZXJzZSA/ICdkZXNjJyA6ICdhc2MnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnF1ZXJ5KHZtLnNlYXJjaE1vZGVsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wZW9wbGUgPSBkYXRhLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ucGFnZWQgPSBmdW5jdGlvbiBwYWdlZChwYWdlTnVtKSB7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5lZGl0ID0gZnVuY3Rpb24gKHBlcnNvbikge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvZG9ub3J0YXgvdmlld3MvZWRpdC1jb25zdGl0dWVudC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFZGl0Q29uc3RpdHVlbnRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJywgXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGVyc29uOiBwZXJzb25cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHBlcnNvbikge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSB1cGRhdGVkICcgKyBwZXJzb24ubmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0udmlld1RheGVzID0gZnVuY3Rpb24gKHBlcnNvbikge1xyXG5cclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2Rvbm9ydGF4L3ZpZXdzL3RheGl0ZW1zLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1RheEl0ZW1zQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGVyc29uOiBwZXJzb25cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHBlcnNvbikge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSB1cGRhdGVkICcgKyBwZXJzb24ubmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZWRpdENvbnN0aXR1ZW50LmNvbnRyb2xsZXIuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdFZGl0Q29uc3RpdHVlbnRDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmRvbm9ydGF4JykuY29udHJvbGxlcihjb250cm9sbGVySWQsIG1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBtYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2NvbnN0aXR1ZW50U2VydmljZScsICdwZXJzb24nXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcigkc2NvcGUsIGxvZ2dlciwgJG1vZGFsLCBzZXJ2aWNlLCBwZXJzb24pIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ0VkaXQgUGVyc29uJztcclxuICAgICAgICB2bS5wZXJzb24gPSBwZXJzb247XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZygnY2FuY2VsJyk7XHJcbiAgICAgICAgICAgICRtb2RhbC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnNhdmUocGVyc29uKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh2bS5wZXJzb24sIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICRtb2RhbC5jbG9zZSh2bS5wZXJzb24pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy90YXhJdGVtcy5jb250cm9sbGVyLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnVGF4SXRlbXNDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmRvbm9ydGF4JykuY29udHJvbGxlcihjb250cm9sbGVySWQsIG1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBtYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2NvbnN0aXR1ZW50U2VydmljZScsICdwZXJzb24nXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcigkc2NvcGUsIGxvZ2dlciwgJG1vZGFsLCBzZXJ2aWNlLCBjb25zdGl0dWVudCkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGN1cnJlbnRZZWFyID0gcGFyc2VJbnQobW9tZW50KCkuZ2V0KCdZZWFyJykpO1xyXG5cclxuICAgICAgICB2bS5zZWxlY3RlZFllYXIgPSBjdXJyZW50WWVhciAtIDE7XHJcbiAgICAgICAgdm0uZGF0ZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGZvcm1hdFllYXI6ICd5eXl5JyxcclxuICAgICAgICAgICAgbWF4RGF0ZTogbmV3IERhdGUoJzEyLzMwLycgKyB2bS5zZWxlY3RlZFllYXIpLFxyXG4gICAgICAgICAgICBtaW5EYXRlOiBuZXcgRGF0ZSgnMS8xLycgKyB2bS5zZWxlY3RlZFllYXIpLFxyXG4gICAgICAgICAgICBzdGFydGluZ0RheTogMVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0uYWx0SW5wdXRGb3JtYXRzID0gWydNIS9kIS95eXl5J107XHJcbiAgICAgICAgdm0ueWVhcnMgPSBbXTtcclxuXHJcbiAgICAgICAgdm0ueWVhckNoYW5nZWQgPSB5ZWFyQ2hhbmdlZDtcclxuXHJcbiAgICAgICAgdm0uY29uc3RpdHVlbnQgPSBjb25zdGl0dWVudDtcclxuICAgICAgICB2bS5pdGVtVG9FZGl0ID0ge307XHJcbiAgICAgICAgdm0ubmV3SXRlbSA9IHt9O1xyXG4gICAgICAgIHZtLnRheEl0ZW1zID0gY29uc3RpdHVlbnQudGF4SXRlbXM7XHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGdldFllYXJzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdm0uYWRkSXRlbSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2bS5uZXdJdGVtLmNvbnN0aXR1ZW50SWQgPSBjb25zdGl0dWVudC5pZDtcclxuICAgICAgICAgICAgdm0ubmV3SXRlbS50YXhZZWFyID0gbW9tZW50KHZtLm5ld0l0ZW0uZG9uYXRpb25EYXRlKS55ZWFyKCk7XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLmFkZFRheCh2bS5uZXdJdGVtKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS50YXhJdGVtcy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLm5ld0l0ZW0gPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnQWRkZWQgdGF4IGl0ZW0nKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uY2FuY2VsRWRpdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2bS5jdXJyZW50RWRpdCA9IHt9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZGVsZXRlSXRlbSA9IGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgdmFyIGlkeCA9IHZtLnRheEl0ZW1zLmluZGV4T2YoaXRlbSk7XHJcbiAgICAgICAgICAgIHNlcnZpY2UucmVtb3ZlVGF4KGl0ZW0uaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnRheEl0ZW1zLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCdkZWxldGVkICcgKyBpdGVtLmRvbmF0aW9uRGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmVkaXRJdGVtID0gZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICB2bS5jdXJyZW50RWRpdCA9IHt9O1xyXG4gICAgICAgICAgICB2bS5jdXJyZW50RWRpdFtpdGVtLmlkXSA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLml0ZW1Ub0VkaXQgPSBhbmd1bGFyLmNvcHkoaXRlbSk7XHJcbiAgICAgICAgICAgIHZtLml0ZW1Ub0VkaXQuZG9uYXRpb25EYXRlID0gbW9tZW50KHZtLml0ZW1Ub0VkaXQuZG9uYXRpb25EYXRlKS50b0RhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNhdmVJdGVtID0gZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnVwZGF0ZVRheCh2bS5pdGVtVG9FZGl0KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoaXRlbSwgdm0uaXRlbVRvRWRpdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY3VycmVudEVkaXQgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnVXBkYXRlZCB0YXggaXRlbSAnICsgbW9tZW50KGl0ZW0uZG9uYXRpb25EYXRlKS5mb3JtYXQoJ01NL2RkL3l5eXknKSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHllYXJDaGFuZ2VkKCkge1xyXG4gICAgICAgICAgICB2bS5kYXRlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIG1heERhdGU6IG5ldyBEYXRlKCcxMi8zMC8nICsgdm0uc2VsZWN0ZWRZZWFyKSxcclxuICAgICAgICAgICAgICAgIG1pbkRhdGU6IG5ldyBEYXRlKCcxLzEvJyArIHZtLnNlbGVjdGVkWWVhcilcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdm0ubmV3SXRlbS5kb25hdGlvbkRhdGUgPSB2bS5kYXRlT3B0aW9ucy5taW5EYXRlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0WWVhcnMoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2bS55ZWFycy5wdXNoKGN1cnJlbnRZZWFyIC0gaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdm0ueWVhckNoYW5nZWQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9lbnYuanNcclxuXHJcbihmdW5jdGlvbiAod2luZG93KSB7XHJcbiAgICB3aW5kb3cuX19lbnYgPSB3aW5kb3cuX19lbnYgfHwge307XHJcblxyXG4gICAgc3dpdGNoICh3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUpIHtcclxuICAgICAgICBjYXNlICdkZy10ZXN0JzpcclxuICAgICAgICAgICAgd2luZG93Ll9fZW52LnJzdnBVcmwgPSAncnN2cC10ZXN0JztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnZG9ub3JnYXRld2F5LnNwbGNlbnRlci5vcmcnOlxyXG4gICAgICAgICAgICB3aW5kb3cuX19lbnYucnN2cFVybCA9ICdyc3ZwLnNwbGNlbnRlci5vcmcnO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdkZyc6XHJcbiAgICAgICAgICAgIHdpbmRvdy5fX2Vudi5yc3ZwVXJsID0gJ3JzdnAuc3BsY2VudGVyLm9yZyc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2Rvbm9yZ2F0ZXdheSc6XHJcbiAgICAgICAgICAgIHdpbmRvdy5fX2Vudi5yc3ZwVXJsID0gJ3JzdnAuc3BsY2VudGVyLm9yZyc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHdpbmRvdy5fX2Vudi5yc3ZwVXJsID0gJ2xvY2FsaG9zdDo1NDUwNSc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQVBJIHVybFxyXG4gICAgd2luZG93Ll9fZW52LmFwaVVybCA9ICdodHRwOi8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0ICsgJy9hcGknO1xyXG5cclxuICAgIC8vIEJhc2UgdXJsXHJcbiAgICB3aW5kb3cuX19lbnYuYmFzZVVybCA9ICcvJztcclxuXHJcbiAgICAvLyBXaGV0aGVyIG9yIG5vdCB0byBlbmFibGUgZGVidWcgbW9kZVxyXG4gICAgLy8gU2V0dGluZyB0aGlzIHRvIGZhbHNlIHdpbGwgZGlzYWJsZSBjb25zb2xlIG91dHB1dFxyXG4gICAgd2luZG93Ll9fZW52LmVuYWJsZURlYnVnID0gdHJ1ZTtcclxufSh0aGlzKSk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vY3JlYXRlRXZlbnQuY29udHJvbGxlci5qc1xyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG5cdFxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnQ3JlYXRlRXZlbnRDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmV2ZW50cycpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2V2ZW50U2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1haW5Db250cm9sbGVyKGxvZ2dlciwgJG1vZGFsLCBzZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdDcmVhdGUgRXZlbnQnO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLmRhdGVGb3JtYXQgPSBcIk1NL0REL1lZWVkgaGg6bW1cIjtcclxuXHJcbiAgICAgICAgdm0uZXZlbnQgPSB7XHJcbiAgICAgICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgY2FwYWNpdHk6IDEsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiB7fVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gdHJ1ZTsgXHJcbiAgICAgICAgICAgIHZtLmV2ZW50LnRlbXBsYXRlLm5hbWUgPSB2bS5ldmVudC5uYW1lO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZSh2bS5ldmVudClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9lZGl0R3Vlc3QuY29udHJvbGxlci5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ0NyZWF0ZUd1ZXN0Q29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ldmVudHMnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgbWFpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIG1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICdsb2dnZXInLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAnZXZlbnRTZXJ2aWNlJywgJ2V2ZW50J107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFpbkNvbnRyb2xsZXIoJHNjb3BlLCBsb2dnZXIsICRtb2RhbCwgc2VydmljZSwgZXZlbnQpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ0NyZWF0ZSBHdWVzdCc7XHJcblxyXG4gICAgICAgIHZtLmd1ZXN0ID0ge1xyXG4gICAgICAgICAgICBmaW5kZXJOdW1iZXI6ICcwMDAwMDAwMDAwMCcsXHJcbiAgICAgICAgICAgIGV2ZW50SWQ6IGV2ZW50LmlkXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0udGlja2V0Q291bnRMaXN0ID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBldmVudC50aWNrZXRBbGxvd2FuY2UgKyAxOyBpKyspIHtcclxuICAgICAgICAgICAgdm0udGlja2V0Q291bnRMaXN0LnB1c2goaSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5kZWNyZW1lbnRUaWNrZXRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuZWRpdEd1ZXN0Rm9ybS4kcHJpc3RpbmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uZ3Vlc3QuYWRkaXRpb25hbFRpY2tldHMtLTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmluY3JlbWVudFRpY2tldHMgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuZWRpdEd1ZXN0Rm9ybS4kcHJpc3RpbmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uZ3Vlc3QuYWRkaXRpb25hbFRpY2tldHMrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNoYW5nZUF0dGVuZGluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLmd1ZXN0LmlzQXR0ZW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5ndWVzdC50aWNrZXRDb3VudCA9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2bS5ndWVzdC50aWNrZXRDb3VudCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmd1ZXN0Lmluc2lkZVNhbHV0YXRpb24gPSB2bS5ndWVzdC5uYW1lO1xyXG4gICAgICAgICAgICB2bS5ndWVzdC5vdXRzaWRlU2FsdXRhdGlvbiA9IHZtLmd1ZXN0Lm5hbWU7XHJcbiAgICAgICAgICAgIHZtLmd1ZXN0LmVtYWlsU2FsdXRhdGlvbiA9IHZtLmd1ZXN0Lm5hbWU7XHJcbiAgICAgICAgICAgIHZtLmd1ZXN0LmV2ZW50SWQgPSBldmVudC5pZDtcclxuICAgICAgICAgICAgc2VydmljZS5yZWdpc3Rlckd1ZXN0KHZtLmd1ZXN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh2bS5ndWVzdCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKHZtLmd1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZWRpdEd1ZXN0LmNvbnRyb2xsZXIuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdFZGl0R3Vlc3RDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmV2ZW50cycpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJ2xvZ2dlcicsICckdWliTW9kYWxJbnN0YW5jZScsICdldmVudFNlcnZpY2UnLCAnZ3Vlc3QnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcigkc2NvcGUsIGxvZ2dlciwgJG1vZGFsLCBzZXJ2aWNlLCBndWVzdCkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnRWRpdCBHdWVzdCc7XHJcblxyXG4gICAgICAgIGlmIChndWVzdC5pc0F0dGVuZGluZykge1xyXG4gICAgICAgICAgICB2bS5zaG93QWRkVGlja2V0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgZ3Vlc3QuYWRkaXRpb25hbFRpY2tldHMgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZ3Vlc3QgPSBhbmd1bGFyLmNvcHkoZ3Vlc3QpO1xyXG4gICAgICAgIGxvZ2dlci5sb2coJ2d1ZXN0JywgZ3Vlc3QpO1xyXG4gICAgICAgIGxvZ2dlci5sb2coJ3ZtLmd1ZXN0Jywgdm0uZ3Vlc3QpO1xyXG5cclxuICAgICAgICB2bS50aWNrZXRDb3VudExpc3QgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGd1ZXN0LmV2ZW50LnRpY2tldEFsbG93YW5jZSArIDE7IGkrKykge1xyXG4gICAgICAgICAgICB2bS50aWNrZXRDb3VudExpc3QucHVzaChpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdm0uZGVjcmVtZW50VGlja2V0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmVkaXRHdWVzdEZvcm0uJHByaXN0aW5lID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLmd1ZXN0LmFkZGl0aW9uYWxUaWNrZXRzLS07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5pbmNyZW1lbnRUaWNrZXRzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmVkaXRHdWVzdEZvcm0uJHByaXN0aW5lID0gZmFsc2U7IFxyXG4gICAgICAgICAgICB2bS5ndWVzdC5hZGRpdGlvbmFsVGlja2V0cysrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5jaGFuZ2VBdHRlbmRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5ndWVzdC5pc0F0dGVuZGluZykge1xyXG4gICAgICAgICAgICAgICAgdm0uZ3Vlc3QudGlja2V0Q291bnQgPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdm0uZ3Vlc3QudGlja2V0Q291bnQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnNob3dBZGRUaWNrZXQpIHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2UuYWRkVGlja2V0KHZtLmd1ZXN0KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHZtLmd1ZXN0LCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKHZtLmd1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2UucmVnaXN0ZXJHdWVzdCh2bS5ndWVzdClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHZtLmd1ZXN0LCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKHZtLmd1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V2ZW50cy5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ0V2ZW50Q29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ldmVudHMnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgbWFpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIG1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICdsb2dnZXInLCAnJHVpYk1vZGFsJywgJ2V2ZW50U2VydmljZScsICdndWVzdFNlcnZpY2UnLCAndGVtcGxhdGVTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFpbkNvbnRyb2xsZXIoJHNjb3BlLCBsb2dnZXIsICRtb2RhbCwgc2VydmljZSwgZ3Vlc3RTZXJ2aWNlLCB0ZW1wbGF0ZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ0V2ZW50IE1hbmFnZXInO1xyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG4gICAgICAgIHZhciBwYWdlU2l6ZURlZmF1bHQgPSAxMDtcclxuXHJcbiAgICAgICAgdmFyIGNob2ljZXMgPSBbXHJcbiAgICAgICAgICAgIHsgaWQ6IDEsIG5hbWU6IFwiUmVnaXN0ZXJcIiwgY29tbWFuZDogZnVuY3Rpb24gKGUpIHsgdm0ucmVnaXN0ZXJHdWVzdChlKSB9LCBpY29uOiAnaWNvbiBpb24ta2V5JywgZGVmYXVsdDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkOiAyLCBuYW1lOiBcIk1haWwgVGlja2V0XCIsIGNvbW1hbmQ6IGZ1bmN0aW9uIChlKSB7IHZtLm1haWxUaWNrZXQoZSkgfSwgaWNvbjogJ2ljb24gaW9uLWFuZHJvaWQtbWFpbCcsIGRlZmF1bHQ6IGZhbHNlIH0sXHJcbiAgICAgICAgICAgIHsgaWQ6IDMsIG5hbWU6IFwiQ2FuY2VsXCIsIGNvbW1hbmQ6IGZ1bmN0aW9uIChlKSB7IHZtLmNhbmNlbEd1ZXN0KGUpIH0sIGljb246ICdpY29uIGlvbi1hbmRyb2lkLWNhbmNlbCcsIGRlZmF1bHQ6IGZhbHNlIH0sXHJcbiAgICAgICAgICAgIHsgaWQ6IDQsIG5hbWU6IFwiR3Vlc3QgTGlzdFwiLCBjb21tYW5kOiBmdW5jdGlvbiAoZSkgeyB2bS5hZGRUb01haWxRdWV1ZShlKSB9LCBpY29uOiAnaWNvbiBpb24tYW5kcm9pZC1hZGQtY2lyY2xlJywgZGVmYXVsdDogZmFsc2UgfSxcclxuICAgICAgICAgICAgeyBpZDogNSwgbmFtZTogXCJBZGQgVGlja2V0c1wiLCBjb21tYW5kOiBmdW5jdGlvbiAoZSkgeyB2bS5yZWdpc3Rlckd1ZXN0KGUpIH0sIGljb246ICdpY29uIGlvbi1hbmRyb2lkLWFkZC1jaXJjbGUnLCBkZWZhdWx0OiBmYWxzZSB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgdm0uaG9zdExvY2F0aW9uID0gd2luZG93Ll9fZW52LnJzdnBVcmwgKyAnLyc7XHJcblxyXG4gICAgICAgIHZtLnRpdGxlID0gJ0V2ZW50IE1hbmFnZXInO1xyXG4gICAgICAgIHZtLmRlc2NyaXB0aW9uID0gXCJNYW5hZ2UgRG9ub3IgRXZlbnRzXCI7XHJcbiAgICAgICAgdm0uY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgICAgICB2bS5kYXRlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgZGF0ZURpc2FibGVkOiBmYWxzZSxcclxuICAgICAgICAgICAgZm9ybWF0WWVhcjogJ3l5JyxcclxuICAgICAgICAgICAgbWF4RGF0ZTogbmV3IERhdGUoMjAyMCwgNSwgMjIpLFxyXG4gICAgICAgICAgICBtaW5EYXRlOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgICAgICBzdGFydGluZ0RheTogMVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmRhdGVGb3JtYXQgPSBcIk1NL0REL1lZWVkgaDptbSBhXCI7XHJcbiAgICAgICAgdm0uZXZlbnRzID0gW107XHJcblxyXG4gICAgICAgIHZtLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVEZWZhdWx0LFxyXG4gICAgICAgICAgICBvcmRlckJ5OiAnaWQnLFxyXG4gICAgICAgICAgICBvcmRlckRpcmVjdGlvbjogJ2FzYydcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS50YWJzID0gW1xyXG4gICAgICAgICAgICB7IHRpdGxlOiAnRGV0YWlscycsIHRlbXBsYXRlOiAnYXBwL2V2ZW50cy92aWV3cy9ob21lLmh0bWwnLCBhY3RpdmU6IGZhbHNlLCBpY29uOiAnZmEtaW5mby1jaXJjbGUnIH0sXHJcbiAgICAgICAgICAgIHsgdGl0bGU6ICdHdWVzdHMnLCB0ZW1wbGF0ZTogJ2FwcC9ldmVudHMvdmlld3MvZ3Vlc3QtbGlzdC5odG1sJywgYWN0aXZlOiB0cnVlLCBpY29uOiAnZmEtdXNlcnMnIH0sXHJcbiAgICAgICAgICAgIC8veyB0aXRsZTogJ01haWwgUXVldWUnLCB0ZW1wbGF0ZTogJ2FwcC9ldmVudHMvdmlld3MvbWFpbC1xdWV1ZS5odG1sJywgYWN0aXZlOiBmYWxzZSwgaWNvbjogJycgfSxcclxuICAgICAgICAgICAgLy97IHRpdGxlOiAnV2FpdGluZyBRdWV1ZScsIHRlbXBsYXRlOiAnYXBwL2V2ZW50cy92aWV3cy93YWl0LXF1ZXVlLmh0bWwnLCBhY3RpdmU6IGZhbHNlLCBpY29uOiAnJyB9LFxyXG4gICAgICAgICAgICB7IHRpdGxlOiAnVGVtcGxhdGUnLCB0ZW1wbGF0ZTogJ2FwcC9ldmVudHMvdmlld3MvdGVtcGxhdGUuaHRtbCcsIGFjdGl2ZTogZmFsc2UsIGljb246ICdmYS1maWxlLXRleHQnIH1cclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZyhjb250cm9sbGVySWQgKyAnIGFjdGl2YXRlZCcpO1xyXG4gICAgICAgICAgICBnZXRFdmVudHMoKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ2xvYWRlZCBldmVudHMnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5hZGRUb01haWxRdWV1ZSA9IGZ1bmN0aW9uIChndWVzdCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmFkZFRvTWFpbChndWVzdClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ01vdmVkIEd1ZXN0ICcgKyBkYXRhLm5hbWUgKyAnU2VuZCBUaWNrZXQ6ICcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGd1ZXN0LCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBCdWlsZEd1ZXN0T3B0aW9ucyhndWVzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gYW5ndWxhci5jb3B5KHZtLnNlbGVjdGVkRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHZtLnNlbGVjdGVkRXZlbnQsIGd1ZXN0LmV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV2ZW50Lmd1ZXN0cyA9IGV2ZW50Lmd1ZXN0cztcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5jYW5jZWxHdWVzdCA9IGZ1bmN0aW9uIChndWVzdCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmNhbmNlbEd1ZXN0KGd1ZXN0KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ3Jlc3VsdCcsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoZ3Vlc3QsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9CVUc6IE5vdCBjaGFuZ2luIG9wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICBCdWlsZEd1ZXN0T3B0aW9ucyhndWVzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gYW5ndWxhci5jb3B5KHZtLnNlbGVjdGVkRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHZtLnNlbGVjdGVkRXZlbnQsIHJlc3VsdC5ldmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFdmVudC5ndWVzdHMgPSBldmVudC5ndWVzdHM7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNoYW5nZUV2ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkRXZlbnQpIHJldHVybjtcclxuICAgICAgICAgICAgLy9SRVNFVCBWQUxVRVNcclxuICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwgPSB7XHJcbiAgICAgICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplRGVmYXVsdCxcclxuICAgICAgICAgICAgICAgIG9yZGVyQnk6ICdpZCcsXHJcbiAgICAgICAgICAgICAgICBvcmRlckRpcmVjdGlvbjogJ2FzYydcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdm0uc2hvd1dhaXRMaXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnNob3dNYWlsUXVldWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0udGFic1swXS5hY3RpdmUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VydmljZS5nZXRCeUlkKHZtLnNlbGVjdGVkRXZlbnQuaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHZtLnNlbGVjdGVkRXZlbnQsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoR3Vlc3RzKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ucmVmcmVzaEd1ZXN0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uc2VhcmNoR3Vlc3RzKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZGVsZXRlRXZlbnQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VydmljZS5yZW1vdmUoaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ0RlbGV0ZWQgZXZlbnQnKTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0RXZlbnRzKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmV4cG9ydEd1ZXN0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VydmljZS5kb3dubG9hZEd1ZXN0cyh2bS5zZWxlY3RlZEV2ZW50LmlkLCB2bS5zZWFyY2hNb2RlbClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRUeXBlID0gZGF0YS5oZWFkZXJzKClbJ2NvbnRlbnQtdHlwZSddO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEuaGVhZGVycygpWyd4LWZpbGVuYW1lJ107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsaW5rRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtkYXRhLmRhdGFdLCB7IHR5cGU6IGNvbnRlbnRUeXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB1cmwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBmaWxlbmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xpY2tFdmVudCA9IG5ldyBNb3VzZUV2ZW50KFwiY2xpY2tcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2aWV3XCI6IHdpbmRvdyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYnViYmxlc1wiOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjYW5jZWxhYmxlXCI6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5kaXNwYXRjaEV2ZW50KGNsaWNrRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5jcmVhdGVHdWVzdCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9ldmVudHMvdmlld3MvZWRpdC1ndWVzdC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDcmVhdGVHdWVzdENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50OiB2bS5zZWxlY3RlZEV2ZW50XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBndWVzdCA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgIEJ1aWxkR3Vlc3RPcHRpb25zKGd1ZXN0KTtcclxuICAgICAgICAgICAgICAgIHZhciBldmVudCA9IGFuZ3VsYXIuY29weSh2bS5zZWxlY3RlZEV2ZW50KTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHZtLnNlbGVjdGVkRXZlbnQsIHJlc3VsdC5ldmVudCk7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV2ZW50Lmd1ZXN0cyA9IGV2ZW50Lmd1ZXN0cztcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuZ3Vlc3RzLnVuc2hpZnQoZ3Vlc3QpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIEJ1aWxkR3Vlc3RPcHRpb25zKGd1ZXN0KSB7XHJcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0gW107XHJcblxyXG4gICAgICAgICAgICBpZiAoZ3Vlc3QuaXNBdHRlbmRpbmcgPT09IG51bGwpIG9wdGlvbnMucHVzaChjaG9pY2VzWzBdKTtcclxuICAgICAgICAgICAgaWYgKGd1ZXN0LmlzQXR0ZW5kaW5nICYmICFndWVzdC5pc1dhaXRpbmcgJiYgIWd1ZXN0LmlzTWFpbGVkKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goY2hvaWNlc1sxXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGd1ZXN0LmlzV2FpdGluZykge1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKGNob2ljZXNbM10pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChndWVzdC5pc0F0dGVuZGluZykge1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKGNob2ljZXNbNF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChndWVzdC5pc0F0dGVuZGluZyAhPT0gbnVsbCkgb3B0aW9ucy5wdXNoKGNob2ljZXNbMl0pO1xyXG5cclxuICAgICAgICAgICAgZ3Vlc3QucHJpbWFyeUNob2ljZSA9IGFuZ3VsYXIuY29weShvcHRpb25zWzBdKTtcclxuICAgICAgICAgICAgb3B0aW9ucy5zaGlmdCgpO1xyXG5cclxuICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoZ3Vlc3QsIHsgY2hvaWNlczogb3B0aW9ucyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnJlZ2lzdGVyR3Vlc3QgPSBmdW5jdGlvbiAoZ3Vlc3QpIHtcclxuICAgICAgICAgICAgZ3Vlc3QuZXZlbnQgPSBhbmd1bGFyLmNvcHkodm0uc2VsZWN0ZWRFdmVudCk7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9ldmVudHMvdmlld3MvZWRpdC1ndWVzdC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFZGl0R3Vlc3RDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBndWVzdDogZ3Vlc3RcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoZ3Vlc3QsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICBCdWlsZEd1ZXN0T3B0aW9ucyhndWVzdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gYW5ndWxhci5jb3B5KHZtLnNlbGVjdGVkRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodm0uc2VsZWN0ZWRFdmVudCwgcmVzdWx0LmV2ZW50KTtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuZ3Vlc3RzID0gZXZlbnQuZ3Vlc3RzO1xyXG4gICAgICAgICAgICAgICAgZ3Vlc3QgPSBudWxsO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnRvZ2dsZVdhaXRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLnNob3dXYWl0aW5nID0gIXZtLnNob3dXYWl0aW5nO1xyXG4gICAgICAgICAgICB2bS5zaG93TWFpbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5zaG93U2VudCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5wYWdlID0gMTtcclxuICAgICAgICAgICAgdm0uc2VhcmNoR3Vlc3RzKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0udG9nZ2xlTWFpbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uc2hvd01haWwgPSAhdm0uc2hvd01haWw7XHJcbiAgICAgICAgICAgIHZtLnNob3dXYWl0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnNob3dTZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLnBhZ2UgPSAxO1xyXG4gICAgICAgICAgICB2bS5zZWFyY2hHdWVzdHModGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS50b2dnbGVTZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5zaG93U2VudCA9ICF2bS5zaG93U2VudDtcclxuICAgICAgICAgICAgdm0uc2hvd1dhaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uc2hvd01haWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwucGFnZSA9IDE7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaEd1ZXN0cyh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLm1haWxBbGxUaWNrZXRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLm1haWxBbGxUaWNrZXRzKHZtLnNlbGVjdGVkRXZlbnQuaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHZtLnNlbGVjdGVkRXZlbnQsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlYXJjaEd1ZXN0cyh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ubWFpbFRpY2tldCA9IGZ1bmN0aW9uIChndWVzdCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLm1haWxUaWNrZXQoZ3Vlc3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChndWVzdCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCdWlsZEd1ZXN0T3B0aW9ucyhndWVzdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gYW5ndWxhci5jb3B5KHZtLnNlbGVjdGVkRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodm0uc2VsZWN0ZWRFdmVudCwgZ3Vlc3QuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFdmVudC5ndWVzdHMgPSBldmVudC5ndWVzdHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnTWFpbGVkIHRpY2tldCB0bzogJyArIGd1ZXN0Lm5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zZWFyY2hHdWVzdHMgPSBmdW5jdGlvbiAodGFibGVTdGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZEV2ZW50KSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBpZiAodGFibGVTdGF0ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNvcnQucHJlZGljYXRlKSAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLm9yZGVyQnkgPSB0YWJsZVN0YXRlLnNvcnQucHJlZGljYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLm9yZGVyRGlyZWN0aW9uID0gdGFibGVTdGF0ZS5zb3J0LnJldmVyc2UgPyAnZGVzYycgOiAnYXNjJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuaXNBdHRlbmRpbmcgPSBudWxsO1xyXG4gICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5pc1dhaXRpbmcgPSBudWxsO1xyXG4gICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5pc01haWxlZCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBpZiAodm0uc2hvd1dhaXRpbmcpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzV2FpdGluZyA9IHZtLnNob3dXYWl0aW5nID8gdm0uc2hvd1dhaXRpbmcgOiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodm0uc2hvd01haWwpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzV2FpdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuaXNNYWlsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzQXR0ZW5kaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnNob3dTZW50KSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5pc1dhaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzTWFpbGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzQXR0ZW5kaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2UuZ2V0R3Vlc3RzKHZtLnNlbGVjdGVkRXZlbnQuaWQsIHZtLnNlYXJjaE1vZGVsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ3Vlc3RzID0gZGF0YS5pdGVtcy5tYXAoZnVuY3Rpb24gKGd1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEJ1aWxkR3Vlc3RPcHRpb25zKGd1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGd1ZXN0O1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuZ3Vlc3RzID0gZ3Vlc3RzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ucGFnZWQgPSBmdW5jdGlvbiBwYWdlZCgpIHtcclxuICAgICAgICAgICAgdm0uc2VhcmNoR3Vlc3RzKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNhdmVFdmVudCA9IGZ1bmN0aW9uIChmb3JtKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlLnVwZGF0ZSh2bS5zZWxlY3RlZEV2ZW50KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ3Vlc3RzID0gdm0uc2VsZWN0ZWRFdmVudC5ndWVzdHM7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodm0uc2VsZWN0ZWRFdmVudCwgZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuZ3Vlc3RzID0gZ3Vlc3RzO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTYXZlZCBFdmVudDogJyArIGRhdGEubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcm0uJHNldFByaXN0aW5lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmZpbGVTZWxlY3RlZCA9IGZ1bmN0aW9uICgkZmlsZXMsICRmaWxlKSB7XHJcbiAgICAgICAgICAgIHZhciBmaWxlID0gJGZpbGU7XHJcblxyXG4gICAgICAgICAgICB2YXIgc3JjID0gJyc7XHJcbiAgICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG5cclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBzcmMgPSByZWFkZXIucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFdmVudC50ZW1wbGF0ZS5pbWFnZSA9IHJlYWRlci5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV2ZW50LnRlbXBsYXRlLm1pbWVUeXBlID0gZmlsZS50eXBlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAvL0FkZGVkIGR1ZSB0byBsYXJnZSBpbWFnZXMgbm90IGNvbXBsZXRlIGJlZm9yZSBkaWdlc3QgY3ljbGUuIFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2F2ZVRlbXBsYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVNlcnZpY2UudXBkYXRlKHZtLnNlbGVjdGVkRXZlbnQudGVtcGxhdGUpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQudGVtcGxhdGUgPSBhbmd1bGFyLmV4dGVuZCh2bS5zZWxlY3RlZEV2ZW50LnRlbXBsYXRlLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnU2F2ZWQgdGVtcGxhdGU6ICcgKyBkYXRhLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnRvZ2dsZUNhbmNlbCA9IGZ1bmN0aW9uIChmb3JtKSB7XHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuaXNDYW5jZWxsZWQgPSAhdm0uc2VsZWN0ZWRFdmVudC5pc0NhbmNlbGxlZDtcclxuICAgICAgICAgICAgdm0uc2F2ZUV2ZW50KGZvcm0pLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkRXZlbnQuaXNDYW5jZWxsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygnQ2FuY2VsbGVkIGV2ZW50Jyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdSZXN0b3JlZCBldmVudCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNob3dDcmVhdGVFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2V2ZW50cy92aWV3cy9jcmVhdGUtZXZlbnQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQ3JlYXRlRXZlbnRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFdmVudCA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB2bS5ldmVudHMudW5zaGlmdCh2bS5zZWxlY3RlZEV2ZW50KTtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgY3JlYXRlZCAnICsgZGF0YS5uYW1lKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zaG93R3Vlc3RVcGxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGtleWJvYXJkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9ldmVudHMvdmlld3MvZ3Vlc3QtdXBsb2FkLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgLy9jb250cm9sbGVyOiBbJ2xvZ2dlcicsICckdWliTW9kYWxJbnN0YW5jZScsICdmaWxlU2VydmljZScsICdzZWxlY3RlZEV2ZW50JywgVXBsb2FkR3Vlc3RDb250cm9sbGVyXSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdVcGxvYWRHdWVzdENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50OiB2bS5zZWxlY3RlZEV2ZW50XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLmNoYW5nZUV2ZW50KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RXZlbnRzKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gc2VydmljZS5nZXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5ldmVudHMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgfTtcclxuXHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vdXBsb2FkR3Vlc3QuY29udHJvbGxlci5qc1xyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG5cdFxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnVXBsb2FkR3Vlc3RDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmV2ZW50cycpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2ZpbGVTZXJ2aWNlJywgJ2V2ZW50J107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFpbkNvbnRyb2xsZXIobG9nZ2VyLCAkbW9kYWwsIHNlcnZpY2UsIGV2ZW50KSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdVcGxvYWQgR3Vlc3QgTGlzdCc7XHJcblxyXG4gICAgICAgIHZtLmV2ZW50ID0gZXZlbnQ7XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uZmlsZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmZpbGVTZWxlY3RlZCA9IGZ1bmN0aW9uICgkZmlsZSwgJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZtLnJlc3VsdCA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5yZXN1bHQgPSB7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLmd1ZXN0KHZtLmV2ZW50LmlkLCB2bS5maWxlKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJlc3VsdC5zdWNjZXNzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVzdWx0Lm1lc3NhZ2UgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yZXN1bHQubWVzc2FnZSA9IGVycm9yLmRhdGEubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uZmlsZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRtb2RhbC5jbG9zZSh2bS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiLy9hcHAuZmlsdGVyLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXInKS5maWx0ZXIoJ3BlcmNlbnRhZ2UnLCBbJyRmaWx0ZXInLCBmdW5jdGlvbiAoJGZpbHRlcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCwgZGVjaW1hbHMpIHtcclxuICAgICAgICByZXR1cm4gJGZpbHRlcignbnVtYmVyJykoaW5wdXQgKiAxMDAsIGRlY2ltYWxzKSArICclJztcclxuICAgIH07XHJcbn1dKTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAuZmlsdGVyJywgW10pLmZpbHRlcignY2hlY2ttYXJrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgIHJldHVybiBpbnB1dCA/ICdcXHUyNzEzJyA6ICdcXHUyNzE4JztcclxuICAgIH07XHJcbn0pO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXInKS5maWx0ZXIoJ3llc05vJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgIHJldHVybiBpbnB1dCA/ICdZZXMnIDogJ05vJztcclxuICAgIH1cclxufSk7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmZpbHRlcicpLmZpbHRlcigndXBkYXRlU3RhdHVzJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgIGlmIChpbnB1dCA9PT0gMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ1VuY2hhbmdlZCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbnB1dCA9PT0gMikge1xyXG4gICAgICAgICAgICByZXR1cm4gJ0NoYW5nZWQnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5wdXQgPT09IDYpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdSZWNvbmNpbGVkJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICB9O1xyXG59KTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9tYWlsZXIuY29udHJvbGxlci5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ01haWxlckNvbnRyb2xsZXInO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubWFpbGVyJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIG1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBtYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInLCAnJHVpYk1vZGFsJywgJ21haWxlclNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcihsb2dnZXIsICRtb2RhbCwgc2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xyXG5cclxuICAgICAgICB2bS50aXRsZSA9ICdNYXJrSXQgTWFuYWdlcic7XHJcbiAgICAgICAgdm0uc3ViVGl0bGUgPSAnTWFpbGVycyc7XHJcblxyXG4gICAgICAgIHZtLmNhbXBhaWducyA9IFtdO1xyXG4gICAgICAgIHZtLnJlYXNvbnMgPSBbXTtcclxuXHJcbiAgICAgICAgdm0ubWFpbGVycyA9IFtdO1xyXG4gICAgICAgIHZtLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVEZWZhdWx0LFxyXG4gICAgICAgICAgICBvcmRlckJ5OiAnaWQnLFxyXG4gICAgICAgICAgICBvcmRlckRpcmVjdGlvbjogJ2FzYycsXHJcbiAgICAgICAgICAgIHN1cHByZXNzOiBmYWxzZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKGNvbnRyb2xsZXJJZCArICcgYWN0aXZhdGVkJyk7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuY2FtcGFpZ25zKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2FtcGFpZ25zID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS5yZWFzb25zKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucmVhc29ucyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZG93bmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuZG93bmxvYWQodm0uc2VhcmNoTW9kZWwpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50VHlwZSA9IGRhdGEuaGVhZGVycygpWydjb250ZW50LXR5cGUnXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSBkYXRhLmhlYWRlcnMoKVsneC1maWxlbmFtZSddO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGlua0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbZGF0YS5kYXRhXSwgeyB0eXBlOiBjb250ZW50VHlwZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgbGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKCdocmVmJywgdXJsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKFwiZG93bmxvYWRcIiwgZmlsZW5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsaWNrRXZlbnQgPSBuZXcgTW91c2VFdmVudChcImNsaWNrXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidmlld1wiOiB3aW5kb3csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJ1YmJsZXNcIjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2FuY2VsYWJsZVwiOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGlua0VsZW1lbnQuZGlzcGF0Y2hFdmVudChjbGlja0V2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKGV4KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uc2VhcmNoID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNvcnQucHJlZGljYXRlKSAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwub3JkZXJCeSA9IHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5vcmRlckRpcmVjdGlvbiA9IHRhYmxlU3RhdGUuc29ydC5yZXZlcnNlID8gJ2Rlc2MnIDogJ2FzYyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh2bS5zZWFyY2hNb2RlbC5zdXBwcmVzcyA9PT0gbnVsbCkgdm0uc2VhcmNoTW9kZWwuc3VwcHJlc3MgPSBmYWxzZTsgXHJcblxyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnF1ZXJ5KHZtLnNlYXJjaE1vZGVsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5tYWlsZXJzID0gZGF0YS5pdGVtcztcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbCA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNsaWNrU2VhcmNoID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNob3dVcGxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGtleWJvYXJkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9tYWlsZXIvdmlld3MvbWFpbGVyLXVwbG9hZC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdVcGxvYWRNYWlsZXJDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBjYW1wYWlnbnM6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdm0uY2FtcGFpZ25zOyB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICB2bS5jYW1wYWlnbnMgPSBhbmd1bGFyLmV4dGVuZChyZXN1bHQuY2FtcGFpZ25zKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcyhyZXN1bHQubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihyZXN1bHQubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnBhZ2VkID0gZnVuY3Rpb24gcGFnZWQocGFnZU51bSkge1xyXG4gICAgICAgICAgICB2bS5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0ucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VydmljZS5jYW1wYWlnbnMoKVxyXG4gICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgdm0uY2FtcGFpZ25zID0gZGF0YTtcclxuICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB2bS5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS50b2dnbGVGaWx0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLnNob3dTdXBwcmVzcyA9ICF2bS5zaG93U3VwcHJlc3M7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLnN1cHByZXNzID0gdm0uc2hvd1N1cHByZXNzO1xyXG5cclxuICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwucGFnZSA9IDE7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnRvZ2dsZVN1cHByZXNzID0gZnVuY3Rpb24gKG1haWxlcikge1xyXG4gICAgICAgICAgICBpZiAobWFpbGVyLnN1cHByZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBtYWlsZXIuc3VwcHJlc3MgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIG1haWxlci5yZWFzb25JZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlLnNhdmUobWFpbGVyKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQobWFpbGVyLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL21haWxlci92aWV3cy9tYWlsZXItc3VwcHJlc3MuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdTdXBwcmVzc01haWxlckNvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haWxlcjogbWFpbGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uczogZnVuY3Rpb24oKSB7IHJldHVybiB2bS5yZWFzb25zIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChtYWlsZXIsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICBcclxuXHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vc3VwcHJlc3NNYWlsZXIuY29udHJvbGxlci5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdTdXBwcmVzc01haWxlckNvbnRyb2xsZXInO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubWFpbGVyJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIG1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBtYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAnbWFpbGVyU2VydmljZScsICdtYWlsZXInLCAncmVhc29ucyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1haW5Db250cm9sbGVyKGxvZ2dlciwgJG1vZGFsLCBzZXJ2aWNlLCBtYWlsZXIsIHJlYXNvbnMpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ01haWxlciBTdXBwcmVzcyc7XHJcbiAgICAgICAgdm0ubWFpbGVyID0gbWFpbGVyO1xyXG5cclxuICAgICAgICB2bS5yZWFzb25zID0gcmVhc29ucztcclxuXHJcbiAgICAgICAgdm0ubWFpbGVyLnJlYXNvbklkID0gdm0ucmVhc29uc1swXS5pZDtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkbW9kYWwuZGlzbWlzcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5tYWlsZXIuc3VwcHJlc3MgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnNhdmUodm0ubWFpbGVyKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChtYWlsZXIsIGRhdGEpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgJG1vZGFsLmNsb3NlKHZtLm1haWxlcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vdXBsb2FkTWFpbGVyLmNvbnRyb2xsZXIuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnVXBsb2FkTWFpbGVyQ29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5tYWlsZXInKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgbWFpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIC8vbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2ZpbGVTZXJ2aWNlJywgJ2NhbXBhaWducyddO1xyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2ZpbGVTZXJ2aWNlJywgJ21haWxlclNlcnZpY2UnLCAnY2FtcGFpZ25zJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFpbkNvbnRyb2xsZXIobG9nZ2VyLCAkbW9kYWwsIHNlcnZpY2UsIG1haWxlclNlcnZpY2UsIGNhbXBhaWducykge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnTWFpbGVyIFVwbG9hZCc7XHJcblxyXG4gICAgICAgIHZtLmNyZWF0ZU5ldyA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2bS5jYW1wYWlnbnMgPSBjYW1wYWlnbnM7XHJcblxyXG4gICAgICAgIHZtLmNhbXBhaWduID0ge1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmZpbGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICRtb2RhbC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5maWxlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoJGZpbGUsICRldmVudCkge1xyXG4gICAgICAgICAgICB2bS5yZXN1bHQgPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLnJlc3VsdCA9IHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNlcnZpY2UubWFpbGVyKHZtLnNlbGVjdGVkQ2FtcGFpZ24uaWQsIHZtLmZpbGUpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJlc3VsdC5zdWNjZXNzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5yZXN1bHQubWVzc2FnZSA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJlc3VsdC5tZXNzYWdlID0gZXJyb3IuZGF0YS5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5maWxlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJlc3VsdC5jYW1wYWlnbnMgPSB2bS5jYW1wYWlnbnM7IFxyXG4gICAgICAgICAgICAgICAgICAgICRtb2RhbC5jbG9zZSh2bS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5jcmVhdGVDYW1wYWlnbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbWFpbGVyU2VydmljZS5jcmVhdGVDYW1wYWlnbih2bS5jYW1wYWlnbilcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2FtcGFpZ25zLnVuc2hpZnQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDYW1wYWlnbiA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY3JlYXRlTmV3ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL25hdi5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ05hdkNvbnRyb2xsZXInO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubmF2JykuY29udHJvbGxlcihjb250cm9sbGVySWQsIG1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBtYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcihsb2dnZXIpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZyhjb250cm9sbGVySWQgKyAnIGFjdGl2YXRlZCcpO1xyXG4gICAgICAgICAgICB2bS51c2VyID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudFVzZXInKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSkoKTsiLCIvL3VzZXIuc2VydmljZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIHNlcnZpY2VJZCA9ICdjb25zdGl0dWVudFNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLkNvbnN0aXR1ZW50O1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwgXHJcbiAgICAgICAgICAgIHNhdmU6IHNhdmUsIFxyXG4gICAgICAgICAgICBhZGRUYXg6IGFkZFRheCwgXHJcbiAgICAgICAgICAgIHVwZGF0ZVRheDogdXBkYXRlVGF4LCBcclxuICAgICAgICAgICAgcmVtb3ZlVGF4OiByZW1vdmVUYXhcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkodm0pIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsICsgJy9zZWFyY2gnLCB2bSlcclxuICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlKHBlcnNvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgcGVyc29uKVxyXG4gICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZFRheCh0YXhJdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCArICcvJyArIHRheEl0ZW0uY29uc3RpdHVlbnRJZCArICcvdGF4aXRlbScsIHRheEl0ZW0pXHJcbiAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlVGF4KHRheEl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwgKyAnLycgKyB0YXhJdGVtLmNvbnN0aXR1ZW50SWQgKyAnL3RheGl0ZW0nLCB0YXhJdGVtKVxyXG4gICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZVRheChpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCArICcvZGVsZXRldGF4LycgKyBpZClcclxuICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vdGVtcGxhdGUuc2VydmljZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIHNlcnZpY2VJZCA9ICdkZW1vZ3JhcGhpY1NlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLkRlbW9ncmFwaGljO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgICAgICAgICByZW1vdmVBbGw6IHJlbW92ZUFsbCxcclxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxyXG4gICAgICAgICAgICBleHBvcnRMaXN0OiBleHBvcnRMaXN0XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KHBhZ2UsIHNpemUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwgKyAnP3BhZ2U9JyArIHBhZ2UgKyAnJnBhZ2VzaXplPScgKyBzaXplKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICBmdW5jdGlvbiBxdWVyeSh2bSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnL3NlYXJjaCcsIHZtKVxyXG4gICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUodXJsICsgJy8nICsgaWQpLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZUFsbCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSh1cmwpLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBleHBvcnRMaXN0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnL2V4cG9ydCcpXHJcbiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9ldmVudC5zZXJ2aWNlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBzZXJ2aWNlSWQgPSAnZXZlbnRTZXJ2aWNlJztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZScpLmZhY3Rvcnkoc2VydmljZUlkLCBzZXJ2aWNlQ29udHJvbGxlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gc2VydmljZUNvbnRyb2xsZXIobG9nZ2VyLCAkaHR0cCwgY29uZmlnKSB7XHJcbiAgICAgICAgbG9nZ2VyLmxvZyhzZXJ2aWNlSWQgKyAnIGxvYWRlZCcpO1xyXG4gICAgICAgIHZhciB1cmwgPSBjb25maWcuYXBpVXJsICsgY29uZmlnLmFwaUVuZFBvaW50cy5FdmVudDtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgY2FuY2VsR3Vlc3Q6IGNhbmNlbEd1ZXN0LCBcclxuICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUsXHJcbiAgICAgICAgICAgIGRvd25sb2FkR3Vlc3RzOiBkb3dubG9hZEd1ZXN0cywgXHJcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgICAgICAgICBnZXQ6IGdldCxcclxuICAgICAgICAgICAgZ2V0QnlJZDogZ2V0QnlJZCxcclxuICAgICAgICAgICAgZ2V0R3Vlc3RzOiBnZXRHdWVzdHMsIFxyXG4gICAgICAgICAgICBxdWVyeTogcXVlcnksXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLFxyXG4gICAgICAgICAgICBhZGRUb01haWw6IGFkZFRvTWFpbCwgXHJcbiAgICAgICAgICAgIHJlZ2lzdGVyR3Vlc3Q6IHJlZ2lzdGVyR3Vlc3QsXHJcbiAgICAgICAgICAgIG1haWxUaWNrZXQ6IG1haWxUaWNrZXQsXHJcbiAgICAgICAgICAgIG1haWxBbGxUaWNrZXRzOiBtYWlsQWxsVGlja2V0cyxcclxuICAgICAgICAgICAgYWRkVGlja2V0OiBhZGRUaWNrZXRcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbEd1ZXN0KGd1ZXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCArICcvJyArIGd1ZXN0LmV2ZW50SWQgKyAnL0NhbmNlbFJlZ2lzdHJhdGlvbicsIGd1ZXN0KS50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGUoZXZlbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCBldmVudClcclxuICAgICAgICAgICAgICAgIC50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkb3dubG9hZEd1ZXN0cyhpZCwgdm0pIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsICsgJy8nICsgaWQgKyAnL2d1ZXN0cy9leHBvcnQnLCB2bSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSh1cmwgKyAnLycgKyBpZCkudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgIC50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRCeUlkKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy8nICsgaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0R3Vlc3RzKGlkLCB2bSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnLycgKyBpZCArICcvZ3Vlc3RzJywgdm0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWFpbEFsbFRpY2tldHMoZXZlbnRJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCArICcvJyArIGV2ZW50SWQgKyAnL21haWxhbGx0aWNrZXRzJykudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWFpbFRpY2tldChndWVzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnLycgKyBndWVzdC5ldmVudElkICsgJy9tYWlsdGlja2V0JywgZ3Vlc3QpLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkVGlja2V0KGd1ZXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCArICcvJyArIGd1ZXN0LmV2ZW50SWQgKyAnL2FkZHRpY2tldCcsIGd1ZXN0KS50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGRUb01haWwoZ3Vlc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsICsgJy8nICsgZ3Vlc3QuZXZlbnRJZCArICcvYWRkdG9tYWlsJywgZ3Vlc3QpLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHF1ZXJ5KG5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwgKyAnLycgKyBuYW1lKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyR3Vlc3QoZ3Vlc3QpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsICsgJy8nICsgZ3Vlc3QuZXZlbnRJZCArICcvcmVnaXN0ZXJndWVzdCcgLCBndWVzdCkudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBldmVudClcclxuICAgICAgICAgICAgICAgIC50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5kYXRhLm1lc3NhZ2U7IFxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9maWxlLnNlcnZpY2UuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBzZXJ2aWNlSWQgPSAnZmlsZVNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLkZpbGU7XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBndWVzdDogZ3Vlc3QsIFxyXG4gICAgICAgICAgICBtYWlsZXI6IG1haWxlclxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGd1ZXN0KGlkLCBkYXRhZmlsZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnL2d1ZXN0LycgKyBpZCwgZm9ybURhdGFPYmplY3QoZGF0YWZpbGUpLCB7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1SZXF1ZXN0OiBhbmd1bGFyLmlkZW50aXR5LFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogdW5kZWZpbmVkIH1cclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1haWxlcihpZCwgZGF0YWZpbGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsICsgJy9tYWlsZXIvJyArIGlkLCBmb3JtRGF0YU9iamVjdChkYXRhZmlsZSksIHtcclxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybVJlcXVlc3Q6IGFuZ3VsYXIuaWRlbnRpdHksXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiB1bmRlZmluZWQgfVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZm9ybURhdGFPYmplY3QoZGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgZmQgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICAgICAgZmQuYXBwZW5kKCdmaWxlJywgZGF0YSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZ3Vlc3Quc2VydmljZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ2d1ZXN0U2VydmljZSc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KHNlcnZpY2VJZCwgc2VydmljZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKGxvZ2dlciwgJGh0dHAsIGNvbmZpZykge1xyXG4gICAgICAgIGxvZ2dlci5sb2coc2VydmljZUlkICsgJyBsb2FkZWQnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuR3Vlc3Q7XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcclxuICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICAgICAgICAgIGdldDogZ2V0LFxyXG4gICAgICAgICAgICBnZXRCeUlkOiBnZXRCeUlkLFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcclxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCwgZXZlbnQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUodXJsICsgJy8nICsgaWQpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRCeUlkKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy8nICsgaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkobmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCArICcvJyArIG5hbWUpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBldmVudClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiLy91c2VyLnNlcnZpY2UuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBzZXJ2aWNlSWQgPSAnbWFpbGVyU2VydmljZSc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KHNlcnZpY2VJZCwgc2VydmljZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKGxvZ2dlciwgJGh0dHAsIGNvbmZpZykge1xyXG4gICAgICAgIGxvZ2dlci5sb2coc2VydmljZUlkICsgJyBsb2FkZWQnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuTWFpbGVyO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSxcclxuICAgICAgICAgICAgZG93bmxvYWQ6IGRvd25sb2FkLCBcclxuICAgICAgICAgICAgY2FtcGFpZ25zOiBjYW1wYWlnbnMsIFxyXG4gICAgICAgICAgICByZWFzb25zOiByZWFzb25zLCBcclxuICAgICAgICAgICAgc2F2ZTogc2F2ZSwgXHJcbiAgICAgICAgICAgIGNyZWF0ZUNhbXBhaWduOiBjcmVhdGVDYW1wYWlnblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKS50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBxdWVyeSh2bSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnL3NlYXJjaCcsIHZtKVxyXG4gICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRvd25sb2FkKHZtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCArICcvZXhwb3J0Jywgdm0pXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2FtcGFpZ25zKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCArICcvY2FtcGFpZ25zJykudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ2FtcGFpZ24obmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnL2NyZWF0ZWNhbXBhaWduJywgbmFtZSkudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVhc29ucygpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwgKyAnL3JlYXNvbnMnKS50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlKG1haWxlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgbWFpbGVyKS50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBlcnJvci5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vdGVtcGxhdGUuc2VydmljZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIHNlcnZpY2VJZCA9ICd0ZW1wbGF0ZVNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLlRlbXBsYXRlO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLFxyXG4gICAgICAgICAgICBxdWVyeTogcXVlcnlcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICBzYXZlOiBzYXZlLFxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkobmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCArICcvJyArIG5hbWUpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKHRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCB0ZW1wbGF0ZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vdXNlci5zZXJ2aWNlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ3VzZXJTZXJ2aWNlJztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZScpLmZhY3Rvcnkoc2VydmljZUlkLCBzZXJ2aWNlQ29udHJvbGxlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gc2VydmljZUNvbnRyb2xsZXIobG9nZ2VyLCAkaHR0cCwgY29uZmlnKSB7XHJcbiAgICAgICAgbG9nZ2VyLmxvZyhzZXJ2aWNlSWQgKyAnIGxvYWRlZCcpO1xyXG4gICAgICAgIHZhciB1cmwgPSBjb25maWcuYXBpVXJsICsgY29uZmlnLmFwaUVuZFBvaW50cy5Vc2VyO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgYXZhaWxhYmxlUm9sZXM6IGF2YWlsYWJsZVJvbGVzLFxyXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSxcclxuICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYXZhaWxhYmxlUm9sZXMoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy9yb2xlcycpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlKHVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCB1c2VyKS50aGVuKF9zdWNjZXNzLCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ2Vycm9yJywgZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkoc2VhcmNoVGVybSkge1xyXG4gICAgICAgICAgICB2YXIgdGVybSA9IHNlYXJjaFRlcm0gPT09IG51bGwgPyAnJyA6IHNlYXJjaFRlcm07XHJcbiAgICAgICAgICAgIHZhciBzZWFyY2hVcmwgPSB1cmwgKyAnL3NlYXJjaC8nICsgdGVybTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoc2VhcmNoVXJsKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZSh1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCB1c2VyKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCArICcvJyArIGlkKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnOyBcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ1VzZXJDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIFVzZXJDb250cm9sbGVyKTtcclxuXHJcbiAgICBVc2VyQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInLCAndXNlclNlcnZpY2UnLCAnZGVmYXVsdHMnLCAnY29uZmlnJ107XHJcblxyXG4gICAgZnVuY3Rpb24gVXNlckNvbnRyb2xsZXIobG9nZ2VyLCBzZXJ2aWNlLCBkZWZhdWx0cywgY29uZmlnKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdVc2VyIE1hbmFnZXInO1xyXG4gICAgICAgIHZtLnN1YlRpdGxlID0gJ1VzZXJzJztcclxuXHJcbiAgICAgICAgdm0uZGVzY3JpcHRpb24gPSAnRWRpdCBhbmQgdXBkYXRlIHVzZXJzJztcclxuICAgICAgICB2YXIga2V5Q29kZXMgPSBjb25maWcua2V5Q29kZXM7XHJcblxyXG4gICAgICAgIHZtLmF2YWlsYWJsZVJvbGVzID0gW107XHJcbiAgICAgICAgdm0uY2xlYXJDcmVhdGUgPSBjbGVhckNyZWF0ZTtcclxuICAgICAgICB2bS5jdXJyZW50RWRpdCA9IHt9O1xyXG4gICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmxhc3REZWxldGVkID0gbnVsbDtcclxuICAgICAgICB2bS5sYXN0VXBkYXRlZCA9IG51bGw7XHJcbiAgICAgICAgdm0uaXRlbVRvRWRpdCA9IHt9O1xyXG5cclxuICAgICAgICB2bS51c2VyID0ge1xyXG4gICAgICAgICAgICAvL3VzZXJOYW1lOiBudWxsLFxyXG4gICAgICAgICAgICByb2xlczogWyd1c2VyJ10sXHJcbiAgICAgICAgICAgIGZ1bGxOYW1lOiAnJyxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6IGRlZmF1bHRzLkdFTkVSSUNfUEFTU1dPUkRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zZWFyY2hNb2RlbCA9IHtcclxuICAgICAgICAgICAgc2VhcmNoVGVybTogJydcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZyhjb250cm9sbGVySWQgKyAnIGFjdGl2YXRlZCcpO1xyXG4gICAgICAgICAgICBnZXRBdmFpbGFibGVSb2xlcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmFkZEl0ZW0gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLnVzZXIuZnVsbE5hbWUgPSBwYXJzZUZ1bGxOYW1lKHZtLnVzZXIudXNlck5hbWUpO1xyXG4gICAgICAgICAgICB2bS51c2VyLmVtYWlsID0gdm0udXNlci51c2VyTmFtZSArIGRlZmF1bHRzLkVNQUlMX1NVRkZJWDtcclxuICAgICAgICAgICAgc2VydmljZS5jcmVhdGUodm0udXNlcilcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiBtYXBwaW5nIHdvdWxkIGFsbG93IHJlbW92YWwgb2YgZXh0ZW5kIG1ldGhvZFxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXIgPSBhbmd1bGFyLmV4dGVuZCh2bS51c2VyLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS51c2Vycy51bnNoaWZ0KGFuZ3VsYXIuY29weSh2bS51c2VyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1VzZXIgJyArIHZtLnVzZXIudXNlck5hbWUgKyAnIGNyZWF0ZWQhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlci51c2VyTmFtZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiBzaG93IGVycm9yIHVzZXIgYWxyZWFkeSBleGlzdHNcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbEVkaXQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXRbaWRdID0gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZGVsZXRlSXRlbSA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuY29weSh1c2VyLCB2bS5sYXN0RGVsZXRlZCA9IHt9KTtcclxuICAgICAgICAgICAgc2VydmljZS5yZW1vdmUodXNlci5pZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IHZtLnVzZXJzLmluZGV4T2YodXNlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlcnMuc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5lZGl0SXRlbSA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0W3VzZXIuaWRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgYW5ndWxhci5jb3B5KHVzZXIsIHZtLml0ZW1Ub0VkaXQgPSB7fSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlUm9sZXMoKSB7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuYXZhaWxhYmxlUm9sZXMoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5hdmFpbGFibGVSb2xlcyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zYXZlSXRlbSA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICB2bS5jdXJyZW50RWRpdFt1c2VyLmlkXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBhbmd1bGFyLmNvcHkodXNlciwgdm0ubGFzdFVwZGF0ZWQgPSB7fSk7XHJcbiAgICAgICAgICAgIHZhciByb2xlcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLml0ZW1Ub0VkaXQucm9sZXMsXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocm9sZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJvbGVzLnB1c2gocm9sZS5uYW1lKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2bS5pdGVtVG9FZGl0LnJvbGVzID0gcm9sZXM7XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLnVwZGF0ZSh2bS5pdGVtVG9FZGl0KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh1c2VyLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnVXNlciAnICsgZGF0YS51c2VyTmFtZSArICcgdXBkYXRlZCEnKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNlYXJjaCA9IGZ1bmN0aW9uICh0YWJsZVN0YXRlKSB7XHJcbiAgICAgICAgICAgIHRhYmxlU3RhdGVSZWYgPSB0YWJsZVN0YXRlO1xyXG4gICAgICAgICAgICBpZiAodm0uc2VhcmNoTW9kZWwuc2VhcmNoVGVybSA9PT0gdW5kZWZpbmVkKSB2bS5zZWFyY2hNb2RlbC5zZWFyY2hUZXJtID0gJyc7XHJcblxyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnF1ZXJ5KHZtLnNlYXJjaE1vZGVsLnNlYXJjaFRlcm0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXJzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51bmRvRGVsZXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcm9sZXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5sYXN0RGVsZXRlZC5yb2xlcywgZnVuY3Rpb24gKHJvbGUpIHtcclxuICAgICAgICAgICAgICAgIHJvbGVzLnB1c2gocm9sZS5uYW1lKTtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ3JvbGUnLCByb2xlLm5hbWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQucm9sZXMgPSByb2xlcztcclxuICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQucGFzc3dvcmQgPSBkZWZhdWx0cy5HRU5FUklDX1BBU1NXT1JEO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS5jcmVhdGUodm0ubGFzdERlbGV0ZWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgcmVzdG9yZWQgJyArIGRhdGEudXNlck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgdm0udXNlcnMudW5zaGlmdChkYXRhKTtcclxuICAgICAgICAgICAgICAgIHZtLmxhc3REZWxldGVkID0gbnVsbDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0udW5kb0NoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlKHZtLmxhc3RVcGRhdGVkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0udXNlcnMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh1LCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5pZCA9PT0gdm0ubGFzdFVwZGF0ZWQuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS51c2Vyc1tpXSA9IHZtLmxhc3RVcGRhdGVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHJlc3RvcmVkICcgKyBkYXRhLnVzZXJOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5sYXN0VXBkYXRlZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2xlYXJDcmVhdGUoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmICgkZXZlbnQua2V5Q29kZSA9PT0ga2V5Q29kZXMuZXNjKSB7XHJcbiAgICAgICAgICAgICAgICB2bS51c2VyLnVzZXJOYW1lID0gJyc7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcGFyc2VGdWxsTmFtZShuYW1lKSB7XHJcbiAgICAgICAgICAgIHZhciBhcnIgPSBuYW1lLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgIHZhciBmdWxsbmFtZSA9ICcnO1xyXG5cclxuICAgICAgICAgICAgXy5mb3JFYWNoKGFyciwgZnVuY3Rpb24gKHYpIHtcclxuICAgICAgICAgICAgICAgIGZ1bGxuYW1lICs9IF8uY2FwaXRhbGl6ZSh2KSArICcgJztcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gXy50cmltKGZ1bGxuYW1lKTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
