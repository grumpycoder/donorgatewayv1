//mark.lawrence
//app.module.js

(function () {
    angular.module('app',
    [
        //application modules
        'app.core',
        'app.service',
        'app.filter',

        //feature areas
        'app.nav',
        'app.users',
        'app.events'
        //'app.tax',
        //'app.template',
        //'app.mailers',
        
    ]);
})();
//core.module.js
//mark.lawrence

(function () {
    angular.module('app.core',
        [
            //angular modules
            'ngMessages',
            'angularLocalStorage',
            'ngRoute',
            'ngAnimate',

            //custom modules
            'blocks.logger',
            'blocks.exception',

            //third party modules
            'smart-table',
            'ui.bootstrap',
            'ngTagsInput',
            'ngFileUpload',
            'rzModule',
            'switcher',
            'gfl.textAvatar',
            'textAngular',
            'ui.bootstrap.datetimepicker', 
            'angular-confirm' 
        ])
        .constant('toastr', toastr)
        .constant('moment', moment);

})();
//config.js
//mark.lawrence
(function () {
    function toastrConfig(toastr) {
        toastr.options.timeOut = 4000;
        toastr.options.positionClass = 'toast-bottom-right';
    };

    var keyCodes = {
        backspace: 8,
        tab: 9,
        enter: 13,
        esc: 27,
        space: 32,
        pageup: 33,
        pagedown: 34,
        end: 35,
        home: 36,
        left: 37,
        up: 38,
        right: 39,
        down: 40,
        insert: 45,
        del: 46
    };

    var apiEndPoints = {
        User: 'users',
        Constituent: 'constituent',
        Tax: 'tax',
        Template: 'template',
        Campaign: 'campaign',
        Mailer: 'mailer',
        Reason: 'reason',
        Event: 'event',
        Guest: 'guest',
        File: 'file'
    };

    var config = {
        appErrorPrefix: '[DG Error] ', //Configure the exceptionHandler decorator
        appTitle: 'DonorGateway',
        version: '1.0.0',
        apiUrl: 'http://' + window.location.host + '/api/',
        keyCodes: keyCodes,
        apiEndPoints: apiEndPoints
    };

    var defaults = {
        EMAIL_SUFFIX: '@splcenter.org',
        GENERIC_PASSWORD: '1P@ssword'
    };

    angular.module('app.core')
        .config(toastrConfig)
        .constant('config', config)
        .value('defaults', defaults);
})();
//mark.lawrence
//exception.module.js

(function () {
    angular.module('blocks.exception', ['blocks.logger']);
})();
(function () {
    'use strict';

    angular.module('blocks.logger', []);
})();
//mark.lawrence
//event.module.js

(function () {
    angular.module('app.events', []);
})();
//filter.module.js
//mark.lawrence

(function () {
    angular.module('app.filter', []);
})();
//mark.lawrence
//nav.module.js

(function () {
    angular.module('app.nav', []);
})();
//service.module.js
//mark.lawrence

(function () {
    angular.module('app.service', []);
})();
(function () {
    'use strict';

    angular.module('app.users', []);
})();
//mark.lawrence
//exception-handler.provider.js

// Include in index.html so that app level exceptions are handled.
// Exclude from testRunner.html which should run exactly what it wants to run
(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .provider('exceptionHandler', exceptionHandlerProvider)
        .config(config);

    /**
     * Must configure the exception handling
     * @return {[type]}
     */
    function exceptionHandlerProvider() {
        /* jshint validthis:true */
        this.config = {
            appErrorPrefix: undefined
        };

        this.configure = function (appErrorPrefix) {
            this.config.appErrorPrefix = appErrorPrefix;
        };

        this.$get = function () {
            return { config: this.config };
        };
    };

    /**
     * Configure by setting an optional string value for appErrorPrefix.
     * Accessible via config.appErrorPrefix (via config value).
     * @param  {[type]} $provide
     * @return {[type]}
     * @ngInject
     */
    function config($provide) {
        $provide.decorator('$exceptionHandler', extendExceptionHandler);
    };

    /**
     * Extend the $exceptionHandler service to also display a toast.
     * @param  {Object} $delegate
     * @param  {Object} exceptionHandler
     * @param  {Object} logger
     * @return {Function} the decorated $exceptionHandler service
     */
    function extendExceptionHandler($delegate, exceptionHandler, logger) {
        return function (exception, cause) {
            var appErrorPrefix = exceptionHandler.config.appErrorPrefix || '';
            var errorData = { exception: exception, cause: cause };
            exception.message = appErrorPrefix + exception.message;
            $delegate(exception, cause);
            /**
             * Could add the error to a service's collection,
             * add errors to $rootScope, log errors to remote web server,
             * or log locally. Or throw hard. It is entirely up to you.
             * throw exception;
             *
             * @example
             *     throw { message: 'error message we added' };
             */
            logger.error(exception.message, errorData);
        };
    };
})();
//mark.lawrence
//exception.js

(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .factory('exception', exception);

    /* @ngInject */
    function exception(logger) {
        var service = {
            catcher: catcher
        };

        return service;

        function catcher(message) {
            return function (reason) {
                logger.error(message, reason);
            };
        };
    };
})();
//mark.lawrence
//logger.js

(function () {
    'use strict';

    angular.module('blocks.logger').factory('logger', logger);

    logger.$inject = ['$log', 'toastr'];

    function logger($log, toastr) {
        var service = {
            showToasts: true,

            error: error,
            info: info,
            success: success,
            warning: warning,

            // straight to console; bypass toastr
            log: $log.log
        };

        return service;
        /////////////////////

        function error(message, data, title) {
            toastr.error(message, title);
            $log.error('Error: ' + message, data);
        };

        function info(message, data, title) {
            toastr.info(message, title);
            $log.info('Info: ' + message, data);
        };

        function success(message, data, title) {
            toastr.success(message, title);
            $log.info('Success: ' + message, data);
        };

        function warning(message, data, title) {
            toastr.warning(message, title);
            $log.warn('Warning: ' + message, data);
        };
    };
})();
//mark.lawrence
//clear-key.directive.js

(function () {
    angular.module('app').directive("clearKey", function () {
        return {
            restrict: 'EA',
            require: 'ngModel',
            link: function (scope, el, attrs, ctrl) {
                el.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    ctrl.$setViewValue(null);
                    ctrl.$render();
                    scope.$apply();
                });
            }
        };
    });
})();
//mark.lawrence
//date-before.directive.js

(function () {
    angular.module('app').directive('dateBefore', function ($window) {
        return {
            require: '^ngModel',
            restrict: 'A',
            link: function (scope, elem, attrs, ngModel) {
                if (!ngModel) return; // do nothing if no ng-model
                debugger;
                var dateBefore = attrs.dateBefore;
                console.log('date', dateBefore);

                // watch own value and re-validate on change
                scope.$watch(attrs.ngModel, function () {
                    validate();
                });

                // observe the other value and re-validate on change
                attrs.$observe('dateGreaterAndEqual', function (val) {
                    validate();
                });

                var validate = function () {
                    // values
                    var dateTo = angular.isDefined(ngModel.$viewValue) === true && !_.isNull(ngModel.$viewValue) ? moment(ngModel.$viewValue).toDate() : null;
                    var dateFrom = attrs.dateGreaterAndEqual !== "" ? moment(attrs.dateGreaterAndEqual.replace('"', '').replace('\\', '').replace('"', '')).toDate() : null;
                    //passing date with braces around it causes and issue therfore we need to use replace

                };
            }
        };
    });


})();
//mark.lawrence
//date-format.directive.js

(function () {
    angular.module('app')
        .directive('dateFormat',
            function (dateFilter, $parse) {
                return {
                    restrict: 'EAC',
                    require: '?ngModel',
                    link: function (scope, element, attrs, ngModel, ctrl) {
                        ngModel.$parsers.push(function (viewValue) {
                            return dateFilter(viewValue, 'MM/dd/yyyy h:mm a');
                        });
                    }
                }
            });
})();
//mark.lawrence
//date-input.directive.js

(function () {
    angular.module('app').directive('dateInput', function ($window) {
        return {
            require: '^ngModel',
            restrict: 'A',
            link: function (scope, elm, attrs, ctrl) {
                var moment = $window.moment;
                var dateFormat = attrs.dateInput;
                attrs.$observe('dateInput', function (newValue) {
                    if (dateFormat === newValue || !ctrl.$modelValue) return;
                    dateFormat = newValue;
                    ctrl.$modelValue = new Date(ctrl.$setViewValue);
                });

                ctrl.$formatters.unshift(function (modelValue) {
                    scope = scope;
                    if (!dateFormat || !modelValue) return "";
                    var retVal = moment(modelValue).format(dateFormat);
                    return retVal;
                });

                ctrl.$parsers.unshift(function (viewValue) {
                    scope = scope;
                    var date = moment(viewValue, dateFormat);
                    return (date && date.isValid() && date.year() > 1950) ? date.toDate() : "";
                });
            }
        };
    });
})();
//mark.lawrence
//smart-table.clearKey.js

(function () {
    angular.module('app').directive("stClearKey", function () {
        return {
            restrict: 'EA',
            require: '^stTable',
            link: function (scope, element, attrs, ctrl) {
                element.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    return scope.$apply(function () {
                        var fieldName = element.context.attributes['st-search'].value;
                        var tableState = ctrl.tableState();
                        tableState.search.predicateObject[fieldName] = '';
                        return ctrl.pipe();
                    });
                });
            }
        };
    });
})();
(function() {


    var app = angular.module('app');

    app.directive('toggleCheckbox', function($timeout) {

        /**
     * Directive
     */
        return {
            restrict: 'A',
            transclude: true,
            replace: false,
            require: 'ngModel',
            link: function($scope, $element, $attr, ngModel) {

                // update model from Element
                var updateModelFromElement = function() {
                    // If modified
                    var checked = $element.prop('checked');
                    if (checked !== ngModel.$viewValue) {
                        // Update ngModel
                        ngModel.$setViewValue(checked);
                        $scope.$apply();
                    }
                };

                // Update input from Model
                var updateElementFromModel = function(newValue) {
                    $element.trigger('change');
                };

                // Observe: Element changes affect Model
                $element.on('change', function() {
                    updateModelFromElement();
                });

                $scope.$watch(function() {
                    return ngModel.$viewValue;
                }, function(newValue) {
                    updateElementFromModel(newValue);
                }, true);

                // Initialise BootstrapToggle
                $element.bootstrapToggle();
            }
        };
    });
})();
//mark.lawrence
//createEvent.controller.js

(function() {
	
    'use strict';

    var controllerId = 'CreateEventController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$uibModalInstance', 'eventService'];

    function mainController(logger, $modal, service) {
        var vm = this;
        vm.title = 'Edit Guest';
        
        vm.dateFormat = "MM/DD/YYYY hh:mm";

        vm.event = {
            startDate: new Date(),
            template: {}
        };

        vm.cancel = function () {
            $modal.dismiss();
        }

        vm.save = function () {
            vm.event.template.name = vm.event.name;
            service.create(vm.event)
                .then(function (data) {
                    $modal.close(data);
                });
        }
    }

})();
//mark.lawrence
//editGuest.controller.js

(function () {
    'use strict';

    var controllerId = 'CreateGuestController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['$scope', 'logger', '$uibModalInstance', 'eventService', 'event'];

    function mainController($scope, logger, $modal, service, event) {
        var vm = this;
        vm.title = 'Create Guest';
       
        vm.guest = {
            finderNumber: '00000000000', 
            eventId: event.id
        };

        vm.ticketCountList = [];
        for (var i = 1; i < event.ticketAllowance + 1; i++) {
            vm.ticketCountList.push(i);
        }

        vm.decrementTickets = function () {
            $scope.editGuestForm.$pristine = false;
            vm.guest.additionalTickets--;
        }

        vm.incrementTickets = function (e) {
            $scope.editGuestForm.$pristine = false;
            vm.guest.additionalTickets++;
        }

        vm.cancel = function () {
            $modal.dismiss();
        }

        vm.changeAttending = function () {
            if (vm.guest.isAttending) {
                vm.guest.ticketCount = 1;
            } else {
                vm.guest.ticketCount = null;
            }
        }

        vm.save = function () {
            service.registerGuest(vm.guest)
                            .then(function (data) {
                                angular.extend(vm.guest, data);
                                $modal.close(vm.guest);
                            });
        }
    }


})();
//mark.lawrence
//editGuest.controller.js

(function () {
    'use strict';

    var controllerId = 'EditGuestController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['$scope', 'logger', '$uibModalInstance', 'eventService', 'guest'];

    function mainController($scope, logger, $modal, service, guest) {
        var vm = this;
        vm.title = 'Edit Guest';

        if (guest.isAttending) {
            vm.showAddTicket = true;
        }

        vm.guest = angular.copy(guest);

        vm.ticketCountList = [];
        for (var i = 1; i < guest.event.ticketAllowance + 1; i++) {
            vm.ticketCountList.push(i);
        }
        
        vm.decrementTickets = function () {
            $scope.editGuestForm.$pristine = false;
            vm.guest.additionalTickets--;
        }

        vm.incrementTickets = function (e) {
            $scope.editGuestForm.$pristine = false; 
            vm.guest.additionalTickets++;
        }
        
        vm.cancel = function () {
            $modal.dismiss();
        }

        vm.changeAttending = function () {
            if (vm.guest.isAttending) {
                vm.guest.ticketCount = 1;
            } else {
                vm.guest.ticketCount = null;
            }
        }

        vm.save = function () {

            if (vm.showAddTicket) {
                service.addTicket(vm.guest)
                    .then(function (data) {
                        angular.extend(vm.guest, data);
                        $modal.close(vm.guest);
                    });
            } else {
                service.registerGuest(vm.guest)
                    .then(function(data) {
                        angular.extend(vm.guest, data);
                        $modal.close(vm.guest);
                    });
            }
        }
    }


})();
//mark.lawrence
//events.js

(function () {
    'use strict';

    var controllerId = 'EventController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$uibModal', 'eventService', 'guestService', 'templateService'];

    function mainController(logger, $modal, service, guestService, templateService) {
        var vm = this;
        var tableStateRef;
        var pageSizeDefault = 10;

        //TODO: hostLocation needs to be dynamic to environment
        vm.hostLocation = 'rsvp-test/';

        vm.title = 'Event Manager';
        vm.description = "Manage Donor Events";
        vm.currentDate = new Date();

        vm.dateOptions = {
            dateDisabled: false,
            formatYear: 'yy',
            maxDate: new Date(2020, 5, 22),
            minDate: new Date(),
            startingDay: 1
        };

        vm.dateFormat = "MM/DD/YYYY h:mm a";
        vm.events = [];

        vm.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'asc'
        };

        vm.tabs = [
            { title: 'Details', template: 'app/events/views/home.html', active: false, icon: 'fa-info-circle' },
            { title: 'Guests', template: 'app/events/views/guest-list.html', active: true, icon: 'fa-users' },
            //{ title: 'Mail Queue', template: 'app/events/views/mail-queue.html', active: false, icon: '' },
            //{ title: 'Waiting Queue', template: 'app/events/views/wait-queue.html', active: false, icon: '' },
            { title: 'Template', template: 'app/events/views/template.html', active: false, icon: 'fa-file-text' }
        ];

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            getEvents().then(function () {
                logger.log('loaded events');
            });
        }

        vm.addToMailQueue = function (guest) {
            vm.isBusy = true;
            service.addToMail(guest)
                .then(function (data) {
                    logger.info('Added Guest to Queue: ' + data.name);
                    angular.extend(guest, data);
                    logger.success('Issued ticket to: ' + guest.name);

                    var event = angular.copy(vm.selectedEvent);
                    angular.extend(vm.selectedEvent, guest.event);
                    vm.selectedEvent.guests = event.guests;
                }).finally(function () {
                    //complete();
                    vm.isBusy = false;
                });
        }

        vm.changeEvent = function () {
            if (!vm.selectedEvent) return;
            //RESET VALUES
            vm.searchModel = {
                page: 1,
                pageSize: pageSizeDefault,
                orderBy: 'id',
                orderDirection: 'asc'
            };
            vm.showWaitList = false;
            vm.showMailQueue = false;
            vm.tabs[0].active = true;

            vm.isBusy = true;
            service.getById(vm.selectedEvent.id)
                .then(function (data) {
                    angular.extend(vm.selectedEvent, data);
                }).finally(function () {
                    vm.isBusy = false;
                    vm.searchGuests(tableStateRef);
                });

        }

        vm.refreshGuests = function () {
            vm.searchGuests(tableStateRef);
        }

        vm.deleteEvent = function (id) {
            //TODO: Confirmation on delete
            vm.isBusy = true;
            service.remove(id)
                .then(function () {
                    vm.selectedEvent = undefined;
                    logger.success('Deleted event');
                }).finally(function () {
                    vm.isBusy = false;
                    getEvents();
                });
        }

        vm.exportGuests = function () {
            vm.isBusy = true;
            service.downloadGuests(vm.selectedEvent.id, vm.searchModel)
                .then(function (data) {
                    var contentType = data.headers()['content-type'];
                    var filename = data.headers()['x-filename'];

                    var linkElement = document.createElement('a');
                    try {
                        var blob = new Blob([data.data], { type: contentType });
                        var url = window.URL.createObjectURL(blob);

                        linkElement.setAttribute('href', url);
                        linkElement.setAttribute("download", filename);

                        var clickEvent = new MouseEvent("click", {
                            "view": window,
                            "bubbles": true,
                            "cancelable": false
                        });
                        linkElement.dispatchEvent(clickEvent);
                    } catch (ex) {
                        logger.log(ex);
                    }
                }).finally(function () {
                    vm.isBusy = false;
                });
        }

        vm.createGuest = function () {

            $modal.open({
                templateUrl: '/app/events/views/edit-guest.html',
                controller: 'CreateGuestController',
                controllerAs: 'vm', 
                resolve: {
                    event: vm.selectedEvent
                }
            }).result.then(function (result) {
                
                var event = angular.copy(vm.selectedEvent);
                angular.extend(vm.selectedEvent, result.event);
                vm.selectedEvent.guests = event.guests;

                vm.selectedEvent.guests.unshift(result);
            });
        }

        vm.registerGuest = function (guest) {
           
            $modal.open({
                templateUrl: '/app/events/views/edit-guest.html',
                controller: 'EditGuestController',
                controllerAs: 'vm',
                resolve: {
                    guest: guest
                }
            }).result.then(function (result) {
                angular.extend(guest, result);
                var event = angular.copy(vm.selectedEvent);
                angular.extend(vm.selectedEvent, result.event);
                vm.selectedEvent.guests = event.guests;
            });
        }

        vm.toggleWaiting = function () {
            vm.showWaiting = !vm.showWaiting;
            vm.showMail = false;
            vm.showSent = false; 
            vm.searchModel.page = 1;
            vm.searchGuests(tableStateRef);
        }

        vm.toggleMail = function () {
            vm.showMail = !vm.showMail;
            vm.showWaiting = false;
            vm.showSent = false;
            vm.searchModel.page = 1;
            vm.searchGuests(tableStateRef);
        }

        vm.toggleSent = function() {
            vm.showSent = !vm.showSent;
            vm.showWaiting = false;
            vm.showMail = false; 
            vm.searchModel.page = 1;
            vm.searchGuests(tableStateRef);
        }

        vm.mailTicket = function (guest) {
            vm.isBusy = true;
            guest.isMailed = true;
            guest.mailedDate = new Date();
            vm.isWaiting = false;
            service.mailTicket(guest)
                        .then(function (data) {
                            angular.extend(guest, data);
                            logger.success('Issued ticket to: ' + guest.name);

                            var event = angular.copy(vm.selectedEvent);
                            angular.extend(vm.selectedEvent, guest.event);
                            vm.selectedEvent.guests = event.guests;

                        }).finally(function () {
                            vm.isBusy = false;
                        });
        }

        vm.searchGuests = function (tableState) {
            tableStateRef = tableState;
            if (!vm.selectedEvent) return false;

            if (typeof (tableState.sort.predicate) !== "undefined") {
                vm.searchModel.orderBy = tableState.sort.predicate;
                vm.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }
            if (typeof (tableState.search.predicateObject) !== "undefined") {
                vm.searchModel.name = tableState.search.predicateObject.name;
                vm.searchModel.address = tableState.search.predicateObject.address;
                vm.searchModel.city = tableState.search.predicateObject.city;
                vm.searchModel.state = tableState.search.predicateObject.state;
                vm.searchModel.zipcode = tableState.search.predicateObject.zipcode;
                vm.searchModel.guestCount = tableState.search.predicateObject.guestCount;
                vm.searchModel.phone = tableState.search.predicateObject.phone;
                vm.searchModel.email = tableState.search.predicateObject.email;
                vm.searchModel.accountId = tableState.search.predicateObject.accountId;
                vm.searchModel.finderNumber = tableState.search.predicateObject.finderNumber;
                vm.searchModel.isMailed = tableState.search.predicateObject.isMailed;
            }

            vm.searchModel.isAttending = null;
            vm.searchModel.isWaiting = null;
            vm.searchModel.isMailed = null; 

            if (vm.showWaiting) {
                vm.searchModel.isWaiting = vm.showWaiting ? vm.showWaiting : null;
            }

            if (vm.showMail) {
                vm.searchModel.isWaiting = false;
                vm.searchModel.isMailed = false;
                vm.searchModel.isAttending = true;
            }

            if (vm.showSent) {
                vm.searchModel.isWaiting = false;
                vm.searchModel.isMailed = true;
                vm.searchModel.isAttending = true;
            }

            vm.isBusy = true;
            return service.getGuests(vm.selectedEvent.id, vm.searchModel)
                .then(function (data) {
                    vm.selectedEvent.guests = data.items;
                    vm.searchModel = data;
                    vm.isBusy = false;
                });

        }

        vm.paged = function paged() {
            vm.searchGuests(tableStateRef);
        };

        vm.saveEvent = function (form) {
            vm.isBusy = true;
            return service.update(vm.selectedEvent)
                .then(function (data) {
                    var guests = vm.selectedEvent.guests;
                    angular.extend(vm.selectedEvent, data);

                    vm.selectedEvent.guests = guests;
                    logger.success('Saved Event: ' + data.name);
                })
                .finally(function () {
                    form.$setPristine();
                    vm.isBusy = false;
                });
        }

        vm.fileSelected = function ($files, $file) {
            //TODO: Called multiple times. Error on directory selection of file. 
            var reader = new FileReader();
            reader.onloadstart = function () {
                vm.isBusy = true;
            };
            reader.onloadend = function () {
                vm.isBusy = false;
            }
            reader.onload = function () {
                debugger;
                var dataUrl = reader.result;
                vm.selectedEvent.template.image = dataUrl.split(",")[1];
                vm.selectedEvent.template.mimeType = $file.type;
            };
            reader.readAsDataURL($file);

        };

        vm.saveTemplate = function () {
            vm.isBusy = true;
            templateService.update(vm.selectedEvent.template)
                .then(function (data) {
                    vm.selectedEvent.template = angular.extend(vm.selectedEvent.template, data);
                    logger.success('Saved template: ' + data.name);
                }).finally(function () {
                    vm.isBusy = false;
                });
        }

        vm.toggleCancel = function (form) {
            vm.selectedEvent.isCancelled = !vm.selectedEvent.isCancelled;
            vm.saveEvent(form).then(function () {
                if (vm.selectedEvent.isCancelled) {
                    logger.warning('Cancelled event');
                } else {
                    logger.info('Restored event');
                }
            });
        }

        vm.showCreateEvent = function () {
            $modal.open({
                templateUrl: '/app/events/views/create-event.html',
                controller: 'CreateEventController',
                controllerAs: 'vm'
            }).result.then(function (data) {
                vm.selectedEvent = data;
                vm.events.unshift(vm.selectedEvent);
                logger.success('Successfully created ' + data.name);
            });
        }

        vm.showGuestUpload = function () {
            $modal.open({
                keyboard: false,
                backdrop: 'static',
                templateUrl: '/app/events/views/guest-upload.html',
                //controller: ['logger', '$uibModalInstance', 'fileService', 'selectedEvent', UploadGuestController],
                controller: 'UploadGuestController',
                controllerAs: 'vm',
                resolve: {
                    event: vm.selectedEvent
                }
            }).result.then(function (result) {
                if (result.success) {
                    logger.success(result.message);
                } else {
                    logger.error(result.message);
                }
                vm.changeEvent();
            });
        }

        function getEvents() {
            vm.isBusy = true;
            return service.get()
                .then(function (data) {
                    vm.events = data;
                }).finally(function () {
                    vm.isBusy = false;
                });
        }

    };

})();
//mark.lawrence
//uploadGuest.controller.js

(function() {
	
    'use strict';

    var controllerId = 'UploadGuestController';

    angular.module('app.events').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$uibModalInstance', 'fileService', 'event'];

    function mainController(logger, $modal, service, event) {
        var vm = this;
        vm.title = 'Edit Guest';

        vm.event = event;

        vm.cancel = function () {
            vm.file = undefined;
            $modal.dismiss();
        }

        vm.fileSelected = function ($file, $event) {
            vm.result = null;
        };
        
        vm.save = function () {
            vm.isBusy = true;
            vm.result = {
                success: false
            }

            service.guest(vm.event.id, vm.file)
                    .then(function (data) {
                        vm.result.success = true;
                        vm.result.message = data;
                    }).catch(function (error) {
                        vm.result.message = error.data.message;
                    }).finally(function () {
                        vm.file = undefined;
                        vm.isBusy = false;
                        $modal.close(vm.result);
                    });
        }
    }

})();
//app.filter.js
//mark.lawrence

angular.module('app.filter').filter('percentage', ['$filter', function ($filter) {
    return function (input, decimals) {
        return $filter('number')(input * 100, decimals) + '%';
    };
}]);

angular.module('app.filter', []).filter('checkmark', function () {
    return function (input) {
        return input ? '\u2713' : '\u2718';
    };
});

angular.module('app.filter').filter('yesNo', function () {
    return function (input) {
        return input ? 'Yes' : 'No';
    }
});

angular.module('app.filter').filter('updateStatus', function () {
    return function (input) {
        if (input === 1) {
            return 'Unchanged';
        }
        if (input === 2) {
            return 'Changed';
        }
        if (input === 6) {
            return 'Reconciled';
        }
        return "";
    };
});
//mark.lawrence
//nav.js

(function () {
    'use strict';

    var controllerId = 'NavController';

    angular.module('app.nav').controller(controllerId, mainController);

    mainController.$inject = ['logger'];

    function mainController(logger) {
        var vm = this;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            vm.user = JSON.parse(localStorage.getItem('currentUser'));
        }
    };
})();
//mark.lawrence
//event.service.js

(function () {
    'use strict';

    var serviceId = 'eventService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Event;
        var service = {
            create: create,
            downloadGuests: downloadGuests, 
            remove: remove,
            get: get,
            getById: getById,
            getGuests: getGuests, 
            query: query,
            update: update,
            addToMail: addToMail, 
            registerGuest: registerGuest,
            mailTicket: mailTicket, 
            addTicket: addTicket
        }
        return service;

        function create(event) {
            return $http.post(url, event)
                .then(_success).catch(error);
        }

        function downloadGuests(id, vm) {
            return $http.post(url + '/' + id + '/guests/export', vm)
                .then(function(data) {
                    return data;
                }).catch(error);
        }


        function remove(id) {
            return $http.delete(url + '/' + id).then(_success).catch(error);
        };

        function get() {
            return $http.get(url)
                .then(_success).catch(error);
        }

        function getById(id) {
            return $http.get(url + '/' + id)
                .then(_success).catch(error);
        }

        function getGuests(id, vm) {
            return $http.post(url + '/' + id + '/guests', vm)
                .then(_success).catch(error);
        }

        function mailTicket(guest) {
            return $http.post(url + '/' + guest.eventId + '/mailticket', guest).then(_success).catch(error);
        }

        function addTicket(guest) {
            return $http.post(url + '/' + guest.eventId + '/addticket', guest).then(_success).catch(error);
        }

        function addToMail(guest) {
            return $http.post(url + '/' + guest.eventId + '/addtomail', guest).then(_success).catch(error);
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(_success).catch(error);
        }

        function registerGuest(guest) {
            return $http.post(url + '/' + guest.eventId + '/registerguest' , guest).then(_success).catch(error);
        }

        function update(event) {
            return $http.put(url, event)
                .then(_success).catch(error);
        }

        function _success(response) {
            return response.data;
        };

        function error(error) {
            return error.data.message; 
        }
    }
})();
//mark.lawrence
//file.service.js

(function () {

    'use strict';

    var serviceId = 'fileService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.File;

        var service = {
            guest: guest
        }

        return service;

        function guest(id, datafile) {
            return $http.post(url + '/guest/' + id, formDataObject(datafile), {
                transformRequest: angular.identity,
                headers: { 'Content-Type': undefined }
            }).then(function (response) {
                return response.data;
            });
        }

        function formDataObject(data) {
            var fd = new FormData();
            fd.append('file', data);
            return fd;
        }
    }
})();
//mark.lawrence
//guest.service.js

(function () {
    'use strict';

    var serviceId = 'guestService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Guest;

        var service = {
            create: create,
            remove: remove,
            get: get,
            getById: getById,
            update: update,
            query: query
        }

        return service;

        function create(event) {
            return $http.post(url, event)
                .then(function (response) {
                    return response.data;
                });
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        };

        function get() {
            return $http.get(url)
                .then(function (response) {
                    return response.data;
                });
        }

        function getById(id) {
            return $http.get(url + '/' + id)
                .then(function (response) {
                    return response.data;
                });
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(function (response) {
                    return response.data;
                });
        }

        function update(event) {
            return $http.put(url, event)
                .then(function (response) {
                    return response.data;
                });
        }

        function _success(response) {
            return response.data;
        };
    }
})();
//template.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'templateService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Template;

        var service = {
            get: get,
            update: update,
            query: query
            //            remove: remove,
            //            save: save,
            //            search: search,
        }

        return service;

        function get() {
            return $http.get(url)
                .then(function (response) {
                    return response.data;
                });
        }

        function query(name) {
            return $http.get(url + '/' + name)
                .then(function (response) {
                    return response.data;
                });
        }

        function update(template) {
            return $http.put(url, template)
                .then(function (response) {
                    return response.data;
                });
        }
    }
})();
//user.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'userService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.User;

        var service = {
            availableRoles: availableRoles,
            create: create,
            get: get,
            query: query,
            remove: remove,
            update: update
        }

        return service;

        function availableRoles() {
            return $http.get(url + '/roles').then(_success);
        }

        function create(user) {
            return $http.post(url, user).then(_success, function (error) {
                logger.log('error', error);
            });
        }

        function get() {
            return $http.get(url).then(_success);
        }

        function query(searchTerm) {
            var searchUrl = url + '/search/';

            if (searchTerm != undefined && searchTerm.length > 0) {
                searchUrl += '?' + searchTerm;
            };
            return $http.get(searchUrl).then(_success);
        }

        function update(user) {
            return $http.put(url, user).then(_success);
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        }

        function _success(response) {
            return response.data;
        }
    }
})();
(function () {
    'use strict'; 

    var controllerId = 'UserController';

    angular.module('app.users').controller(controllerId, UserController);

    UserController.$inject = ['logger', 'userService', 'defaults', 'config'];

    function UserController(logger, service, defaults, config) {
        var vm = this;
        vm.title = 'User Manager';
        vm.description = 'Edit and update users';
        var keyCodes = config.keyCodes;

        vm.availableRoles = [];
        vm.clearCreate = clearCreate;
        vm.currentEdit = {};
        vm.isBusy = false;
        vm.lastDeleted = null;
        vm.lastUpdated = null;
        vm.itemToEdit = {};

        vm.user = {
            //userName: null,
            roles: ['user'],
            fullName: '',
            password: defaults.GENERIC_PASSWORD
        };

        var tableStateRef;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            getAvailableRoles();
        };

        vm.addItem = function () {
            vm.user.fullName = parseFullName(vm.user.userName);
            vm.user.email = vm.user.userName + defaults.EMAIL_SUFFIX;
            service.create(vm.user)
                .then(function (data) {
                    //TODO: mapping would allow removal of extend method
                    vm.user = angular.extend(vm.user, data);
                    vm.users.unshift(angular.copy(vm.user));
                    logger.success('User ' + vm.user.userName + ' created!');
                    vm.user.userName = null;
                    //TODO: show error user already exists
                });
        };

        vm.cancelEdit = function (id) {
            vm.currentEdit[id] = false;
        };

        vm.deleteItem = function (user) {
            angular.copy(user, vm.lastDeleted = {});
            service.remove(user.id)
                .then(function (data) {
                    var idx = vm.users.indexOf(user);
                    vm.users.splice(idx, 1);
                });
        };

        vm.editItem = function (user) {
            vm.currentEdit[user.id] = true;
            angular.copy(user, vm.itemToEdit = {});
        };

        function getAvailableRoles() {
            service.availableRoles()
                .then(function (data) {
                    vm.availableRoles = data;
                });
        };

        vm.saveItem = function (user) {
            vm.isBusy = true;

            vm.currentEdit[user.id] = false;
            angular.copy(user, vm.lastUpdated = {});
            var roles = [];

            _.forEach(vm.itemToEdit.roles,
                function (role) {
                    roles.push(role.name);
                });
            vm.itemToEdit.roles = roles;

            service.update(vm.itemToEdit)
                .then(function (data) {
                    angular.extend(user, data);
                    logger.success('User ' + data.userName + ' updated!');
                    vm.isBusy = false;
                });
        };

        vm.search = function (tableState) {
            tableStateRef = tableState;
            var searchTerm;

            if (typeof (tableState.search.predicateObject) != 'undefined') {
                searchTerm = tableState.search.predicateObject.searchTerm;
            }

            vm.isBusy = true;
            service.query(searchTerm)
                .then(function (data) {
                    vm.users = data;
                    logger.log('users', vm.users);
                })
                .finally(function () {
                    vm.isBusy = false;
                });
        };

        vm.undoDelete = function () {
            var roles = [];

            _.forEach(vm.lastDeleted.roles, function (role) {
                roles.push(role.name);
                logger.log('role', role.name);
            });
            vm.lastDeleted.roles = roles;
            vm.lastDeleted.password = defaults.GENERIC_PASSWORD;

            service.create(vm.lastDeleted).then(function (data) {
                logger.success('Successfully restored ' + data.userName);
                vm.users.unshift(data);
                vm.lastDeleted = null;
            });
        };

        vm.undoChange = function () {
            vm.isBusy = true;

            service.update(vm.lastUpdated)
                .then(function (data) {
                    angular.forEach(vm.users,
                        function (u, i) {
                            if (u.id === vm.lastUpdated.id) {
                                vm.users[i] = vm.lastUpdated;
                            }
                        });
                    logger.success('Successfully restored ' + data.userName);
                    vm.lastUpdated = null;
                })
                .finally(function () {
                    vm.isBusy = false;
                });
        };

        function clearCreate($event) {
            if ($event.keyCode === keyCodes.esc) {
                vm.user.userName = '';
            };
        };

        function parseFullName(name) {
            var arr = name.split('.');
            var fullname = '';

            _.forEach(arr, function (v) {
                fullname += _.capitalize(v) + ' ';
            });

            return _.trim(fullname);
        };
    };
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb3JlL2NvcmUubW9kdWxlLmpzIiwiY29yZS9jb25maWcuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5tb2R1bGUuanMiLCJibG9ja3MvbG9nZ2VyL2xvZ2dlci5tb2R1bGUuanMiLCJldmVudHMvZXZlbnQubW9kdWxlLmpzIiwiZmlsdGVycy9maWx0ZXIubW9kdWxlLmpzIiwibmF2L25hdi5tb2R1bGUuanMiLCJzZXJ2aWNlcy9zZXJ2aWNlLm1vZHVsZS5qcyIsInVzZXJzL3VzZXJzLm1vZHVsZS5qcyIsImJsb2Nrcy9leGNlcHRpb24vZXhjZXB0aW9uLWhhbmRsZXIucHJvdmlkZXIuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5qcyIsImJsb2Nrcy9sb2dnZXIvbG9nZ2VyLmpzIiwiZGlyZWN0aXZlcy9jbGVhci1rZXkuZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9kYXRlLWJlZm9yZS5qcyIsImRpcmVjdGl2ZXMvZGF0ZS1mb3JtYXQuZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9kYXRlLWlucHV0LmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvc21hcnQtdGFibGUuZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy90b2dnbGVDaGVja2JveC5kaXJlY3RpdmUuanMiLCJldmVudHMvY3JlYXRlRXZlbnQuY29udHJvbGxlci5qcyIsImV2ZW50cy9jcmVhdGVHdWVzdC5jb250cm9sbGVyLmpzIiwiZXZlbnRzL2VkaXRHdWVzdC5jb250cm9sbGVyLmpzIiwiZXZlbnRzL2V2ZW50cy5qcyIsImV2ZW50cy91cGxvYWRHdWVzdC5jb250cm9sbGVyLmpzIiwiZmlsdGVycy9hcHAuZmlsdGVycy5qcyIsIm5hdi9uYXYuanMiLCJzZXJ2aWNlcy9ldmVudC5zZXJ2aWNlLmpzIiwic2VydmljZXMvZmlsZS5zZXJ2aWNlLmpzIiwic2VydmljZXMvZ3Vlc3Quc2VydmljZS5qcyIsInNlcnZpY2VzL3RlbXBsYXRlLnNlcnZpY2UuanMiLCJzZXJ2aWNlcy91c2VyLnNlcnZpY2UuanMiLCJ1c2Vycy91c2Vycy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9YQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibW9kdWxlcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL21hcmsubGF3cmVuY2VcclxuLy9hcHAubW9kdWxlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcsXHJcbiAgICBbXHJcbiAgICAgICAgLy9hcHBsaWNhdGlvbiBtb2R1bGVzXHJcbiAgICAgICAgJ2FwcC5jb3JlJyxcclxuICAgICAgICAnYXBwLnNlcnZpY2UnLFxyXG4gICAgICAgICdhcHAuZmlsdGVyJyxcclxuXHJcbiAgICAgICAgLy9mZWF0dXJlIGFyZWFzXHJcbiAgICAgICAgJ2FwcC5uYXYnLFxyXG4gICAgICAgICdhcHAudXNlcnMnLFxyXG4gICAgICAgICdhcHAuZXZlbnRzJ1xyXG4gICAgICAgIC8vJ2FwcC50YXgnLFxyXG4gICAgICAgIC8vJ2FwcC50ZW1wbGF0ZScsXHJcbiAgICAgICAgLy8nYXBwLm1haWxlcnMnLFxyXG4gICAgICAgIFxyXG4gICAgXSk7XHJcbn0pKCk7IiwiLy9jb3JlLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvcmUnLFxyXG4gICAgICAgIFtcclxuICAgICAgICAgICAgLy9hbmd1bGFyIG1vZHVsZXNcclxuICAgICAgICAgICAgJ25nTWVzc2FnZXMnLFxyXG4gICAgICAgICAgICAnYW5ndWxhckxvY2FsU3RvcmFnZScsXHJcbiAgICAgICAgICAgICduZ1JvdXRlJyxcclxuICAgICAgICAgICAgJ25nQW5pbWF0ZScsXHJcblxyXG4gICAgICAgICAgICAvL2N1c3RvbSBtb2R1bGVzXHJcbiAgICAgICAgICAgICdibG9ja3MubG9nZ2VyJyxcclxuICAgICAgICAgICAgJ2Jsb2Nrcy5leGNlcHRpb24nLFxyXG5cclxuICAgICAgICAgICAgLy90aGlyZCBwYXJ0eSBtb2R1bGVzXHJcbiAgICAgICAgICAgICdzbWFydC10YWJsZScsXHJcbiAgICAgICAgICAgICd1aS5ib290c3RyYXAnLFxyXG4gICAgICAgICAgICAnbmdUYWdzSW5wdXQnLFxyXG4gICAgICAgICAgICAnbmdGaWxlVXBsb2FkJyxcclxuICAgICAgICAgICAgJ3J6TW9kdWxlJyxcclxuICAgICAgICAgICAgJ3N3aXRjaGVyJyxcclxuICAgICAgICAgICAgJ2dmbC50ZXh0QXZhdGFyJyxcclxuICAgICAgICAgICAgJ3RleHRBbmd1bGFyJyxcclxuICAgICAgICAgICAgJ3VpLmJvb3RzdHJhcC5kYXRldGltZXBpY2tlcicsIFxyXG4gICAgICAgICAgICAnYW5ndWxhci1jb25maXJtJyBcclxuICAgICAgICBdKVxyXG4gICAgICAgIC5jb25zdGFudCgndG9hc3RyJywgdG9hc3RyKVxyXG4gICAgICAgIC5jb25zdGFudCgnbW9tZW50JywgbW9tZW50KTtcclxuXHJcbn0pKCk7IiwiLy9jb25maWcuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiB0b2FzdHJDb25maWcodG9hc3RyKSB7XHJcbiAgICAgICAgdG9hc3RyLm9wdGlvbnMudGltZU91dCA9IDQwMDA7XHJcbiAgICAgICAgdG9hc3RyLm9wdGlvbnMucG9zaXRpb25DbGFzcyA9ICd0b2FzdC1ib3R0b20tcmlnaHQnO1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIga2V5Q29kZXMgPSB7XHJcbiAgICAgICAgYmFja3NwYWNlOiA4LFxyXG4gICAgICAgIHRhYjogOSxcclxuICAgICAgICBlbnRlcjogMTMsXHJcbiAgICAgICAgZXNjOiAyNyxcclxuICAgICAgICBzcGFjZTogMzIsXHJcbiAgICAgICAgcGFnZXVwOiAzMyxcclxuICAgICAgICBwYWdlZG93bjogMzQsXHJcbiAgICAgICAgZW5kOiAzNSxcclxuICAgICAgICBob21lOiAzNixcclxuICAgICAgICBsZWZ0OiAzNyxcclxuICAgICAgICB1cDogMzgsXHJcbiAgICAgICAgcmlnaHQ6IDM5LFxyXG4gICAgICAgIGRvd246IDQwLFxyXG4gICAgICAgIGluc2VydDogNDUsXHJcbiAgICAgICAgZGVsOiA0NlxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgYXBpRW5kUG9pbnRzID0ge1xyXG4gICAgICAgIFVzZXI6ICd1c2VycycsXHJcbiAgICAgICAgQ29uc3RpdHVlbnQ6ICdjb25zdGl0dWVudCcsXHJcbiAgICAgICAgVGF4OiAndGF4JyxcclxuICAgICAgICBUZW1wbGF0ZTogJ3RlbXBsYXRlJyxcclxuICAgICAgICBDYW1wYWlnbjogJ2NhbXBhaWduJyxcclxuICAgICAgICBNYWlsZXI6ICdtYWlsZXInLFxyXG4gICAgICAgIFJlYXNvbjogJ3JlYXNvbicsXHJcbiAgICAgICAgRXZlbnQ6ICdldmVudCcsXHJcbiAgICAgICAgR3Vlc3Q6ICdndWVzdCcsXHJcbiAgICAgICAgRmlsZTogJ2ZpbGUnXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBjb25maWcgPSB7XHJcbiAgICAgICAgYXBwRXJyb3JQcmVmaXg6ICdbREcgRXJyb3JdICcsIC8vQ29uZmlndXJlIHRoZSBleGNlcHRpb25IYW5kbGVyIGRlY29yYXRvclxyXG4gICAgICAgIGFwcFRpdGxlOiAnRG9ub3JHYXRld2F5JyxcclxuICAgICAgICB2ZXJzaW9uOiAnMS4wLjAnLFxyXG4gICAgICAgIGFwaVVybDogJ2h0dHA6Ly8nICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyAnL2FwaS8nLFxyXG4gICAgICAgIGtleUNvZGVzOiBrZXlDb2RlcyxcclxuICAgICAgICBhcGlFbmRQb2ludHM6IGFwaUVuZFBvaW50c1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgRU1BSUxfU1VGRklYOiAnQHNwbGNlbnRlci5vcmcnLFxyXG4gICAgICAgIEdFTkVSSUNfUEFTU1dPUkQ6ICcxUEBzc3dvcmQnXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29yZScpXHJcbiAgICAgICAgLmNvbmZpZyh0b2FzdHJDb25maWcpXHJcbiAgICAgICAgLmNvbnN0YW50KCdjb25maWcnLCBjb25maWcpXHJcbiAgICAgICAgLnZhbHVlKCdkZWZhdWx0cycsIGRlZmF1bHRzKTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9leGNlcHRpb24ubW9kdWxlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2Jsb2Nrcy5leGNlcHRpb24nLCBbJ2Jsb2Nrcy5sb2dnZXInXSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmxvY2tzLmxvZ2dlcicsIFtdKTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9ldmVudC5tb2R1bGUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmV2ZW50cycsIFtdKTtcclxufSkoKTsiLCIvL2ZpbHRlci5tb2R1bGUuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXInLCBbXSk7XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vbmF2Lm1vZHVsZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubmF2JywgW10pO1xyXG59KSgpOyIsIi8vc2VydmljZS5tb2R1bGUuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJywgW10pO1xyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC51c2VycycsIFtdKTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9leGNlcHRpb24taGFuZGxlci5wcm92aWRlci5qc1xyXG5cclxuLy8gSW5jbHVkZSBpbiBpbmRleC5odG1sIHNvIHRoYXQgYXBwIGxldmVsIGV4Y2VwdGlvbnMgYXJlIGhhbmRsZWQuXHJcbi8vIEV4Y2x1ZGUgZnJvbSB0ZXN0UnVubmVyLmh0bWwgd2hpY2ggc2hvdWxkIHJ1biBleGFjdGx5IHdoYXQgaXQgd2FudHMgdG8gcnVuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2Jsb2Nrcy5leGNlcHRpb24nKVxyXG4gICAgICAgIC5wcm92aWRlcignZXhjZXB0aW9uSGFuZGxlcicsIGV4Y2VwdGlvbkhhbmRsZXJQcm92aWRlcilcclxuICAgICAgICAuY29uZmlnKGNvbmZpZyk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNdXN0IGNvbmZpZ3VyZSB0aGUgZXhjZXB0aW9uIGhhbmRsaW5nXHJcbiAgICAgKiBAcmV0dXJuIHtbdHlwZV19XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGV4Y2VwdGlvbkhhbmRsZXJQcm92aWRlcigpIHtcclxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cclxuICAgICAgICB0aGlzLmNvbmZpZyA9IHtcclxuICAgICAgICAgICAgYXBwRXJyb3JQcmVmaXg6IHVuZGVmaW5lZFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuY29uZmlndXJlID0gZnVuY3Rpb24gKGFwcEVycm9yUHJlZml4KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmFwcEVycm9yUHJlZml4ID0gYXBwRXJyb3JQcmVmaXg7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy4kZ2V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4geyBjb25maWc6IHRoaXMuY29uZmlnIH07XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDb25maWd1cmUgYnkgc2V0dGluZyBhbiBvcHRpb25hbCBzdHJpbmcgdmFsdWUgZm9yIGFwcEVycm9yUHJlZml4LlxyXG4gICAgICogQWNjZXNzaWJsZSB2aWEgY29uZmlnLmFwcEVycm9yUHJlZml4ICh2aWEgY29uZmlnIHZhbHVlKS5cclxuICAgICAqIEBwYXJhbSAge1t0eXBlXX0gJHByb3ZpZGVcclxuICAgICAqIEByZXR1cm4ge1t0eXBlXX1cclxuICAgICAqIEBuZ0luamVjdFxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBjb25maWcoJHByb3ZpZGUpIHtcclxuICAgICAgICAkcHJvdmlkZS5kZWNvcmF0b3IoJyRleGNlcHRpb25IYW5kbGVyJywgZXh0ZW5kRXhjZXB0aW9uSGFuZGxlcik7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogRXh0ZW5kIHRoZSAkZXhjZXB0aW9uSGFuZGxlciBzZXJ2aWNlIHRvIGFsc28gZGlzcGxheSBhIHRvYXN0LlxyXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSAkZGVsZWdhdGVcclxuICAgICAqIEBwYXJhbSAge09iamVjdH0gZXhjZXB0aW9uSGFuZGxlclxyXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBsb2dnZXJcclxuICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufSB0aGUgZGVjb3JhdGVkICRleGNlcHRpb25IYW5kbGVyIHNlcnZpY2VcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gZXh0ZW5kRXhjZXB0aW9uSGFuZGxlcigkZGVsZWdhdGUsIGV4Y2VwdGlvbkhhbmRsZXIsIGxvZ2dlcikge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZXhjZXB0aW9uLCBjYXVzZSkge1xyXG4gICAgICAgICAgICB2YXIgYXBwRXJyb3JQcmVmaXggPSBleGNlcHRpb25IYW5kbGVyLmNvbmZpZy5hcHBFcnJvclByZWZpeCB8fCAnJztcclxuICAgICAgICAgICAgdmFyIGVycm9yRGF0YSA9IHsgZXhjZXB0aW9uOiBleGNlcHRpb24sIGNhdXNlOiBjYXVzZSB9O1xyXG4gICAgICAgICAgICBleGNlcHRpb24ubWVzc2FnZSA9IGFwcEVycm9yUHJlZml4ICsgZXhjZXB0aW9uLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICRkZWxlZ2F0ZShleGNlcHRpb24sIGNhdXNlKTtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIENvdWxkIGFkZCB0aGUgZXJyb3IgdG8gYSBzZXJ2aWNlJ3MgY29sbGVjdGlvbixcclxuICAgICAgICAgICAgICogYWRkIGVycm9ycyB0byAkcm9vdFNjb3BlLCBsb2cgZXJyb3JzIHRvIHJlbW90ZSB3ZWIgc2VydmVyLFxyXG4gICAgICAgICAgICAgKiBvciBsb2cgbG9jYWxseS4gT3IgdGhyb3cgaGFyZC4gSXQgaXMgZW50aXJlbHkgdXAgdG8geW91LlxyXG4gICAgICAgICAgICAgKiB0aHJvdyBleGNlcHRpb247XHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIEBleGFtcGxlXHJcbiAgICAgICAgICAgICAqICAgICB0aHJvdyB7IG1lc3NhZ2U6ICdlcnJvciBtZXNzYWdlIHdlIGFkZGVkJyB9O1xyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGV4Y2VwdGlvbi5tZXNzYWdlLCBlcnJvckRhdGEpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V4Y2VwdGlvbi5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicpXHJcbiAgICAgICAgLmZhY3RvcnkoJ2V4Y2VwdGlvbicsIGV4Y2VwdGlvbik7XHJcblxyXG4gICAgLyogQG5nSW5qZWN0ICovXHJcbiAgICBmdW5jdGlvbiBleGNlcHRpb24obG9nZ2VyKSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGNhdGNoZXI6IGNhdGNoZXJcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2F0Y2hlcihtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IobWVzc2FnZSwgcmVhc29uKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9sb2dnZXIuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2Jsb2Nrcy5sb2dnZXInKS5mYWN0b3J5KCdsb2dnZXInLCBsb2dnZXIpO1xyXG5cclxuICAgIGxvZ2dlci4kaW5qZWN0ID0gWyckbG9nJywgJ3RvYXN0ciddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGxvZ2dlcigkbG9nLCB0b2FzdHIpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgc2hvd1RvYXN0czogdHJ1ZSxcclxuXHJcbiAgICAgICAgICAgIGVycm9yOiBlcnJvcixcclxuICAgICAgICAgICAgaW5mbzogaW5mbyxcclxuICAgICAgICAgICAgc3VjY2Vzczogc3VjY2VzcyxcclxuICAgICAgICAgICAgd2FybmluZzogd2FybmluZyxcclxuXHJcbiAgICAgICAgICAgIC8vIHN0cmFpZ2h0IHRvIGNvbnNvbGU7IGJ5cGFzcyB0b2FzdHJcclxuICAgICAgICAgICAgbG9nOiAkbG9nLmxvZ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBlcnJvcihtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xyXG4gICAgICAgICAgICB0b2FzdHIuZXJyb3IobWVzc2FnZSwgdGl0bGUpO1xyXG4gICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogJyArIG1lc3NhZ2UsIGRhdGEpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGluZm8obWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcclxuICAgICAgICAgICAgdG9hc3RyLmluZm8obWVzc2FnZSwgdGl0bGUpO1xyXG4gICAgICAgICAgICAkbG9nLmluZm8oJ0luZm86ICcgKyBtZXNzYWdlLCBkYXRhKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKG1lc3NhZ2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgJGxvZy5pbmZvKCdTdWNjZXNzOiAnICsgbWVzc2FnZSwgZGF0YSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gd2FybmluZyhtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xyXG4gICAgICAgICAgICB0b2FzdHIud2FybmluZyhtZXNzYWdlLCB0aXRsZSk7XHJcbiAgICAgICAgICAgICRsb2cud2FybignV2FybmluZzogJyArIG1lc3NhZ2UsIGRhdGEpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2NsZWFyLWtleS5kaXJlY3RpdmUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwiY2xlYXJLZXlcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICBlbC5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCAhPT0gMjcpIHsgcmV0dXJuOyB9IC8vIGNoZWNrIGtleSBob3cgeW91IHdhbnRcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWaWV3VmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC4kcmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9kYXRlLWJlZm9yZS5kaXJlY3RpdmUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdkYXRlQmVmb3JlJywgZnVuY3Rpb24gKCR3aW5kb3cpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1aXJlOiAnXm5nTW9kZWwnLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0sIGF0dHJzLCBuZ01vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW5nTW9kZWwpIHJldHVybjsgLy8gZG8gbm90aGluZyBpZiBubyBuZy1tb2RlbFxyXG4gICAgICAgICAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0ZUJlZm9yZSA9IGF0dHJzLmRhdGVCZWZvcmU7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZGF0ZScsIGRhdGVCZWZvcmUpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHdhdGNoIG93biB2YWx1ZSBhbmQgcmUtdmFsaWRhdGUgb24gY2hhbmdlXHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goYXR0cnMubmdNb2RlbCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBvYnNlcnZlIHRoZSBvdGhlciB2YWx1ZSBhbmQgcmUtdmFsaWRhdGUgb24gY2hhbmdlXHJcbiAgICAgICAgICAgICAgICBhdHRycy4kb2JzZXJ2ZSgnZGF0ZUdyZWF0ZXJBbmRFcXVhbCcsIGZ1bmN0aW9uICh2YWwpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlc1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlVG8gPSBhbmd1bGFyLmlzRGVmaW5lZChuZ01vZGVsLiR2aWV3VmFsdWUpID09PSB0cnVlICYmICFfLmlzTnVsbChuZ01vZGVsLiR2aWV3VmFsdWUpID8gbW9tZW50KG5nTW9kZWwuJHZpZXdWYWx1ZSkudG9EYXRlKCkgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlRnJvbSA9IGF0dHJzLmRhdGVHcmVhdGVyQW5kRXF1YWwgIT09IFwiXCIgPyBtb21lbnQoYXR0cnMuZGF0ZUdyZWF0ZXJBbmRFcXVhbC5yZXBsYWNlKCdcIicsICcnKS5yZXBsYWNlKCdcXFxcJywgJycpLnJlcGxhY2UoJ1wiJywgJycpKS50b0RhdGUoKSA6IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9wYXNzaW5nIGRhdGUgd2l0aCBicmFjZXMgYXJvdW5kIGl0IGNhdXNlcyBhbmQgaXNzdWUgdGhlcmZvcmUgd2UgbmVlZCB0byB1c2UgcmVwbGFjZVxyXG5cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG5cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9kYXRlLWZvcm1hdC5kaXJlY3RpdmUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdkYXRlRm9ybWF0JyxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGRhdGVGaWx0ZXIsICRwYXJzZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN0cmljdDogJ0VBQycsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZTogJz9uZ01vZGVsJyxcclxuICAgICAgICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHBhcnNlcnMucHVzaChmdW5jdGlvbiAodmlld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZUZpbHRlcih2aWV3VmFsdWUsICdNTS9kZC95eXl5IGg6bW0gYScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2RhdGUtaW5wdXQuZGlyZWN0aXZlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnZGF0ZUlucHV0JywgZnVuY3Rpb24gKCR3aW5kb3cpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1aXJlOiAnXm5nTW9kZWwnLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsbSwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtb21lbnQgPSAkd2luZG93Lm1vbWVudDtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRlRm9ybWF0ID0gYXR0cnMuZGF0ZUlucHV0O1xyXG4gICAgICAgICAgICAgICAgYXR0cnMuJG9ic2VydmUoJ2RhdGVJbnB1dCcsIGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRlRm9ybWF0ID09PSBuZXdWYWx1ZSB8fCAhY3RybC4kbW9kZWxWYWx1ZSkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGVGb3JtYXQgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLiRtb2RlbFZhbHVlID0gbmV3IERhdGUoY3RybC4kc2V0Vmlld1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGN0cmwuJGZvcm1hdHRlcnMudW5zaGlmdChmdW5jdGlvbiAobW9kZWxWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlID0gc2NvcGU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRlRm9ybWF0IHx8ICFtb2RlbFZhbHVlKSByZXR1cm4gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gbW9tZW50KG1vZGVsVmFsdWUpLmZvcm1hdChkYXRlRm9ybWF0KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY3RybC4kcGFyc2Vycy51bnNoaWZ0KGZ1bmN0aW9uICh2aWV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZSA9IHNjb3BlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbW9tZW50KHZpZXdWYWx1ZSwgZGF0ZUZvcm1hdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkYXRlICYmIGRhdGUuaXNWYWxpZCgpICYmIGRhdGUueWVhcigpID4gMTk1MCkgPyBkYXRlLnRvRGF0ZSgpIDogXCJcIjtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL3NtYXJ0LXRhYmxlLmNsZWFyS2V5LmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZShcInN0Q2xlYXJLZXlcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnXnN0VGFibGUnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoICE9PSAyNykgeyByZXR1cm47IH0gLy8gY2hlY2sga2V5IGhvdyB5b3Ugd2FudFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGROYW1lID0gZWxlbWVudC5jb250ZXh0LmF0dHJpYnV0ZXNbJ3N0LXNlYXJjaCddLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVTdGF0ZSA9IGN0cmwudGFibGVTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3RbZmllbGROYW1lXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgYXBwLmRpcmVjdGl2ZSgndG9nZ2xlQ2hlY2tib3gnLCBmdW5jdGlvbigkdGltZW91dCkge1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAqIERpcmVjdGl2ZVxyXG4gICAgICovXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgcmVwbGFjZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCAkZWxlbWVudCwgJGF0dHIsIG5nTW9kZWwpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgbW9kZWwgZnJvbSBFbGVtZW50XHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlTW9kZWxGcm9tRWxlbWVudCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIG1vZGlmaWVkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSAkZWxlbWVudC5wcm9wKCdjaGVja2VkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQgIT09IG5nTW9kZWwuJHZpZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgbmdNb2RlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUoY2hlY2tlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBpbnB1dCBmcm9tIE1vZGVsXHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlRWxlbWVudEZyb21Nb2RlbCA9IGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQudHJpZ2dlcignY2hhbmdlJyk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE9ic2VydmU6IEVsZW1lbnQgY2hhbmdlcyBhZmZlY3QgTW9kZWxcclxuICAgICAgICAgICAgICAgICRlbGVtZW50Lm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVNb2RlbEZyb21FbGVtZW50KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZ01vZGVsLiR2aWV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUVsZW1lbnRGcm9tTW9kZWwobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSW5pdGlhbGlzZSBCb290c3RyYXBUb2dnbGVcclxuICAgICAgICAgICAgICAgICRlbGVtZW50LmJvb3RzdHJhcFRvZ2dsZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2NyZWF0ZUV2ZW50LmNvbnRyb2xsZXIuanNcclxuXHJcbihmdW5jdGlvbigpIHtcclxuXHRcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ0NyZWF0ZUV2ZW50Q29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ldmVudHMnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgbWFpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIG1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbJ2xvZ2dlcicsICckdWliTW9kYWxJbnN0YW5jZScsICdldmVudFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcihsb2dnZXIsICRtb2RhbCwgc2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnRWRpdCBHdWVzdCc7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdm0uZGF0ZUZvcm1hdCA9IFwiTU0vREQvWVlZWSBoaDptbVwiO1xyXG5cclxuICAgICAgICB2bS5ldmVudCA9IHtcclxuICAgICAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZToge31cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5ldmVudC50ZW1wbGF0ZS5uYW1lID0gdm0uZXZlbnQubmFtZTtcclxuICAgICAgICAgICAgc2VydmljZS5jcmVhdGUodm0uZXZlbnQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRtb2RhbC5jbG9zZShkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZWRpdEd1ZXN0LmNvbnRyb2xsZXIuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdDcmVhdGVHdWVzdENvbnRyb2xsZXInO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuZXZlbnRzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIG1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBtYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2V2ZW50U2VydmljZScsICdldmVudCddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1haW5Db250cm9sbGVyKCRzY29wZSwgbG9nZ2VyLCAkbW9kYWwsIHNlcnZpY2UsIGV2ZW50KSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdDcmVhdGUgR3Vlc3QnO1xyXG4gICAgICAgXHJcbiAgICAgICAgdm0uZ3Vlc3QgPSB7XHJcbiAgICAgICAgICAgIGZpbmRlck51bWJlcjogJzAwMDAwMDAwMDAwJywgXHJcbiAgICAgICAgICAgIGV2ZW50SWQ6IGV2ZW50LmlkXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0udGlja2V0Q291bnRMaXN0ID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBldmVudC50aWNrZXRBbGxvd2FuY2UgKyAxOyBpKyspIHtcclxuICAgICAgICAgICAgdm0udGlja2V0Q291bnRMaXN0LnB1c2goaSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5kZWNyZW1lbnRUaWNrZXRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuZWRpdEd1ZXN0Rm9ybS4kcHJpc3RpbmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uZ3Vlc3QuYWRkaXRpb25hbFRpY2tldHMtLTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmluY3JlbWVudFRpY2tldHMgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuZWRpdEd1ZXN0Rm9ybS4kcHJpc3RpbmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uZ3Vlc3QuYWRkaXRpb25hbFRpY2tldHMrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNoYW5nZUF0dGVuZGluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLmd1ZXN0LmlzQXR0ZW5kaW5nKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5ndWVzdC50aWNrZXRDb3VudCA9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2bS5ndWVzdC50aWNrZXRDb3VudCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlcnZpY2UucmVnaXN0ZXJHdWVzdCh2bS5ndWVzdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodm0uZ3Vlc3QsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtb2RhbC5jbG9zZSh2bS5ndWVzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9lZGl0R3Vlc3QuY29udHJvbGxlci5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ0VkaXRHdWVzdENvbnRyb2xsZXInO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuZXZlbnRzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIG1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBtYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2V2ZW50U2VydmljZScsICdndWVzdCddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1haW5Db250cm9sbGVyKCRzY29wZSwgbG9nZ2VyLCAkbW9kYWwsIHNlcnZpY2UsIGd1ZXN0KSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdFZGl0IEd1ZXN0JztcclxuXHJcbiAgICAgICAgaWYgKGd1ZXN0LmlzQXR0ZW5kaW5nKSB7XHJcbiAgICAgICAgICAgIHZtLnNob3dBZGRUaWNrZXQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZ3Vlc3QgPSBhbmd1bGFyLmNvcHkoZ3Vlc3QpO1xyXG5cclxuICAgICAgICB2bS50aWNrZXRDb3VudExpc3QgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGd1ZXN0LmV2ZW50LnRpY2tldEFsbG93YW5jZSArIDE7IGkrKykge1xyXG4gICAgICAgICAgICB2bS50aWNrZXRDb3VudExpc3QucHVzaChpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdm0uZGVjcmVtZW50VGlja2V0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmVkaXRHdWVzdEZvcm0uJHByaXN0aW5lID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLmd1ZXN0LmFkZGl0aW9uYWxUaWNrZXRzLS07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5pbmNyZW1lbnRUaWNrZXRzID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmVkaXRHdWVzdEZvcm0uJHByaXN0aW5lID0gZmFsc2U7IFxyXG4gICAgICAgICAgICB2bS5ndWVzdC5hZGRpdGlvbmFsVGlja2V0cysrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5jaGFuZ2VBdHRlbmRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5ndWVzdC5pc0F0dGVuZGluZykge1xyXG4gICAgICAgICAgICAgICAgdm0uZ3Vlc3QudGlja2V0Q291bnQgPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdm0uZ3Vlc3QudGlja2V0Q291bnQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnNob3dBZGRUaWNrZXQpIHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2UuYWRkVGlja2V0KHZtLmd1ZXN0KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHZtLmd1ZXN0LCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKHZtLmd1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2UucmVnaXN0ZXJHdWVzdCh2bS5ndWVzdClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHZtLmd1ZXN0LCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKHZtLmd1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V2ZW50cy5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ0V2ZW50Q29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ldmVudHMnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgbWFpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIG1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbJ2xvZ2dlcicsICckdWliTW9kYWwnLCAnZXZlbnRTZXJ2aWNlJywgJ2d1ZXN0U2VydmljZScsICd0ZW1wbGF0ZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcihsb2dnZXIsICRtb2RhbCwgc2VydmljZSwgZ3Vlc3RTZXJ2aWNlLCB0ZW1wbGF0ZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG4gICAgICAgIHZhciBwYWdlU2l6ZURlZmF1bHQgPSAxMDtcclxuXHJcbiAgICAgICAgLy9UT0RPOiBob3N0TG9jYXRpb24gbmVlZHMgdG8gYmUgZHluYW1pYyB0byBlbnZpcm9ubWVudFxyXG4gICAgICAgIHZtLmhvc3RMb2NhdGlvbiA9ICdyc3ZwLXRlc3QvJztcclxuXHJcbiAgICAgICAgdm0udGl0bGUgPSAnRXZlbnQgTWFuYWdlcic7XHJcbiAgICAgICAgdm0uZGVzY3JpcHRpb24gPSBcIk1hbmFnZSBEb25vciBFdmVudHNcIjtcclxuICAgICAgICB2bS5jdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XHJcblxyXG4gICAgICAgIHZtLmRhdGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBkYXRlRGlzYWJsZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICBmb3JtYXRZZWFyOiAneXknLFxyXG4gICAgICAgICAgICBtYXhEYXRlOiBuZXcgRGF0ZSgyMDIwLCA1LCAyMiksXHJcbiAgICAgICAgICAgIG1pbkRhdGU6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgIHN0YXJ0aW5nRGF5OiAxXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZGF0ZUZvcm1hdCA9IFwiTU0vREQvWVlZWSBoOm1tIGFcIjtcclxuICAgICAgICB2bS5ldmVudHMgPSBbXTtcclxuXHJcbiAgICAgICAgdm0uc2VhcmNoTW9kZWwgPSB7XHJcbiAgICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZURlZmF1bHQsXHJcbiAgICAgICAgICAgIG9yZGVyQnk6ICdpZCcsXHJcbiAgICAgICAgICAgIG9yZGVyRGlyZWN0aW9uOiAnYXNjJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnRhYnMgPSBbXHJcbiAgICAgICAgICAgIHsgdGl0bGU6ICdEZXRhaWxzJywgdGVtcGxhdGU6ICdhcHAvZXZlbnRzL3ZpZXdzL2hvbWUuaHRtbCcsIGFjdGl2ZTogZmFsc2UsIGljb246ICdmYS1pbmZvLWNpcmNsZScgfSxcclxuICAgICAgICAgICAgeyB0aXRsZTogJ0d1ZXN0cycsIHRlbXBsYXRlOiAnYXBwL2V2ZW50cy92aWV3cy9ndWVzdC1saXN0Lmh0bWwnLCBhY3RpdmU6IHRydWUsIGljb246ICdmYS11c2VycycgfSxcclxuICAgICAgICAgICAgLy97IHRpdGxlOiAnTWFpbCBRdWV1ZScsIHRlbXBsYXRlOiAnYXBwL2V2ZW50cy92aWV3cy9tYWlsLXF1ZXVlLmh0bWwnLCBhY3RpdmU6IGZhbHNlLCBpY29uOiAnJyB9LFxyXG4gICAgICAgICAgICAvL3sgdGl0bGU6ICdXYWl0aW5nIFF1ZXVlJywgdGVtcGxhdGU6ICdhcHAvZXZlbnRzL3ZpZXdzL3dhaXQtcXVldWUuaHRtbCcsIGFjdGl2ZTogZmFsc2UsIGljb246ICcnIH0sXHJcbiAgICAgICAgICAgIHsgdGl0bGU6ICdUZW1wbGF0ZScsIHRlbXBsYXRlOiAnYXBwL2V2ZW50cy92aWV3cy90ZW1wbGF0ZS5odG1sJywgYWN0aXZlOiBmYWxzZSwgaWNvbjogJ2ZhLWZpbGUtdGV4dCcgfVxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKGNvbnRyb2xsZXJJZCArICcgYWN0aXZhdGVkJyk7XHJcbiAgICAgICAgICAgIGdldEV2ZW50cygpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygnbG9hZGVkIGV2ZW50cycpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmFkZFRvTWFpbFF1ZXVlID0gZnVuY3Rpb24gKGd1ZXN0KSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuYWRkVG9NYWlsKGd1ZXN0KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnQWRkZWQgR3Vlc3QgdG8gUXVldWU6ICcgKyBkYXRhLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGd1ZXN0LCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnSXNzdWVkIHRpY2tldCB0bzogJyArIGd1ZXN0Lm5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnQgPSBhbmd1bGFyLmNvcHkodm0uc2VsZWN0ZWRFdmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodm0uc2VsZWN0ZWRFdmVudCwgZ3Vlc3QuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuZ3Vlc3RzID0gZXZlbnQuZ3Vlc3RzO1xyXG4gICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5jaGFuZ2VFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZEV2ZW50KSByZXR1cm47XHJcbiAgICAgICAgICAgIC8vUkVTRVQgVkFMVUVTXHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZURlZmF1bHQsXHJcbiAgICAgICAgICAgICAgICBvcmRlckJ5OiAnaWQnLFxyXG4gICAgICAgICAgICAgICAgb3JkZXJEaXJlY3Rpb246ICdhc2MnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZtLnNob3dXYWl0TGlzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5zaG93TWFpbFF1ZXVlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnRhYnNbMF0uYWN0aXZlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuZ2V0QnlJZCh2bS5zZWxlY3RlZEV2ZW50LmlkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh2bS5zZWxlY3RlZEV2ZW50LCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlYXJjaEd1ZXN0cyh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnJlZnJlc2hHdWVzdHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaEd1ZXN0cyh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmRlbGV0ZUV2ZW50ID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgICAgIC8vVE9ETzogQ29uZmlybWF0aW9uIG9uIGRlbGV0ZVxyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnJlbW92ZShpZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV2ZW50ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdEZWxldGVkIGV2ZW50Jyk7XHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBnZXRFdmVudHMoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZXhwb3J0R3Vlc3RzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmRvd25sb2FkR3Vlc3RzKHZtLnNlbGVjdGVkRXZlbnQuaWQsIHZtLnNlYXJjaE1vZGVsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudFR5cGUgPSBkYXRhLmhlYWRlcnMoKVsnY29udGVudC10eXBlJ107XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5oZWFkZXJzKClbJ3gtZmlsZW5hbWUnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmtFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2RhdGEuZGF0YV0sIHsgdHlwZTogY29udGVudFR5cGUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSgnaHJlZicsIHVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZShcImRvd25sb2FkXCIsIGZpbGVuYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGlja0V2ZW50ID0gbmV3IE1vdXNlRXZlbnQoXCJjbGlja1wiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInZpZXdcIjogd2luZG93LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJidWJibGVzXCI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNhbmNlbGFibGVcIjogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtFbGVtZW50LmRpc3BhdGNoRXZlbnQoY2xpY2tFdmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNyZWF0ZUd1ZXN0ID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2V2ZW50cy92aWV3cy9lZGl0LWd1ZXN0Lmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0NyZWF0ZUd1ZXN0Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsIFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50OiB2bS5zZWxlY3RlZEV2ZW50XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gYW5ndWxhci5jb3B5KHZtLnNlbGVjdGVkRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodm0uc2VsZWN0ZWRFdmVudCwgcmVzdWx0LmV2ZW50KTtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuZ3Vlc3RzID0gZXZlbnQuZ3Vlc3RzO1xyXG5cclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuZ3Vlc3RzLnVuc2hpZnQocmVzdWx0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5yZWdpc3Rlckd1ZXN0ID0gZnVuY3Rpb24gKGd1ZXN0KSB7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9ldmVudHMvdmlld3MvZWRpdC1ndWVzdC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFZGl0R3Vlc3RDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBndWVzdDogZ3Vlc3RcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoZ3Vlc3QsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZXZlbnQgPSBhbmd1bGFyLmNvcHkodm0uc2VsZWN0ZWRFdmVudCk7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh2bS5zZWxlY3RlZEV2ZW50LCByZXN1bHQuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFdmVudC5ndWVzdHMgPSBldmVudC5ndWVzdHM7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0udG9nZ2xlV2FpdGluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uc2hvd1dhaXRpbmcgPSAhdm0uc2hvd1dhaXRpbmc7XHJcbiAgICAgICAgICAgIHZtLnNob3dNYWlsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnNob3dTZW50ID0gZmFsc2U7IFxyXG4gICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5wYWdlID0gMTtcclxuICAgICAgICAgICAgdm0uc2VhcmNoR3Vlc3RzKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0udG9nZ2xlTWFpbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uc2hvd01haWwgPSAhdm0uc2hvd01haWw7XHJcbiAgICAgICAgICAgIHZtLnNob3dXYWl0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnNob3dTZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLnBhZ2UgPSAxO1xyXG4gICAgICAgICAgICB2bS5zZWFyY2hHdWVzdHModGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS50b2dnbGVTZW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZtLnNob3dTZW50ID0gIXZtLnNob3dTZW50O1xyXG4gICAgICAgICAgICB2bS5zaG93V2FpdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5zaG93TWFpbCA9IGZhbHNlOyBcclxuICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwucGFnZSA9IDE7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaEd1ZXN0cyh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLm1haWxUaWNrZXQgPSBmdW5jdGlvbiAoZ3Vlc3QpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgZ3Vlc3QuaXNNYWlsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBndWVzdC5tYWlsZWREYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgdm0uaXNXYWl0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHNlcnZpY2UubWFpbFRpY2tldChndWVzdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGd1ZXN0LCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdJc3N1ZWQgdGlja2V0IHRvOiAnICsgZ3Vlc3QubmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gYW5ndWxhci5jb3B5KHZtLnNlbGVjdGVkRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodm0uc2VsZWN0ZWRFdmVudCwgZ3Vlc3QuZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFdmVudC5ndWVzdHMgPSBldmVudC5ndWVzdHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNlYXJjaEd1ZXN0cyA9IGZ1bmN0aW9uICh0YWJsZVN0YXRlKSB7XHJcbiAgICAgICAgICAgIHRhYmxlU3RhdGVSZWYgPSB0YWJsZVN0YXRlO1xyXG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkRXZlbnQpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgKHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGUpICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5vcmRlckJ5ID0gdGFibGVTdGF0ZS5zb3J0LnByZWRpY2F0ZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLm9yZGVyRGlyZWN0aW9uID0gdGFibGVTdGF0ZS5zb3J0LnJldmVyc2UgPyAnZGVzYycgOiAnYXNjJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QpICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5uYW1lID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0Lm5hbWU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5hZGRyZXNzID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmFkZHJlc3M7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5jaXR5ID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmNpdHk7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5zdGF0ZSA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5zdGF0ZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLnppcGNvZGUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuemlwY29kZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmd1ZXN0Q291bnQgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuZ3Vlc3RDb3VudDtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLnBob25lID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LnBob25lO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuZW1haWwgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuZW1haWw7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5hY2NvdW50SWQgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuYWNjb3VudElkO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuZmluZGVyTnVtYmVyID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmZpbmRlck51bWJlcjtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzTWFpbGVkID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmlzTWFpbGVkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5pc0F0dGVuZGluZyA9IG51bGw7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzV2FpdGluZyA9IG51bGw7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzTWFpbGVkID0gbnVsbDsgXHJcblxyXG4gICAgICAgICAgICBpZiAodm0uc2hvd1dhaXRpbmcpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzV2FpdGluZyA9IHZtLnNob3dXYWl0aW5nID8gdm0uc2hvd1dhaXRpbmcgOiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodm0uc2hvd01haWwpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzV2FpdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuaXNNYWlsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzQXR0ZW5kaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnNob3dTZW50KSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5pc1dhaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzTWFpbGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzQXR0ZW5kaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2UuZ2V0R3Vlc3RzKHZtLnNlbGVjdGVkRXZlbnQuaWQsIHZtLnNlYXJjaE1vZGVsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV2ZW50Lmd1ZXN0cyA9IGRhdGEuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ucGFnZWQgPSBmdW5jdGlvbiBwYWdlZCgpIHtcclxuICAgICAgICAgICAgdm0uc2VhcmNoR3Vlc3RzKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNhdmVFdmVudCA9IGZ1bmN0aW9uIChmb3JtKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlLnVwZGF0ZSh2bS5zZWxlY3RlZEV2ZW50KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ3Vlc3RzID0gdm0uc2VsZWN0ZWRFdmVudC5ndWVzdHM7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodm0uc2VsZWN0ZWRFdmVudCwgZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQuZ3Vlc3RzID0gZ3Vlc3RzO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTYXZlZCBFdmVudDogJyArIGRhdGEubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcm0uJHNldFByaXN0aW5lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmZpbGVTZWxlY3RlZCA9IGZ1bmN0aW9uICgkZmlsZXMsICRmaWxlKSB7XHJcbiAgICAgICAgICAgIC8vVE9ETzogQ2FsbGVkIG11bHRpcGxlIHRpbWVzLiBFcnJvciBvbiBkaXJlY3Rvcnkgc2VsZWN0aW9uIG9mIGZpbGUuIFxyXG4gICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z2dlcjtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhVXJsID0gcmVhZGVyLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQudGVtcGxhdGUuaW1hZ2UgPSBkYXRhVXJsLnNwbGl0KFwiLFwiKVsxXTtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQudGVtcGxhdGUubWltZVR5cGUgPSAkZmlsZS50eXBlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTCgkZmlsZSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNhdmVUZW1wbGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGVtcGxhdGVTZXJ2aWNlLnVwZGF0ZSh2bS5zZWxlY3RlZEV2ZW50LnRlbXBsYXRlKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEV2ZW50LnRlbXBsYXRlID0gYW5ndWxhci5leHRlbmQodm0uc2VsZWN0ZWRFdmVudC50ZW1wbGF0ZSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1NhdmVkIHRlbXBsYXRlOiAnICsgZGF0YS5uYW1lKTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS50b2dnbGVDYW5jZWwgPSBmdW5jdGlvbiAoZm9ybSkge1xyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZEV2ZW50LmlzQ2FuY2VsbGVkID0gIXZtLnNlbGVjdGVkRXZlbnQuaXNDYW5jZWxsZWQ7XHJcbiAgICAgICAgICAgIHZtLnNhdmVFdmVudChmb3JtKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZEV2ZW50LmlzQ2FuY2VsbGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoJ0NhbmNlbGxlZCBldmVudCcpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnUmVzdG9yZWQgZXZlbnQnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zaG93Q3JlYXRlRXZlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9ldmVudHMvdmlld3MvY3JlYXRlLWV2ZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0NyZWF0ZUV2ZW50Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXZlbnQgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgdm0uZXZlbnRzLnVuc2hpZnQodm0uc2VsZWN0ZWRFdmVudCk7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IGNyZWF0ZWQgJyArIGRhdGEubmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uc2hvd0d1ZXN0VXBsb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBrZXlib2FyZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvZXZlbnRzL3ZpZXdzL2d1ZXN0LXVwbG9hZC5odG1sJyxcclxuICAgICAgICAgICAgICAgIC8vY29udHJvbGxlcjogWydsb2dnZXInLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAnZmlsZVNlcnZpY2UnLCAnc2VsZWN0ZWRFdmVudCcsIFVwbG9hZEd1ZXN0Q29udHJvbGxlcl0sXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVXBsb2FkR3Vlc3RDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBldmVudDogdm0uc2VsZWN0ZWRFdmVudFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcyhyZXN1bHQubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihyZXN1bHQubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2bS5jaGFuZ2VFdmVudCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEV2ZW50cygpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2UuZ2V0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZXZlbnRzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH07XHJcblxyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL3VwbG9hZEd1ZXN0LmNvbnRyb2xsZXIuanNcclxuXHJcbihmdW5jdGlvbigpIHtcclxuXHRcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ1VwbG9hZEd1ZXN0Q29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ldmVudHMnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgbWFpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIG1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbJ2xvZ2dlcicsICckdWliTW9kYWxJbnN0YW5jZScsICdmaWxlU2VydmljZScsICdldmVudCddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1haW5Db250cm9sbGVyKGxvZ2dlciwgJG1vZGFsLCBzZXJ2aWNlLCBldmVudCkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnRWRpdCBHdWVzdCc7XHJcblxyXG4gICAgICAgIHZtLmV2ZW50ID0gZXZlbnQ7XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uZmlsZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmZpbGVTZWxlY3RlZCA9IGZ1bmN0aW9uICgkZmlsZSwgJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZtLnJlc3VsdCA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5yZXN1bHQgPSB7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLmd1ZXN0KHZtLmV2ZW50LmlkLCB2bS5maWxlKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJlc3VsdC5zdWNjZXNzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVzdWx0Lm1lc3NhZ2UgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yZXN1bHQubWVzc2FnZSA9IGVycm9yLmRhdGEubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uZmlsZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRtb2RhbC5jbG9zZSh2bS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiLy9hcHAuZmlsdGVyLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXInKS5maWx0ZXIoJ3BlcmNlbnRhZ2UnLCBbJyRmaWx0ZXInLCBmdW5jdGlvbiAoJGZpbHRlcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCwgZGVjaW1hbHMpIHtcclxuICAgICAgICByZXR1cm4gJGZpbHRlcignbnVtYmVyJykoaW5wdXQgKiAxMDAsIGRlY2ltYWxzKSArICclJztcclxuICAgIH07XHJcbn1dKTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAuZmlsdGVyJywgW10pLmZpbHRlcignY2hlY2ttYXJrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgIHJldHVybiBpbnB1dCA/ICdcXHUyNzEzJyA6ICdcXHUyNzE4JztcclxuICAgIH07XHJcbn0pO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXInKS5maWx0ZXIoJ3llc05vJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgIHJldHVybiBpbnB1dCA/ICdZZXMnIDogJ05vJztcclxuICAgIH1cclxufSk7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnYXBwLmZpbHRlcicpLmZpbHRlcigndXBkYXRlU3RhdHVzJywgZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgIGlmIChpbnB1dCA9PT0gMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ1VuY2hhbmdlZCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbnB1dCA9PT0gMikge1xyXG4gICAgICAgICAgICByZXR1cm4gJ0NoYW5nZWQnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5wdXQgPT09IDYpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdSZWNvbmNpbGVkJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICB9O1xyXG59KTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9uYXYuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdOYXZDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm5hdicpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFpbkNvbnRyb2xsZXIobG9nZ2VyKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICAgICAgdm0udXNlciA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1cnJlbnRVc2VyJykpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZXZlbnQuc2VydmljZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ2V2ZW50U2VydmljZSc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KHNlcnZpY2VJZCwgc2VydmljZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKGxvZ2dlciwgJGh0dHAsIGNvbmZpZykge1xyXG4gICAgICAgIGxvZ2dlci5sb2coc2VydmljZUlkICsgJyBsb2FkZWQnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuRXZlbnQ7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlLFxyXG4gICAgICAgICAgICBkb3dubG9hZEd1ZXN0czogZG93bmxvYWRHdWVzdHMsIFxyXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIGdldEJ5SWQ6IGdldEJ5SWQsXHJcbiAgICAgICAgICAgIGdldEd1ZXN0czogZ2V0R3Vlc3RzLCBcclxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcclxuICAgICAgICAgICAgYWRkVG9NYWlsOiBhZGRUb01haWwsIFxyXG4gICAgICAgICAgICByZWdpc3Rlckd1ZXN0OiByZWdpc3Rlckd1ZXN0LFxyXG4gICAgICAgICAgICBtYWlsVGlja2V0OiBtYWlsVGlja2V0LCBcclxuICAgICAgICAgICAgYWRkVGlja2V0OiBhZGRUaWNrZXRcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZShldmVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIGV2ZW50KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRvd25sb2FkR3Vlc3RzKGlkLCB2bSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnLycgKyBpZCArICcvZ3Vlc3RzL2V4cG9ydCcsIHZtKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCArICcvJyArIGlkKS50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgIC50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRCeUlkKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy8nICsgaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0R3Vlc3RzKGlkLCB2bSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnLycgKyBpZCArICcvZ3Vlc3RzJywgdm0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWFpbFRpY2tldChndWVzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnLycgKyBndWVzdC5ldmVudElkICsgJy9tYWlsdGlja2V0JywgZ3Vlc3QpLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZFRpY2tldChndWVzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnLycgKyBndWVzdC5ldmVudElkICsgJy9hZGR0aWNrZXQnLCBndWVzdCkudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkVG9NYWlsKGd1ZXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCArICcvJyArIGd1ZXN0LmV2ZW50SWQgKyAnL2FkZHRvbWFpbCcsIGd1ZXN0KS50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBxdWVyeShuYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy8nICsgbmFtZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKF9zdWNjZXNzKS5jYXRjaChlcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZWdpc3Rlckd1ZXN0KGd1ZXN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCArICcvJyArIGd1ZXN0LmV2ZW50SWQgKyAnL3JlZ2lzdGVyZ3Vlc3QnICwgZ3Vlc3QpLnRoZW4oX3N1Y2Nlc3MpLmNhdGNoKGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZShldmVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgZXZlbnQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihfc3VjY2VzcykuY2F0Y2goZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX3N1Y2Nlc3MocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVycm9yLmRhdGEubWVzc2FnZTsgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2ZpbGUuc2VydmljZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIHNlcnZpY2VJZCA9ICdmaWxlU2VydmljZSc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KHNlcnZpY2VJZCwgc2VydmljZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKGxvZ2dlciwgJGh0dHAsIGNvbmZpZykge1xyXG4gICAgICAgIGxvZ2dlci5sb2coc2VydmljZUlkICsgJyBsb2FkZWQnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuRmlsZTtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGd1ZXN0OiBndWVzdFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGd1ZXN0KGlkLCBkYXRhZmlsZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnL2d1ZXN0LycgKyBpZCwgZm9ybURhdGFPYmplY3QoZGF0YWZpbGUpLCB7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1SZXF1ZXN0OiBhbmd1bGFyLmlkZW50aXR5LFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogdW5kZWZpbmVkIH1cclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZvcm1EYXRhT2JqZWN0KGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIGZkID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGZkLmFwcGVuZCgnZmlsZScsIGRhdGEpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2d1ZXN0LnNlcnZpY2UuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIHNlcnZpY2VJZCA9ICdndWVzdFNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLkd1ZXN0O1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUsXHJcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgICAgICAgICBnZXQ6IGdldCxcclxuICAgICAgICAgICAgZ2V0QnlJZDogZ2V0QnlJZCxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZShldmVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIGV2ZW50KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCArICcvJyArIGlkKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEJ5SWQoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwgKyAnLycgKyBpZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBxdWVyeShuYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy8nICsgbmFtZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoZXZlbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIGV2ZW50KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKCk7IiwiLy90ZW1wbGF0ZS5zZXJ2aWNlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ3RlbXBsYXRlU2VydmljZSc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KHNlcnZpY2VJZCwgc2VydmljZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKGxvZ2dlciwgJGh0dHAsIGNvbmZpZykge1xyXG4gICAgICAgIGxvZ2dlci5sb2coc2VydmljZUlkICsgJyBsb2FkZWQnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuVGVtcGxhdGU7XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBnZXQ6IGdldCxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeVxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHNhdmU6IHNhdmUsXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBxdWVyeShuYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy8nICsgbmFtZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUodGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIHRlbXBsYXRlKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiLy91c2VyLnNlcnZpY2UuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBzZXJ2aWNlSWQgPSAndXNlclNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLlVzZXI7XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBhdmFpbGFibGVSb2xlczogYXZhaWxhYmxlUm9sZXMsXHJcbiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlLFxyXG4gICAgICAgICAgICBnZXQ6IGdldCxcclxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxyXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGVcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhdmFpbGFibGVSb2xlcygpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwgKyAnL3JvbGVzJykudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGUodXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIHVzZXIpLnRoZW4oX3N1Y2Nlc3MsIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygnZXJyb3InLCBlcnJvcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBxdWVyeShzZWFyY2hUZXJtKSB7XHJcbiAgICAgICAgICAgIHZhciBzZWFyY2hVcmwgPSB1cmwgKyAnL3NlYXJjaC8nO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNlYXJjaFRlcm0gIT0gdW5kZWZpbmVkICYmIHNlYXJjaFRlcm0ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoVXJsICs9ICc/JyArIHNlYXJjaFRlcm07XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoc2VhcmNoVXJsKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZSh1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCB1c2VyKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCArICcvJyArIGlkKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnOyBcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ1VzZXJDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIFVzZXJDb250cm9sbGVyKTtcclxuXHJcbiAgICBVc2VyQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInLCAndXNlclNlcnZpY2UnLCAnZGVmYXVsdHMnLCAnY29uZmlnJ107XHJcblxyXG4gICAgZnVuY3Rpb24gVXNlckNvbnRyb2xsZXIobG9nZ2VyLCBzZXJ2aWNlLCBkZWZhdWx0cywgY29uZmlnKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdVc2VyIE1hbmFnZXInO1xyXG4gICAgICAgIHZtLmRlc2NyaXB0aW9uID0gJ0VkaXQgYW5kIHVwZGF0ZSB1c2Vycyc7XHJcbiAgICAgICAgdmFyIGtleUNvZGVzID0gY29uZmlnLmtleUNvZGVzO1xyXG5cclxuICAgICAgICB2bS5hdmFpbGFibGVSb2xlcyA9IFtdO1xyXG4gICAgICAgIHZtLmNsZWFyQ3JlYXRlID0gY2xlYXJDcmVhdGU7XHJcbiAgICAgICAgdm0uY3VycmVudEVkaXQgPSB7fTtcclxuICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICB2bS5sYXN0RGVsZXRlZCA9IG51bGw7XHJcbiAgICAgICAgdm0ubGFzdFVwZGF0ZWQgPSBudWxsO1xyXG4gICAgICAgIHZtLml0ZW1Ub0VkaXQgPSB7fTtcclxuXHJcbiAgICAgICAgdm0udXNlciA9IHtcclxuICAgICAgICAgICAgLy91c2VyTmFtZTogbnVsbCxcclxuICAgICAgICAgICAgcm9sZXM6IFsndXNlciddLFxyXG4gICAgICAgICAgICBmdWxsTmFtZTogJycsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiBkZWZhdWx0cy5HRU5FUklDX1BBU1NXT1JEXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKGNvbnRyb2xsZXJJZCArICcgYWN0aXZhdGVkJyk7XHJcbiAgICAgICAgICAgIGdldEF2YWlsYWJsZVJvbGVzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uYWRkSXRlbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0udXNlci5mdWxsTmFtZSA9IHBhcnNlRnVsbE5hbWUodm0udXNlci51c2VyTmFtZSk7XHJcbiAgICAgICAgICAgIHZtLnVzZXIuZW1haWwgPSB2bS51c2VyLnVzZXJOYW1lICsgZGVmYXVsdHMuRU1BSUxfU1VGRklYO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZSh2bS51c2VyKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IG1hcHBpbmcgd291bGQgYWxsb3cgcmVtb3ZhbCBvZiBleHRlbmQgbWV0aG9kXHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlciA9IGFuZ3VsYXIuZXh0ZW5kKHZtLnVzZXIsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXJzLnVuc2hpZnQoYW5ndWxhci5jb3B5KHZtLnVzZXIpKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnVXNlciAnICsgdm0udXNlci51c2VyTmFtZSArICcgY3JlYXRlZCEnKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS51c2VyLnVzZXJOYW1lID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IHNob3cgZXJyb3IgdXNlciBhbHJlYWR5IGV4aXN0c1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsRWRpdCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICB2bS5jdXJyZW50RWRpdFtpZF0gPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5kZWxldGVJdGVtID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgICAgYW5ndWxhci5jb3B5KHVzZXIsIHZtLmxhc3REZWxldGVkID0ge30pO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnJlbW92ZSh1c2VyLmlkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gdm0udXNlcnMuaW5kZXhPZih1c2VyKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS51c2Vycy5zcGxpY2UoaWR4LCAxKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmVkaXRJdGVtID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXRbdXNlci5pZF0gPSB0cnVlO1xyXG4gICAgICAgICAgICBhbmd1bGFyLmNvcHkodXNlciwgdm0uaXRlbVRvRWRpdCA9IHt9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBdmFpbGFibGVSb2xlcygpIHtcclxuICAgICAgICAgICAgc2VydmljZS5hdmFpbGFibGVSb2xlcygpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmF2YWlsYWJsZVJvbGVzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNhdmVJdGVtID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0W3VzZXIuaWRdID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuY29weSh1c2VyLCB2bS5sYXN0VXBkYXRlZCA9IHt9KTtcclxuICAgICAgICAgICAgdmFyIHJvbGVzID0gW107XHJcblxyXG4gICAgICAgICAgICBfLmZvckVhY2godm0uaXRlbVRvRWRpdC5yb2xlcyxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyb2xlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcm9sZXMucHVzaChyb2xlLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZtLml0ZW1Ub0VkaXQucm9sZXMgPSByb2xlcztcclxuXHJcbiAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlKHZtLml0ZW1Ub0VkaXQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHVzZXIsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdVc2VyICcgKyBkYXRhLnVzZXJOYW1lICsgJyB1cGRhdGVkIScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2VhcmNoID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcbiAgICAgICAgICAgIHZhciBzZWFyY2hUZXJtO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAodGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0KSAhPSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoVGVybSA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5zZWFyY2hUZXJtO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnF1ZXJ5KHNlYXJjaFRlcm0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXJzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKCd1c2VycycsIHZtLnVzZXJzKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51bmRvRGVsZXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcm9sZXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5sYXN0RGVsZXRlZC5yb2xlcywgZnVuY3Rpb24gKHJvbGUpIHtcclxuICAgICAgICAgICAgICAgIHJvbGVzLnB1c2gocm9sZS5uYW1lKTtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ3JvbGUnLCByb2xlLm5hbWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQucm9sZXMgPSByb2xlcztcclxuICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQucGFzc3dvcmQgPSBkZWZhdWx0cy5HRU5FUklDX1BBU1NXT1JEO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS5jcmVhdGUodm0ubGFzdERlbGV0ZWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgcmVzdG9yZWQgJyArIGRhdGEudXNlck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgdm0udXNlcnMudW5zaGlmdChkYXRhKTtcclxuICAgICAgICAgICAgICAgIHZtLmxhc3REZWxldGVkID0gbnVsbDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0udW5kb0NoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlKHZtLmxhc3RVcGRhdGVkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0udXNlcnMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh1LCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5pZCA9PT0gdm0ubGFzdFVwZGF0ZWQuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS51c2Vyc1tpXSA9IHZtLmxhc3RVcGRhdGVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHJlc3RvcmVkICcgKyBkYXRhLnVzZXJOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5sYXN0VXBkYXRlZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2xlYXJDcmVhdGUoJGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmICgkZXZlbnQua2V5Q29kZSA9PT0ga2V5Q29kZXMuZXNjKSB7XHJcbiAgICAgICAgICAgICAgICB2bS51c2VyLnVzZXJOYW1lID0gJyc7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcGFyc2VGdWxsTmFtZShuYW1lKSB7XHJcbiAgICAgICAgICAgIHZhciBhcnIgPSBuYW1lLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgIHZhciBmdWxsbmFtZSA9ICcnO1xyXG5cclxuICAgICAgICAgICAgXy5mb3JFYWNoKGFyciwgZnVuY3Rpb24gKHYpIHtcclxuICAgICAgICAgICAgICAgIGZ1bGxuYW1lICs9IF8uY2FwaXRhbGl6ZSh2KSArICcgJztcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gXy50cmltKGZ1bGxuYW1lKTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
